(()=>{var e={};e.id=6633,e.ids=[6633],e.modules={21841:e=>{"use strict";e.exports=require("@aws-sdk/client-s3")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},41790:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page-experimental.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},57147:e=>{"use strict";e.exports=require("fs")},71017:e=>{"use strict";e.exports=require("path")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},54288:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>b,pages:()=>l,routeModule:()=>p,tree:()=>o});var n=a(66965),s=a(74902),r=a(36408),i=a.n(r),d=a(14346),c={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>d[e]);a.d(t,c);let o=["",{children:["dashboard",{children:["subscription",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,52469)),"D:\\whatsou\\apps\\web\\app\\dashboard\\subscription\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,97913)),"D:\\whatsou\\apps\\web\\app\\dashboard\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.bind(a,47273)),"D:\\whatsou\\apps\\web\\app\\dashboard\\not-found.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,47814))).default(e)],apple:[async e=>(await Promise.resolve().then(a.bind(a,90133))).default(e)],openGraph:[async e=>(await Promise.resolve().then(a.bind(a,3774))).default(e)],twitter:[],manifest:"/manifest.webmanifest"}}]},{layout:[()=>Promise.resolve().then(a.bind(a,27734)),"D:\\whatsou\\apps\\web\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35438,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,47814))).default(e)],apple:[async e=>(await Promise.resolve().then(a.bind(a,90133))).default(e)],openGraph:[async e=>(await Promise.resolve().then(a.bind(a,3774))).default(e)],twitter:[],manifest:"/manifest.webmanifest"}}],l=["D:\\whatsou\\apps\\web\\app\\dashboard\\subscription\\page.tsx"],b="/dashboard/subscription/page",u={require:a,loadChunk:()=>Promise.resolve()},p=new n.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/dashboard/subscription/page",pathname:"/dashboard/subscription",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},79987:(e,t,a)=>{let n={"794157ea47e2106a7052b432086ad1b87e095461":()=>Promise.resolve().then(a.bind(a,82610)).then(e=>e.signUp),f2a595d6207f10ec2702e3a63c3639433bdad896:()=>Promise.resolve().then(a.bind(a,82610)).then(e=>e.getSession),dac5dc3f6ed84f3fefb6b3b31363644a8fb7a355:()=>Promise.resolve().then(a.bind(a,82610)).then(e=>e.changePassword),d625827fa7c2c77be09b75528bdad178aa3c081c:()=>Promise.resolve().then(a.bind(a,82610)).then(e=>e.signOut),b5d5296f57824f20697bf651a3e62d3a07a7262e:()=>Promise.resolve().then(a.bind(a,82610)).then(e=>e.deleteAccount),f5490e7217b4beda3444cfb66f3894e5692d3768:()=>Promise.resolve().then(a.bind(a,82610)).then(e=>e.saveFcmToken),ba699b676f4f91d1d7d1921ad4b89a747ef10c53:()=>Promise.resolve().then(a.bind(a,82610)).then(e=>e.signIn),"4a527ee583574be2bdf9f2177929a02116078f62":()=>Promise.resolve().then(a.bind(a,94065)).then(e=>e.createProduct),"27012f75ad6661d643d69cd56779e93b523e4e74":()=>Promise.resolve().then(a.bind(a,94065)).then(e=>e.deleteProduct),"062daab9f475cd399623ce936833fde70b64c375":()=>Promise.resolve().then(a.bind(a,94065)).then(e=>e.updateProduct),ab59a523b5f966d77a2cdbf664645220244c0c9e:()=>Promise.resolve().then(a.bind(a,94065)).then(e=>e.getProductsForStore),eae23fc9d6e8db8b55a13f1501c8c092743db0a8:()=>Promise.resolve().then(a.bind(a,94065)).then(e=>e.getCustomers),b9b850b25d6da988503c0d70f38405029a471f66:()=>Promise.resolve().then(a.bind(a,94065)).then(e=>e.getOrders),"9cc01ad5d382d64e5098ab2fcec9ddce5a16badb":()=>Promise.resolve().then(a.bind(a,94065)).then(e=>e.updateStore),a2ed93aa8ca9dc0bc546057e9e58b564fc8002c3:()=>Promise.resolve().then(a.bind(a,94065)).then(e=>e.getOrdersCount),"5f03e88b372d5f6e8284bc0ce0e0f38ece698a10":()=>Promise.resolve().then(a.bind(a,96962)).then(e=>e.initiateManualPayment),bf0e1330aea4c984fb4b6c37d8690d64d88b26aa:()=>Promise.resolve().then(a.bind(a,96962)).then(e=>e.getSubscriptionStatus),b2c3b2c0c4cd18681f1c6b705e0769c170ac9b7a:()=>Promise.resolve().then(a.bind(a,96962)).then(e=>e.initiatePayment),"34931017bbcf5e6dc00900cffda6e6f7cbf70b63":()=>Promise.resolve().then(a.bind(a,96962)).then(e=>e.getPaymentHistory)};async function endpoint(e,...t){let a=await n[e]();return a.apply(null,t)}e.exports={"794157ea47e2106a7052b432086ad1b87e095461":endpoint.bind(null,"794157ea47e2106a7052b432086ad1b87e095461"),f2a595d6207f10ec2702e3a63c3639433bdad896:endpoint.bind(null,"f2a595d6207f10ec2702e3a63c3639433bdad896"),dac5dc3f6ed84f3fefb6b3b31363644a8fb7a355:endpoint.bind(null,"dac5dc3f6ed84f3fefb6b3b31363644a8fb7a355"),d625827fa7c2c77be09b75528bdad178aa3c081c:endpoint.bind(null,"d625827fa7c2c77be09b75528bdad178aa3c081c"),b5d5296f57824f20697bf651a3e62d3a07a7262e:endpoint.bind(null,"b5d5296f57824f20697bf651a3e62d3a07a7262e"),f5490e7217b4beda3444cfb66f3894e5692d3768:endpoint.bind(null,"f5490e7217b4beda3444cfb66f3894e5692d3768"),ba699b676f4f91d1d7d1921ad4b89a747ef10c53:endpoint.bind(null,"ba699b676f4f91d1d7d1921ad4b89a747ef10c53"),"4a527ee583574be2bdf9f2177929a02116078f62":endpoint.bind(null,"4a527ee583574be2bdf9f2177929a02116078f62"),"27012f75ad6661d643d69cd56779e93b523e4e74":endpoint.bind(null,"27012f75ad6661d643d69cd56779e93b523e4e74"),"062daab9f475cd399623ce936833fde70b64c375":endpoint.bind(null,"062daab9f475cd399623ce936833fde70b64c375"),ab59a523b5f966d77a2cdbf664645220244c0c9e:endpoint.bind(null,"ab59a523b5f966d77a2cdbf664645220244c0c9e"),eae23fc9d6e8db8b55a13f1501c8c092743db0a8:endpoint.bind(null,"eae23fc9d6e8db8b55a13f1501c8c092743db0a8"),b9b850b25d6da988503c0d70f38405029a471f66:endpoint.bind(null,"b9b850b25d6da988503c0d70f38405029a471f66"),"9cc01ad5d382d64e5098ab2fcec9ddce5a16badb":endpoint.bind(null,"9cc01ad5d382d64e5098ab2fcec9ddce5a16badb"),a2ed93aa8ca9dc0bc546057e9e58b564fc8002c3:endpoint.bind(null,"a2ed93aa8ca9dc0bc546057e9e58b564fc8002c3"),"5f03e88b372d5f6e8284bc0ce0e0f38ece698a10":endpoint.bind(null,"5f03e88b372d5f6e8284bc0ce0e0f38ece698a10"),bf0e1330aea4c984fb4b6c37d8690d64d88b26aa:endpoint.bind(null,"bf0e1330aea4c984fb4b6c37d8690d64d88b26aa"),b2c3b2c0c4cd18681f1c6b705e0769c170ac9b7a:endpoint.bind(null,"b2c3b2c0c4cd18681f1c6b705e0769c170ac9b7a"),"34931017bbcf5e6dc00900cffda6e6f7cbf70b63":endpoint.bind(null,"34931017bbcf5e6dc00900cffda6e6f7cbf70b63")}},32460:(e,t,a)=>{Promise.resolve().then(a.bind(a,74433))},74433:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>SubscriptionPage});var n=a(84196),s=a(78726),r=a(74555),i=a(97487);a(11538),a(94574);var d=a(53696),c=(0,d.$)("bf0e1330aea4c984fb4b6c37d8690d64d88b26aa"),o=(0,d.$)("b2c3b2c0c4cd18681f1c6b705e0769c170ac9b7a"),l=(0,d.$)("34931017bbcf5e6dc00900cffda6e6f7cbf70b63"),b=(0,d.$)("5f03e88b372d5f6e8284bc0ce0e0f38ece698a10"),u=a(81651),p=a(37714),m=a(22692),f=a(77371),x=a(66447),h=a(40986),y=a(72312),g=a(67782),w=a(62509),v=a(53058),j=a(64626);let P={active:{color:"bg-green-500",textColor:"text-green-600",bgColor:"bg-green-50",icon:u.Z,labelAr:"نشط",labelEn:"Active"},grace:{color:"bg-yellow-500",textColor:"text-yellow-600",bgColor:"bg-yellow-50",icon:p.Z,labelAr:"فترة سماح",labelEn:"Grace Period"},expired:{color:"bg-red-500",textColor:"text-red-600",bgColor:"bg-red-50",icon:m.Z,labelAr:"منتهي",labelEn:"Expired"},inactive:{color:"bg-gray-400",textColor:"text-gray-600",bgColor:"bg-gray-50",icon:f.Z,labelAr:"غير نشط",labelEn:"Inactive"}};function SubscriptionPage(){let{t:e,direction:t,language:a}=(0,i.Z)(),d=(0,r.useRouter)(),p=(0,r.useSearchParams)(),[m,f]=(0,s.useState)(null),[_,N]=(0,s.useState)([]),[S,E]=(0,s.useState)(!0),[C,I]=(0,s.useState)(!1),[A,q]=(0,s.useState)("card"),[M,R]=(0,s.useState)("monthly"),[Z,k]=(0,s.useState)(!1),[O,$]=(0,s.useState)(null);async function loadData(){E(!0);let[e,t]=await Promise.all([c(),l()]);f(e),N(t.transactions||[]),E(!1)}async function handlePayment(){if(I(!0),"instapay"===A||"vodafone"===A){let e=await b(A,M);if(e.error){alert(e.error),I(!1);return}$(e),I(!1);return}let e=await o("card");if(e.error){alert(e.error),I(!1);return}e.payment_url?window.location.href=e.payment_url:e.client_secret&&e.public_key?window.location.href=`https://accept.paymob.com/unifiedcheckout/?publicKey=${e.public_key}&clientSecret=${e.client_secret}`:(I(!1),alert("Something went wrong. Please try again."))}if((0,s.useEffect)(()=>{loadData(),"complete"===p.get("status")&&(k(!0),setTimeout(()=>k(!1),5e3))},[p]),S)return(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#008069]"})});let D=P[m?.status||"inactive"],z=D.icon;return(0,n.jsxs)("div",{className:"p-4 max-w-2xl mx-auto space-y-6",dir:t,children:[(0,n.jsxs)("button",{onClick:()=>d.push("/dashboard"),className:"flex items-center gap-2 text-gray-600 hover:text-[#008069] transition",children:[(0,n.jsx)(x.Z,{className:"w-5 h-5"}),(0,n.jsx)("span",{className:"font-medium",children:"ar"===a?"الرئيسية":"Home"})]}),Z&&(0,n.jsx)("div",{className:"fixed top-4 right-4 left-4 md:left-auto md:w-96 bg-green-500 text-white p-4 rounded-lg shadow-lg z-50 animate-slide-down",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(u.Z,{className:"w-6 h-6"}),(0,n.jsx)("span",{children:"ar"===a?"تم تفعيل اشتراكك بنجاح!":"Subscription activated successfully!"})]})}),(0,n.jsxs)("div",{className:`rounded-2xl ${D.bgColor} p-6 shadow-sm`,children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"ar"===a?"الاشتراك":"Subscription"}),(0,n.jsx)("button",{onClick:loadData,className:"p-2 hover:bg-white/50 rounded-full transition",children:(0,n.jsx)(h.Z,{className:"w-5 h-5 text-gray-500"})})]}),(0,n.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,n.jsx)("div",{className:`w-16 h-16 ${D.color} rounded-full flex items-center justify-center`,children:(0,n.jsx)(z,{className:"w-8 h-8 text-white"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:`text-2xl font-bold ${D.textColor}`,children:"ar"===a?D.labelAr:D.labelEn}),m?.daysRemaining!==null&&m?.daysRemaining!==void 0&&m.daysRemaining>0&&(0,n.jsx)("p",{className:"text-gray-600",children:"ar"===a?`متبقي ${m.daysRemaining} يوم`:`${m.daysRemaining} days remaining`})]})]}),m?.isReadOnly&&(0,n.jsx)("div",{className:"bg-yellow-100 border border-yellow-300 rounded-lg p-4 mb-4",children:(0,n.jsx)("p",{className:"text-yellow-800 font-medium",children:"ar"===a?"⚠️ لوحة التحكم في وضع القراءة فقط. جدد اشتراكك للاستمرار.":"⚠️ Dashboard is in read-only mode. Renew to continue."})}),m?.expiresAt&&"active"===m.status&&(0,n.jsxs)("p",{className:"text-gray-500 text-sm",children:["ar"===a?"ينتهي في: ":"Expires: ",new Date(m.expiresAt).toLocaleDateString("ar"===a?"ar-EG":"en-US",{year:"numeric",month:"long",day:"numeric"})]})]}),(m?.status!=="active"||m?.daysRemaining!==null&&m?.daysRemaining!==void 0&&m.daysRemaining<=7)&&(0,n.jsxs)("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[(0,n.jsx)("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:m?.status==="active"?"ar"===a?"تجديد مبكر":"Early Renewal":"ar"===a?"اشترك الآن":"Subscribe Now"}),!m?.isFirstSubscription&&(0,n.jsx)("div",{className:"flex justify-center mb-6",children:(0,n.jsxs)("div",{className:"bg-gray-100 p-1 rounded-xl flex",dir:"ltr",children:[(0,n.jsx)("button",{onClick:()=>R("monthly"),className:`px-6 py-2 rounded-lg text-sm font-medium transition-all ${"monthly"===M?"bg-white text-[#008069] shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Monthly"}),(0,n.jsxs)("button",{onClick:()=>R("yearly"),className:`px-6 py-2 rounded-lg text-sm font-medium transition-all ${"yearly"===M?"bg-white text-[#008069] shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:["Yearly",(0,n.jsx)("span",{className:"ml-1 text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded-full",children:"-16%"})]})]})}),(0,n.jsxs)("div",{className:"bg-gradient-to-r from-[#008069] to-[#00a884] text-white rounded-xl p-4 mb-6",children:[(0,n.jsxs)("p",{className:"text-3xl font-bold",children:[m?.isFirstSubscription?100:"yearly"===M?3e3:300," EGP"]}),(0,n.jsx)("p",{className:"opacity-80",children:m?.isFirstSubscription?"ar"===a?"للشهر الأول":"for the first month":"yearly"===M?"ar"===a?"سنوياً":"per year":"ar"===a?"شهرياً":"per month"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[(0,n.jsxs)("button",{disabled:!0,className:"p-4 rounded-xl border-2 border-gray-200 bg-gray-100 opacity-60 cursor-not-allowed flex flex-col items-center gap-1",children:[(0,n.jsx)(y.Z,{className:"w-6 h-6 text-gray-400"}),(0,n.jsx)("span",{className:"text-sm font-medium text-gray-400",children:"ar"===a?"بطاقة":"Card"}),(0,n.jsx)("span",{className:"text-xs text-gray-400",children:"ar"===a?"قريباً":"Soon"})]}),(0,n.jsxs)("button",{onClick:()=>{q("instapay"),$(null)},className:`p-4 rounded-xl border-2 transition flex flex-col items-center gap-2 ${"instapay"===A?"border-[#008069] bg-[#008069]/5":"border-gray-200 hover:border-gray-300"}`,children:[(0,n.jsx)(g.Z,{className:`w-6 h-6 ${"instapay"===A?"text-[#008069]":"text-gray-400"}`}),(0,n.jsx)("span",{className:`text-sm font-medium ${"instapay"===A?"text-[#008069]":"text-gray-600"}`,children:"InstaPay"})]}),(0,n.jsxs)("button",{onClick:()=>{q("vodafone"),$(null)},className:`p-4 rounded-xl border-2 transition flex flex-col items-center gap-2 ${"vodafone"===A?"border-[#008069] bg-[#008069]/5":"border-gray-200 hover:border-gray-300"}`,children:[(0,n.jsx)(w.Z,{className:`w-6 h-6 ${"vodafone"===A?"text-[#008069]":"text-gray-400"}`}),(0,n.jsx)("span",{className:`text-sm font-medium ${"vodafone"===A?"text-[#008069]":"text-gray-600"}`,children:"Vodafone"})]})]}),O&&("instapay"===A||"vodafone"===A)&&(0,n.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4 space-y-4",children:[(0,n.jsx)("p",{className:"text-amber-800 font-medium text-center",children:"ar"===a?"✅ تم منحك صلاحية 24 ساعة مؤقتة":"✅ You have 24h temporary access"}),(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsxs)("a",{href:O.payment_link,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 bg-blue-600 text-white py-3 px-4 rounded-xl font-medium hover:bg-blue-700",children:[(0,n.jsx)(v.Z,{className:"w-5 h-5"}),"ar"===a?"افتح رابط الدفع":"Open Payment Link"]}),(0,n.jsxs)("a",{href:O.whatsapp_link,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 bg-[#25D366] text-white py-3 px-4 rounded-xl font-medium hover:bg-[#1ebe57]",children:[(0,n.jsx)(j.Z,{className:"w-5 h-5"}),"ar"===a?"أرسل السكرين شوت":"Send Screenshot"]})]}),(0,n.jsx)("p",{className:"text-sm text-gray-500 text-center",children:"ar"===a?"بعد الدفع، أرسل سكرين شوت التحويل على الواتساب":"After payment, send the screenshot via WhatsApp"})]}),(!O||"card"===A)&&(0,n.jsx)("button",{onClick:handlePayment,disabled:C,className:"w-full bg-[#008069] hover:bg-[#006a58] text-white font-bold py-4 px-6 rounded-xl transition disabled:opacity-50 disabled:cursor-not-allowed",children:C?(0,n.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,n.jsx)("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),(0,n.jsx)("span",{children:"ar"===a?"جاري التحميل...":"Loading..."})]}):"card"===A?"ar"===a?"ادفع الآن":"Pay Now":"ar"===a?"تأكيد الدفع":"Confirm Payment"})]}),_.length>0&&(0,n.jsxs)("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[(0,n.jsx)("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:"ar"===a?"سجل المدفوعات":"Payment History"}),(0,n.jsx)("div",{className:"space-y-3",children:_.map(e=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"font-medium text-gray-800",children:[e.amount," EGP"]}),(0,n.jsx)("p",{className:"text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("ar"===a?"ar-EG":"en-US")})]}),(0,n.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${"success"===e.status?"bg-green-100 text-green-700":"pending"===e.status?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:"success"===e.status?"ar"===a?"ناجح":"Success":"pending"===e.status?"ar"===a?"قيد الانتظار":"Pending":"ar"===a?"فشل":"Failed"})]},e.id))})]})]})}},96962:(e,t,a)=>{"use strict";a.r(t),a.d(t,{getPaymentHistory:()=>getPaymentHistory,getSubscriptionStatus:()=>getSubscriptionStatus,initiateManualPayment:()=>initiateManualPayment,initiatePayment:()=>initiatePayment});var n=a(58081),s=a(82610),r=a(12713);async function getSubscriptionStatus(){let e=await (0,s.getSession)();if(!e||!e.id)return{id:null,status:"inactive",expiresAt:null,daysRemaining:null,isReadOnly:!0,amount:100,isFirstSubscription:!0};let t=(0,r.createClient)("https://bwezqrjwdrobztgeutji.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ3ZXpxcmp3ZHJvYnp0Z2V1dGppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxMzg0MDIsImV4cCI6MjA4MTcxNDQwMn0.nsiHXb7EW4KmZqlPy2tZ1-5RTLUsfOMcNa9Wq3xtPeQ"),{data:a}=await t.from("subscriptions").select("*").eq("user_id",e.id).single();if(!a)return{id:null,status:"inactive",expiresAt:null,daysRemaining:null,isReadOnly:!0,amount:100,isFirstSubscription:!0};let n=null,i="active",d=!1,c=new Date;if(a.expires_at){let e=new Date(a.expires_at),t=a.grace_ends_at?new Date(a.grace_ends_at):null;n=Math.ceil((e.getTime()-c.getTime())/864e5),c>e?(i=t&&c<=t?"grace":"expired",d=!0):(i="active",d=!1)}else if(a.pending_expires_at){let e=new Date(a.pending_expires_at);c<=e?(i="active",d=!1,n=null):(i="inactive",d=!0)}else i="inactive",d=!0;let o=a.is_first_subscription?100:300;return{id:a.id,status:i,expiresAt:a.expires_at,daysRemaining:n,isReadOnly:d,amount:o,isFirstSubscription:!!a.is_first_subscription}}async function initiatePayment(e="card"){let t=await (0,s.getSession)();if(!t||!t.id)return{error:"Unauthorized"};try{let a=await fetch("https://bwezqrjwdrobztgeutji.supabase.co/functions/v1/paymob-create-intention",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.SUPABASE_SERVICE_ROLE_KEY}`},body:JSON.stringify({user_id:t.id,payment_method:e})});if(!a.ok){let e=await a.json();return{error:e.error||"Payment initiation failed"}}let n=await a.json();return{success:!0,...n}}catch(e){return console.error("Payment initiation error:",e),{error:e.message||"Payment initiation failed"}}}async function getPaymentHistory(){let e=await (0,s.getSession)();if(!e||!e.id)return{transactions:[]};let t=(0,r.createClient)("https://bwezqrjwdrobztgeutji.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ3ZXpxcmp3ZHJvYnp0Z2V1dGppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxMzg0MDIsImV4cCI6MjA4MTcxNDQwMn0.nsiHXb7EW4KmZqlPy2tZ1-5RTLUsfOMcNa9Wq3xtPeQ"),{data:a}=await t.from("payment_transactions").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(10);return{transactions:a||[]}}async function initiateManualPayment(e,t="monthly"){let a=await (0,s.getSession)();if(!a||!a.id)return{error:"Unauthorized"};try{let n=await fetch("https://bwezqrjwdrobztgeutji.supabase.co/functions/v1/manual-payment-request",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.SUPABASE_SERVICE_ROLE_KEY}`},body:JSON.stringify({user_id:a.id,payment_method:e,subscription_period:t})});if(!n.ok){let e=await n.json();return{error:e.error||"Manual payment request failed"}}let s=await n.json();return{success:!0,...s}}catch(e){return console.error("Manual payment error:",e),{error:e.message||"Manual payment request failed"}}}(0,a(89635).ensureServerEntryExports)([getSubscriptionStatus,initiatePayment,getPaymentHistory,initiateManualPayment]),(0,n.createActionProxy)("bf0e1330aea4c984fb4b6c37d8690d64d88b26aa",null,getSubscriptionStatus),(0,n.createActionProxy)("b2c3b2c0c4cd18681f1c6b705e0769c170ac9b7a",null,initiatePayment),(0,n.createActionProxy)("34931017bbcf5e6dc00900cffda6e6f7cbf70b63",null,getPaymentHistory),(0,n.createActionProxy)("5f03e88b372d5f6e8284bc0ce0e0f38ece698a10",null,initiateManualPayment)},52469:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>i,__esModule:()=>r,default:()=>c});var n=a(64074);let s=(0,n.createProxy)(String.raw`D:\whatsou\apps\web\app\dashboard\subscription\page.tsx`),{__esModule:r,$$typeof:i}=s,d=s.default,c=d}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[771,7124,4304,6819,9328,4288,1980,265,3665,5131,3345,3532,8690,3517,8444,7952,7286,2855],()=>__webpack_exec__(54288));module.exports=a})();