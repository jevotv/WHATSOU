"use strict";(()=>{var e={};e.id=7528,e.ids=[7528],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},94320:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>m,originalPathname:()=>g,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>p,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>_});var a={};r.r(a),r.d(a,{GET:()=>GET,OPTIONS:()=>OPTIONS,POST:()=>POST}),r(44388);var i=r(15789),s=r(74902),o=r(70914),n=r(70106),u=r(19717);async function OPTIONS(){return o.Z.json({},{status:200})}async function GET(e){return(0,n.Q)(e,async(e,t)=>{let r=(0,u.t)(),{data:a,error:i}=await r.from("stores").select("id").eq("user_id",t.userId).single();if(i||!a)return o.Z.json({error:"Store not found"},{status:404});let{data:s,error:n}=await r.from("products").select("*, images:product_images(*)").eq("store_id",a.id).order("created_at",{ascending:!1});if(n)return o.Z.json({error:n.message},{status:500});if(s&&s.length>0){let e=s.map(e=>e.id),{data:t}=await r.from("product_variants").select("*").in("product_id",e),a=s.map(e=>({...e,variants:t?.filter(t=>t.product_id===e.id)||[]}));return o.Z.json({products:a})}return o.Z.json({products:[]})})}async function POST(e){return(0,n.Q)(e,async(e,t)=>{let r=(0,u.t)(),{data:a,error:i}=await r.from("stores").select("id").eq("user_id",t.userId).single();if(i||!a)return o.Z.json({error:"Store not found"},{status:404});let s=await e.json();if(s.images&&s.images.length>5)return o.Z.json({error:"Maximum 5 images allowed per product"},{status:400});let n=s.images?.[0]?.url||null,d=s.images?.[0]?.thumbnailUrl||null,{data:l,error:c}=await r.from("products").insert({store_id:a.id,name:s.name,description:s.description,current_price:s.current_price,original_price:s.original_price,category:s.category,quantity:s.quantity,unlimited_stock:s.unlimited_stock,image_url:n,thumbnail_url:d,options:s.options}).select().single();if(c)return o.Z.json({error:c.message},{status:500});if(s.images&&s.images.length>0){let e=s.images.map((e,t)=>({product_id:l.id,image_url:e.url,thumbnail_url:e.thumbnailUrl,display_order:t,alt_text:e.altText||null}));await r.from("product_images").insert(e)}if(s.variants&&s.variants.length>0){let e=s.variants.map(e=>({product_id:l.id,option_values:e.option_values,price:e.price,quantity:e.quantity,unlimited_stock:s.unlimited_stock,sku:e.sku,image_index:e.image_index??null}));await r.from("product_variants").insert(e)}return o.Z.json({success:!0,product:l})})}let d=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/dashboard/products/route",pathname:"/api/dashboard/products",filename:"route",bundlePath:"app/api/dashboard/products/route"},resolvedPagePath:"D:\\whatsou\\apps\\web\\app\\api\\dashboard\\products\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:p,headerHooks:m,staticGenerationBailout:_}=d,g="/api/dashboard/products/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[771,1861,2605,3926,914,497,5250,9717,106],()=>__webpack_exec__(94320));module.exports=r})();