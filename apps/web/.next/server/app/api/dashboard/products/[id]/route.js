"use strict";(()=>{var e={};e.id=7002,e.ids=[7002],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},98535:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>m,originalPathname:()=>g,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>p,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>_});var a={};r.r(a),r.d(a,{DELETE:()=>DELETE,OPTIONS:()=>OPTIONS,PUT:()=>PUT}),r(44388);var i=r(15789),s=r(74902),o=r(70914),u=r(70106),n=r(19717);async function OPTIONS(){return o.Z.json({},{status:200})}async function PUT(e,{params:t}){return(0,u.Q)(e,async(e,r)=>{let a=(0,n.t)(),i=t.id,{data:s}=await a.from("products").select("store_id, stores!inner(user_id)").eq("id",i).single();if(!s)return o.Z.json({error:"Product not found"},{status:404});if(s.stores?.user_id!==r.userId)return o.Z.json({error:"Unauthorized"},{status:403});let u=await e.json();if(u.images&&u.images.length>5)return o.Z.json({error:"Maximum 5 images allowed per product"},{status:400});let d=u.images?.[0]?.url||null,l=u.images?.[0]?.thumbnailUrl||null,{error:c}=await a.from("products").update({name:u.name,description:u.description,current_price:u.current_price,original_price:u.original_price,category:u.category,quantity:u.quantity,unlimited_stock:u.unlimited_stock,image_url:d,thumbnail_url:l,options:u.options,updated_at:new Date().toISOString()}).eq("id",i);if(c)return o.Z.json({error:c.message},{status:500});if(await a.from("product_images").delete().eq("product_id",i),u.images&&u.images.length>0){let e=u.images.map((e,t)=>({product_id:i,image_url:e.url,thumbnail_url:e.thumbnailUrl,display_order:t,alt_text:e.altText||null}));await a.from("product_images").insert(e)}if(void 0!==u.variants&&(await a.from("product_variants").delete().eq("product_id",i),u.variants.length>0)){let e=u.variants.map(e=>({product_id:i,option_values:e.option_values,price:e.price,quantity:e.quantity,unlimited_stock:u.unlimited_stock,sku:e.sku,image_index:e.image_index??null}));await a.from("product_variants").insert(e)}return o.Z.json({success:!0})})}async function DELETE(e,{params:t}){return(0,u.Q)(e,async(e,r)=>{let a=(0,n.t)(),i=t.id,{data:s}=await a.from("products").select("store_id, stores!inner(user_id)").eq("id",i).single();if(!s)return o.Z.json({error:"Product not found"},{status:404});if(s.stores?.user_id!==r.userId)return o.Z.json({error:"Unauthorized"},{status:403});let{error:u}=await a.from("products").delete().eq("id",i);return u?o.Z.json({error:u.message},{status:500}):o.Z.json({success:!0})})}let d=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/dashboard/products/[id]/route",pathname:"/api/dashboard/products/[id]",filename:"route",bundlePath:"app/api/dashboard/products/[id]/route"},resolvedPagePath:"D:\\whatsou\\apps\\web\\app\\api\\dashboard\\products\\[id]\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:p,headerHooks:m,staticGenerationBailout:_}=d,g="/api/dashboard/products/[id]/route"}};var t=require("../../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[771,1861,2605,3926,914,497,5250,9717,106],()=>__webpack_exec__(98535));module.exports=r})();