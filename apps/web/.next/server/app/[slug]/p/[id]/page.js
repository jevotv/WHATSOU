(()=>{var e={};e.id=8939,e.ids=[8939],e.modules={21841:e=>{"use strict";e.exports=require("@aws-sdk/client-s3")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},41790:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page-experimental.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},6113:e=>{"use strict";e.exports=require("crypto")},71017:e=>{"use strict";e.exports=require("path")},57310:e=>{"use strict";e.exports=require("url")},51466:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var a=s(66965),r=s(74902),i=s(36408),n=s.n(i),l=s(14346),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["[slug]",{children:["p",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,37513)),"D:\\whatsou\\apps\\web\\app\\[slug]\\p\\[id]\\page.tsx"]}]},{}]},{}]},{"not-found":[()=>Promise.resolve().then(s.bind(s,90806)),"D:\\whatsou\\apps\\web\\app\\[slug]\\not-found.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,47814))).default(e)],apple:[async e=>(await Promise.resolve().then(s.bind(s,90133))).default(e)],openGraph:[async e=>(await Promise.resolve().then(s.bind(s,3774))).default(e)],twitter:[],manifest:"/manifest.webmanifest"}}]},{layout:[()=>Promise.resolve().then(s.bind(s,27734)),"D:\\whatsou\\apps\\web\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35438,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,47814))).default(e)],apple:[async e=>(await Promise.resolve().then(s.bind(s,90133))).default(e)],openGraph:[async e=>(await Promise.resolve().then(s.bind(s,3774))).default(e)],twitter:[],manifest:"/manifest.webmanifest"}}],d=["D:\\whatsou\\apps\\web\\app\\[slug]\\p\\[id]\\page.tsx"],u="/[slug]/p/[id]/page",m={require:s,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/[slug]/p/[id]/page",pathname:"/[slug]/p/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},30327:(e,t,s)=>{Promise.resolve().then(s.bind(s,28417)),Promise.resolve().then(s.t.bind(s,76230,23))},28417:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>ProductDetailClient});var a=s(84196),r=s(78726),i=s(27973),n=s(74555),l=s(12428),o=s(2420),c=s(64690),d=s(86442),u=s(2719),m=s(11225),p=s(58406),x=s(67043),h=s(28467),g=s(16538),f=s(75631),b=s(19328),y=s.n(b),v=s(25413),w=s(10204),_=s(97487),j=s(65714),N=s(22548);function ProductDetailClient({store:e,product:t}){let[s,b]=(0,r.useState)({}),[k,S]=(0,r.useState)(1),[P,q]=(0,r.useState)(!1),[O,C]=(0,r.useState)([]),[$,M]=(0,r.useState)(null),[Z,E]=(0,r.useState)(0),D=(0,r.useRef)(null),{addItem:I,totalItems:G}=(0,i.useCart)(),L=(0,n.useRouter)(),{toast:F}=(0,v.pm)(),{t:A}=(0,_.Z)(),{user:T,loading:V}=(0,j.useAuth)(),z=T?.id===e.user_id,H=t.options&&t.options.length>0,R=t.original_price&&t.original_price>t.current_price,J=R?Math.round((t.original_price-t.current_price)/t.original_price*100):0,W=t.images&&t.images.length>0?t.images.sort((e,t)=>e.display_order-t.display_order).map(e=>e.image_url):[t.image_url].filter(Boolean),B={"@context":"https://schema.org","@type":"Product",name:t.name,description:t.description,image:W,offers:{"@type":"Offer",price:t.current_price,priceCurrency:"EGP",availability:t.unlimited_stock||t.quantity>0?"https://schema.org/InStock":"https://schema.org/OutOfStock"}};(0,r.useEffect)(()=>{H&&loadVariants()},[t.id,H]);let loadVariants=async()=>{let{data:e}=await l.O.from("product_variants").select("*").eq("product_id",t.id);if(e){let t=e.map(e=>({...e,option_values:Object.fromEntries(Object.entries(e.option_values||{}).map(([e,t])=>[String(e),String(t)]))}));C(t)}};(0,r.useEffect)(()=>{if(!H||0===O.length){M(null);return}let e=t.options.every(e=>s[e.name]);if(!e){M(null);return}let a=O.find(e=>Object.entries(s).every(([t,s])=>String(e.option_values[t]||"")===String(s)));M(a||null)},[s,O,H,t.options]);let X=$?$.price:t.current_price,K=t.unlimited_stock?999999:$?$.unlimited_stock?999999:$.quantity:H&&O.length>0?O.reduce((e,t)=>e+t.quantity,0):t.quantity,allOptionsSelected=()=>!H||t.options.every(e=>s[e.name]),isOptionValueAvailable=(e,t)=>!H||0===O.length||O.some(a=>{if(String(a.option_values[e]||"")!==String(t)||!a.unlimited_stock&&a.quantity<=0)return!1;for(let[t,r]of Object.entries(s))if(t!==e&&String(a.option_values[t]||"")!==String(r))return!1;return!0}),Q=(0,r.useRef)([]),U=(0,r.useCallback)(e=>{let t=Q.current[e];t&&(t.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"}),E(e))},[]);(0,r.useEffect)(()=>{if($&&null!==$.image_index&&void 0!==$.image_index){let e=$.image_index;e>=0&&e<W.length&&U(e)}},[$,W.length,U]);let Y=(0,r.useCallback)(()=>{if(D.current){let e=D.current,t=e.scrollLeft,s=e.clientWidth,a=Math.round(t/s);a!==Z&&a>=0&&a<W.length&&E(a)}},[Z,W.length]);return(0,a.jsxs)("div",{className:"min-h-screen bg-[#f6f8f6] pb-24",children:[(0,a.jsx)("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(B)}}),!V&&z&&(0,a.jsx)(N.Z,{}),(0,a.jsx)("header",{className:"sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-gray-100",children:(0,a.jsx)("div",{className:"max-w-[1200px] mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("button",{onClick:()=>L.back(),className:"flex items-center gap-2 text-gray-600 hover:text-[#111813] transition group",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-gray-200 transition-colors",children:(0,a.jsx)(c.Z,{className:"w-5 h-5 text-gray-700"})}),(0,a.jsx)("span",{className:"font-bold hidden sm:inline",children:A("common.back")})]}),(0,a.jsx)("h1",{className:"text-lg font-bold text-[#111813] truncate max-w-[200px] sm:max-w-md",children:e.name})]})})}),(0,a.jsx)("main",{className:"max-w-[1200px] mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"relative aspect-square sm:aspect-[4/3] lg:aspect-square bg-white rounded-3xl overflow-hidden shadow-sm border border-gray-100 group",children:[W.length>0?(0,a.jsx)("div",{ref:D,onScroll:Y,className:"w-full h-full flex overflow-x-auto snap-x snap-mandatory scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:W.map((e,s)=>(0,a.jsx)("div",{ref:e=>{Q.current[s]=e},className:"min-w-full w-full flex-shrink-0 snap-center relative h-full",children:(0,a.jsx)(y(),{src:e,alt:`${t.name} - Image ${s+1}`,fill:!0,className:"object-cover",priority:0===s})},s))}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-50",children:(0,a.jsx)(d.Z,{className:"w-32 h-32 text-gray-300"})}),W.length>1&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>U(Math.max(0,Z-1)),className:"absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 backdrop-blur rounded-full flex items-center justify-center shadow-md opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-0",disabled:0===Z,children:(0,a.jsx)(u.Z,{className:"w-6 h-6 text-gray-800"})}),(0,a.jsx)("button",{onClick:()=>U(Math.min(W.length-1,Z+1)),className:"absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 backdrop-blur rounded-full flex items-center justify-center shadow-md opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-0",disabled:Z===W.length-1,children:(0,a.jsx)(m.Z,{className:"w-6 h-6 text-gray-800"})})]}),(0,a.jsxs)("div",{className:"absolute top-6 left-6 flex flex-col gap-2 pointer-events-none",children:[R&&(0,a.jsxs)("div",{className:"bg-[#E4405F] text-white px-4 py-1.5 rounded-full text-sm font-bold shadow-md",children:["-",J,"%"]}),t.unlimited_stock||K>0?(0,a.jsxs)("div",{className:"bg-[#19e65e] text-[#111813] px-4 py-1.5 rounded-full text-sm font-bold shadow-md flex items-center gap-1.5",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-[#111813] animate-pulse"}),A("storefront.in_stock")]}):(0,a.jsx)("div",{className:"bg-gray-900 text-white px-4 py-1.5 rounded-full text-sm font-bold shadow-md",children:A("storefront.out_of_stock")})]}),W.length>1&&(0,a.jsx)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2",children:W.map((e,t)=>(0,a.jsx)("div",{className:`w-2 h-2 rounded-full transition-all ${t===Z?"bg-white w-4":"bg-white/50"}`},t))})]}),W.length>1&&(0,a.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:W.map((e,t)=>(0,a.jsx)("button",{onClick:()=>U(t),className:`relative w-20 h-20 rounded-xl overflow-hidden flex-shrink-0 border-2 transition-all ${t===Z?"border-[#19e65e]":"border-transparent opacity-70 hover:opacity-100"}`,children:(0,a.jsx)(y(),{src:e,alt:`Thumbnail ${t+1}`,fill:!0,className:"object-cover"})},t))})]}),(0,a.jsx)("div",{className:"flex flex-col gap-8",children:(0,a.jsx)("div",{className:"bg-white rounded-3xl p-6 sm:p-8 shadow-sm border border-gray-100 h-full",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl sm:text-4xl font-extrabold text-[#111813] mb-4 leading-tight",children:t.name}),H&&!allOptionsSelected()&&(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1 font-medium",children:A("storefront.starting_from")}),(0,a.jsxs)("div",{className:"flex items-baseline gap-3 flex-wrap",children:[(0,a.jsxs)("span",{className:"text-4xl font-black text-[#111813]",children:[X.toFixed(0)," ",(0,a.jsx)("span",{className:"text-lg font-bold text-gray-500",children:A("common.currency")})]}),R&&(0,a.jsxs)("span",{className:"text-xl text-gray-400 line-through font-medium",children:[t.original_price.toFixed(0)," ",(0,a.jsx)("span",{className:"text-sm",children:A("common.currency")})]})]})]}),t.description&&(0,a.jsx)("div",{className:"prose prose-sm sm:prose-base text-gray-600 leading-relaxed border-t border-gray-100 pt-6",children:(0,a.jsx)("p",{children:t.description})}),H&&(0,a.jsxs)("div",{className:"space-y-6 pt-6 border-t border-gray-100",children:[t.options.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-[#111813] uppercase tracking-wide mb-3",children:e.name}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2.5",children:e.values.map(t=>{let r=isOptionValueAvailable(e.name,t),i=s[e.name]===t;return(0,a.jsxs)("button",{onClick:()=>b(s=>{if(s[e.name]===t){let t={...s};return delete t[e.name],t}return{...s,[e.name]:t}}),disabled:!r,className:`px-5 py-2.5 rounded-full text-sm font-bold transition-all border-2 ${i?"border-[#19e65e] bg-[#19e65e]/10 text-[#111813] shadow-sm":r?"border-gray-200 bg-white text-gray-700 hover:border-gray-300":"border-gray-100 bg-gray-50 text-gray-300 cursor-not-allowed decoration-slice"}`,children:[t,i&&(0,a.jsx)(p.Z,{className:"w-3.5 h-3.5 inline-block ml-1.5"})]},t)})})]},e.name)),$?(0,a.jsxs)("div",{className:"bg-[#19e65e]/10 border border-[#19e65e]/20 rounded-2xl p-4 flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-[#19e65e] flex items-center justify-center shrink-0",children:(0,a.jsx)(p.Z,{className:"w-5 h-5 text-[#111813]"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-[#111813] font-bold text-sm",children:A("storefront.variant_selected",{options:Object.values($.option_values||{}).map(e=>String(e)).join(" / "),price:$.price.toFixed(2)})}),(0,a.jsx)("p",{className:"text-gray-600 text-xs mt-0.5",children:$.unlimited_stock?A("storefront.in_stock"):A("storefront.items_in_stock",{count:$.quantity})})]})]}):allOptionsSelected()&&H&&O.length>0&&(0,a.jsxs)("div",{className:"bg-red-50 border border-red-100 rounded-2xl p-4 text-red-600 font-medium text-sm flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),A("storefront.variant_unavailable")]})]}),(0,a.jsxs)("div",{className:"space-y-4 pt-6 mt-auto",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("span",{className:"text-sm font-bold text-[#111813] uppercase tracking-wide",children:A("storefront.quantity")})}),(0,a.jsxs)("div",{className:"flex gap-3 sm:gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center bg-gray-100 rounded-full p-1 h-16 border border-gray-200 min-w-[130px] sm:min-w-[160px] shrink-0",children:[(0,a.jsx)("button",{onClick:()=>S(Math.max(1,k-1)),className:"w-12 sm:w-16 h-full flex items-center justify-center rounded-full bg-white shadow-sm text-[#111813] hover:bg-gray-50 active:scale-95 transition-all",children:(0,a.jsx)(x.Z,{className:"w-5 h-5"})}),(0,a.jsx)("span",{className:"flex-1 text-center text-xl font-bold text-[#111813]",children:k}),(0,a.jsx)("button",{onClick:()=>S(Math.min(K,k+1)),disabled:!t.unlimited_stock&&k>=K,className:`w-12 sm:w-16 h-full flex items-center justify-center rounded-full bg-white shadow-sm text-[#111813] hover:bg-gray-50 active:scale-95 transition-all ${!t.unlimited_stock&&k>=K?"opacity-50 cursor-not-allowed":""}`,children:(0,a.jsx)(h.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)(o.z,{onClick:()=>{if(!allOptionsSelected()){F({title:A("storefront.missing_options"),description:A("storefront.missing_options_desc"),variant:"destructive"});return}if(H&&O.length>0&&!$){F({title:A("storefront.variant_unavailable"),description:A("storefront.variant_unavailable"),variant:"destructive"});return}if(!t.unlimited_stock&&k>K){F({title:A("storefront.not_enough_stock"),description:A("storefront.not_enough_stock_desc",{count:K}),variant:"destructive"});return}I({product_id:t.id,variant_id:$?.id,product_name:t.name,quantity:k,price:X,selected_options:s,image_url:t.thumbnail_url||t.image_url}),F({title:A("storefront.added_to_cart"),description:A("storefront.added_to_cart_desc",{quantity:k,name:t.name})}),q(!0)},disabled:!(allOptionsSelected()&&(!H||!(O.length>0)||$)&&(t.unlimited_stock||!(K<=0))),className:"flex-1 h-16 rounded-full bg-[#111813] hover:bg-black text-white text-lg font-bold shadow-xl hover:shadow-2xl hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:hover:scale-100 disabled:shadow-none",children:[(0,a.jsx)(g.Z,{className:"w-5 h-5 mr-2.5"}),allOptionsSelected()?K<=0&&!t.unlimited_stock?A("storefront.out_of_stock"):A("storefront.add_to_cart"):A("storefront.select_options")]})]})]})]})})})]})}),(0,a.jsx)("div",{className:"fixed bottom-6 left-6 z-40 hidden md:flex",children:(0,a.jsxs)("a",{href:"https://www.whatsou.com",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center h-12 px-5 gap-2 rounded-full bg-[#25D366] text-white shadow-lg hover:bg-[#20bd5a] transition-transform hover:scale-105 active:scale-95",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"font-bold text-sm",children:A("common.powered_by")})]})}),(0,a.jsx)("div",{className:"fixed bottom-6 right-6 z-40",children:(0,a.jsxs)("button",{onClick:()=>q(!0),className:"flex items-center justify-center h-14 w-auto px-6 gap-3 rounded-full bg-[#19e65e] text-[#111813] shadow-[0_8px_30px_rgb(25,230,94,0.3)] hover:shadow-[0_8px_40px_rgb(25,230,94,0.4)] hover:bg-[#19e65e]/90 transition-all hover:scale-105 active:scale-95",children:[(0,a.jsx)(g.Z,{className:"w-6 h-6"}),G>0&&(0,a.jsx)("span",{className:"font-exrabold text-lg",children:G})]})}),(0,a.jsx)(w.Z,{open:P,onClose:()=>q(!1),store:e})]})}},37513:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>ProductPage,dynamic:()=>u,generateMetadata:()=>generateMetadata});var a=s(25620),r=s(13574),i=s(19717),n=s(64074);let l=(0,n.createProxy)(String.raw`D:\whatsou\apps\web\components\storefront\ProductDetailClient.tsx`),{__esModule:o,$$typeof:c}=l,d=l.default,u="force-dynamic";async function generateMetadata({params:e}){let t=(0,i.t)(),{data:s}=await t.from("products").select("name, description, image_url").eq("id",e.id).maybeSingle();if(!s)return{title:"Product Not Found"};let{data:a}=await t.from("stores").select("name").eq("slug",e.slug).maybeSingle(),r=a?.name||"WhatSou",n=`https://whatsou.com/${e.slug}/p/${e.id}`;return{title:`${s.name} | ${r}`,description:s.description,alternates:{canonical:n},openGraph:{title:s.name,description:s.description||void 0,images:s.image_url?[{url:s.image_url}]:[]}}}async function getProductData(e,t){let s=(0,i.t)(),{data:a}=await s.from("stores").select("*").eq("slug",e).maybeSingle();if(!a)return null;let{data:r}=await s.from("products").select("*, images:product_images(*)").eq("id",t).eq("store_id",a.id).maybeSingle();return r?{store:a,product:r}:null}async function ProductPage({params:e}){let t=await getProductData(e.slug,e.id);t||(0,r.notFound)();let s={"@context":"https://schema.org","@type":"Product",name:t.product.name,image:t.product.image_url,description:t.product.description,offers:{"@type":"Offer",price:t.product.current_price,priceCurrency:"EGP",availability:t.product.unlimited_stock||t.product.quantity>0?"https://schema.org/InStock":"https://schema.org/OutOfStock",url:`https://whatsou.com/${e.slug}/p/${e.id}`}},i={"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"Home",item:"https://whatsou.com"},{"@type":"ListItem",position:2,name:t.store.name,item:`https://whatsou.com/${e.slug}`},{"@type":"ListItem",position:3,name:t.product.name,item:`https://whatsou.com/${e.slug}/p/${e.id}`}]};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(s)}}),(0,a.jsx)("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(i)}}),(0,a.jsx)(d,{store:t.store,product:t.product})]})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[771,3926,497,7124,4304,6819,9328,4288,1980,265,3665,129,6762,7182,8721,9626,2627,9717,3517,8444,4378,9406,8410,2428,6963],()=>__webpack_exec__(51466));module.exports=s})();