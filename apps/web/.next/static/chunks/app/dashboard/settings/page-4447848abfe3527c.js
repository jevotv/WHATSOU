(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3455],{6721:function(e,t,s){Promise.resolve().then(s.bind(s,7999))},7999:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return SettingsPage}});var r=s(8708),a=s(5444),n=s(6803),i=s(2859),l=s(7321),o=s(4896),c=s(5654),d=s(9861),u=s(9391),h=s(315),m=s(1452),g=s(7470),p=s(4142),x=s(3273),f=s(7433),b=s(6528),y=s(2738),v=s(8073),j=s(265),N=s(2272),w=s(6072),_=s.n(w),k=s(6811),S=s(6923),C=s(8681),P=s(8484),T=s(3727),I=s(2979),A=s(9824),E=s(6370),z=s(7896),R=s(8163),O=s(5018),Z=s(5860),D=s(3883);let U=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(O.fC,{className:(0,D.cn)("grid gap-2",s),...a,ref:t})});U.displayName=O.fC.displayName;let V=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(O.ck,{ref:t,className:(0,D.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:(0,r.jsx)(O.z$,{className:"flex items-center justify-center",children:(0,r.jsx)(Z.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})})});V.displayName=O.ck.displayName;var F=s(7917),Q=s(7643),G=s(9375),B=s(9576),L=s(372),M=s(733);let q=M.fC,Y=M.xz,$=a.forwardRef((e,t)=>{let{className:s,align:a="center",sideOffset:n=4,...i}=e;return(0,r.jsx)(M.h_,{children:(0,r.jsx)(M.VY,{ref:t,align:a,sideOffset:n,className:(0,D.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i})})});$.displayName=M.VY.displayName;var H=s(6005);let W=(0,H.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Badge(e){let{className:t,variant:s,...a}=e;return(0,r.jsx)("div",{className:(0,D.cn)(W({variant:s}),t),...a})}function StoreShippingSettings(e){let{shippingConfig:t,freeShippingThreshold:s,onConfigChange:n,onThresholdChange:i}=e,{t:c,direction:u}=(0,S.Z)(),[h,m]=(0,a.useState)([]),[g,p]=(0,a.useState)([]),[f,b]=(0,a.useState)(!0),[y,j]=(0,a.useState)(null),[N,w]=(0,a.useState)(null),[_,k]=(0,a.useState)(""),[P,T]=(0,a.useState)(!1),[I,A]=(0,a.useState)(""),[z,R]=(0,a.useState)(!1),[O,Z]=(0,a.useState)(new Set),[M,H]=(0,a.useState)(""),[W,J]=(0,a.useState)(!1);(0,a.useEffect)(()=>{fetchLocations()},[]);let fetchLocations=async()=>{try{let e=await C.h.get("/api/locations");e.success&&(e.cities&&m(e.cities),e.districts&&p(e.districts))}catch(e){console.error("Error fetching locations:",e)}finally{b(!1)}},handleTypeChange=e=>{let t;switch(e){case"none":t={type:"none"};break;case"nationwide":t={type:"nationwide",price:0};break;case"by_city":t={type:"by_city",rates:{}};break;case"by_district":t={type:"by_district",rates:{}};break;default:return}n(t)},handleNationwidePriceChange=e=>{n({type:"nationwide",price:parseFloat(e)||0})},handleRemoveRate=e=>{if("by_city"===t.type||"by_district"===t.type){let s={...t.rates};delete s[e],n({...t,rates:s})}},handleToggleSelect=e=>{let t=new Set(O);t.has(e)?t.delete(e):t.add(e),Z(t)},getCityName=e=>{let t=h.find(t=>t.id===parseInt(e));return"rtl"===u?null==t?void 0:t.name_ar:null==t?void 0:t.name_en},getDistrictName=e=>{let t=g.find(t=>t.id===parseInt(e)),s=h.find(e=>e.id===(null==t?void 0:t.city_id)),r="rtl"===u?null==t?void 0:t.name_ar:null==t?void 0:t.name_en,a="rtl"===u?null==s?void 0:s.name_ar:null==s?void 0:s.name_en;return"".concat(a," - ").concat(r)},X=(0,a.useMemo)(()=>y?g.filter(e=>e.city_id===y):[],[y,g]);return(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[(0,r.jsx)(x.Z,{className:"w-5 h-5 text-[#008069]"}),"rtl"===u?"إعدادات الشحن":"Shipping Settings"]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(U,{value:t.type,onValueChange:handleTypeChange,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{onClick:()=>handleTypeChange("none"),className:(0,D.cn)("flex items-start space-x-3 space-x-reverse rounded-lg border p-4 cursor-pointer hover:bg-gray-50 transition-colors","none"===t.type&&"border-[#008069] bg-green-50/50"),children:[(0,r.jsx)(V,{value:"none",id:"type-none",className:"mt-1"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(d._,{htmlFor:"type-none",className:"font-bold cursor-pointer block",children:"rtl"===u?"لا يوجد شحن":"No Shipping"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"rtl"===u?"تعطيل خيارات الشحن (استلام من المتجر فقط)":"Disable shipping options (Pickup only)"})]})]}),(0,r.jsxs)("div",{onClick:()=>handleTypeChange("nationwide"),className:(0,D.cn)("flex items-start space-x-3 space-x-reverse rounded-lg border p-4 cursor-pointer hover:bg-gray-50 transition-colors","nationwide"===t.type&&"border-[#008069] bg-green-50/50"),children:[(0,r.jsx)(V,{value:"nationwide",id:"type-nationwide",className:"mt-1"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(d._,{htmlFor:"type-nationwide",className:"font-bold cursor-pointer block",children:"rtl"===u?"سعر موحد":"Flat Rate"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"rtl"===u?"سعر شحن ثابت لجميع المناطق":"Fixed shipping price for all locations"})]})]}),(0,r.jsxs)("div",{onClick:()=>handleTypeChange("by_city"),className:(0,D.cn)("flex items-start space-x-3 space-x-reverse rounded-lg border p-4 cursor-pointer hover:bg-gray-50 transition-colors","by_city"===t.type&&"border-[#008069] bg-green-50/50"),children:[(0,r.jsx)(V,{value:"by_city",id:"type-city",className:"mt-1"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(d._,{htmlFor:"type-city",className:"font-bold cursor-pointer block",children:"rtl"===u?"حسب المحافظة":"By Governorate"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"rtl"===u?"تحديد سعر شحن مختلف لكل محافظة":"Set different shipping prices per governorate"})]})]}),(0,r.jsxs)("div",{onClick:()=>handleTypeChange("by_district"),className:(0,D.cn)("flex items-start space-x-3 space-x-reverse rounded-lg border p-4 cursor-pointer hover:bg-gray-50 transition-colors","by_district"===t.type&&"border-[#008069] bg-green-50/50"),children:[(0,r.jsx)(V,{value:"by_district",id:"type-district",className:"mt-1"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(d._,{htmlFor:"type-district",className:"font-bold cursor-pointer block",children:"rtl"===u?"حسب المنطقة":"By District"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"rtl"===u?"تحديد سعر شحن مفصل لكل منطقة/حي":"Set detailed shipping prices per district/area"})]})]})]}),"nationwide"===t.type&&(0,r.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-100 animate-in fade-in slide-in-from-top-2",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700 block mb-2",children:"rtl"===u?"سعر الشحن":"Shipping Price"}),(0,r.jsxs)("div",{className:"relative max-w-xs",children:[(0,r.jsx)(o.I,{type:"number",min:"0",value:t.price||"",onChange:e=>handleNationwidePriceChange(e.target.value),className:"pl-16 rtl:pl-4 rtl:pr-16 text-left rtl:text-right",placeholder:"0.00"}),(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 rtl:left-auto rtl:right-0 flex items-center px-4 pointer-events-none text-gray-500 bg-gray-100 border-r rtl:border-r-0 rtl:border-l border-gray-200 rounded-l rtl:rounded-l-none rtl:rounded-r-md",children:"EGP"})]})]}),("by_city"===t.type||"by_district"===t.type)&&(0,r.jsxs)("div",{className:"space-y-4 animate-in fade-in slide-in-from-top-2",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700",children:"rtl"===u?"أسعار المناطق":"Zone Rates"}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,r.jsxs)(q,{open:P,onOpenChange:T,children:[(0,r.jsx)(Y,{asChild:!0,children:(0,r.jsxs)(l.z,{size:"sm",className:"bg-[#008069] hover:bg-green-600",children:[(0,r.jsx)(F.Z,{className:"w-4 h-4 mr-1 rtl:mr-0 rtl:ml-1"}),"rtl"===u?"إضافة منطقة":"Add Zone"]})}),(0,r.jsx)($,{className:"w-80 p-4",align:"rtl"===u?"start":"end",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h4",{className:"font-medium leading-none",children:"rtl"===u?"إضافة سعر جديد":"Add New Rate"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d._,{children:"rtl"===u?"المحافظة":"Governorate"}),(0,r.jsxs)(L.Ph,{value:null==y?void 0:y.toString(),onValueChange:e=>{j(parseInt(e)),w(null)},children:[(0,r.jsx)(L.i4,{children:(0,r.jsx)(L.ki,{placeholder:"rtl"===u?"اختر محافظة":"Select Governorate"})}),(0,r.jsx)(L.Bw,{className:"max-h-60",children:h.map(e=>(0,r.jsx)(L.Ql,{value:e.id.toString(),children:"rtl"===u?e.name_ar:e.name_en},e.id))})]})]}),"by_district"===t.type&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d._,{children:"rtl"===u?"المنطقة":"District"}),(0,r.jsxs)(L.Ph,{value:null==N?void 0:N.toString(),onValueChange:e=>w(parseInt(e)),disabled:!y,children:[(0,r.jsx)(L.i4,{children:(0,r.jsx)(L.ki,{placeholder:"rtl"===u?"اختر منطقة":"Select District"})}),(0,r.jsx)(L.Bw,{className:"max-h-60",children:X.map(e=>(0,r.jsx)(L.Ql,{value:e.id.toString(),children:"rtl"===u?e.name_ar:e.name_en},e.id))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d._,{children:"rtl"===u?"السعر":"Price"}),(0,r.jsx)(o.I,{type:"number",min:"0",value:_,onChange:e=>k(e.target.value),placeholder:"0.00"})]}),(0,r.jsx)(l.z,{onClick:()=>{let e=parseFloat(_);isNaN(e)||("by_city"===t.type&&y?n({...t,rates:{...t.rates,[y]:e}}):"by_district"===t.type&&N&&n({...t,rates:{...t.rates,[N]:e}}),j(null),w(null),k(""),T(!1))},className:"w-full bg-[#008069] hover:bg-green-600",children:"rtl"===u?"إضافة":"Add"})]})})]}),(0,r.jsxs)(q,{open:z,onOpenChange:R,children:[(0,r.jsx)(Y,{asChild:!0,children:(0,r.jsx)(l.z,{size:"sm",variant:"outline",children:"rtl"===u?"إضافة الكل":"Add All"})}),(0,r.jsx)($,{className:"w-80 p-4",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h4",{className:"font-medium leading-none",children:"rtl"===u?"تطبيق سعر موحد":"Apply Bulk Price"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"by_city"===t.type?"rtl"===u?"سيتم إضافة جميع المحافظات بهذا السعر":"All governorates will be added with this price":"rtl"===u?"يجب اختيار محافظة أولاً لإضافة كل مناطقها":"Select a governorate first to add all its districts"}),"by_district"===t.type&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d._,{children:"rtl"===u?"المحافظة":"Governorate"}),(0,r.jsxs)(L.Ph,{value:null==y?void 0:y.toString(),onValueChange:e=>{j(parseInt(e))},children:[(0,r.jsx)(L.i4,{children:(0,r.jsx)(L.ki,{placeholder:"rtl"===u?"اختر محافظة":"Select Governorate"})}),(0,r.jsx)(L.Bw,{className:"max-h-60",children:h.map(e=>(0,r.jsx)(L.Ql,{value:e.id.toString(),children:"rtl"===u?e.name_ar:e.name_en},e.id))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d._,{children:"rtl"===u?"السعر":"Price"}),(0,r.jsx)(o.I,{type:"number",min:"0",value:I,onChange:e=>A(e.target.value),placeholder:"0.00"})]}),(0,r.jsx)(l.z,{onClick:()=>{let e=parseFloat(I);if(isNaN(e)||"by_city"!==t.type&&"by_district"!==t.type)return;let s={...t.rates};if("by_city"===t.type)h.forEach(t=>{s[t.id]=e});else if("by_district"===t.type&&y){let t=g.filter(e=>e.city_id===y);t.forEach(t=>{s[t.id]=e})}n({...t,rates:s}),R(!1),A("")},className:"w-full bg-[#008069] hover:bg-green-600",children:"rtl"===u?"تطبيق":"Apply"})]})})]}),("by_city"===t.type||"by_district"===t.type)&&Object.keys(t.rates).length>0&&(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)(l.z,{size:"sm",variant:"ghost",onClick:()=>{("by_city"===t.type||"by_district"===t.type)&&(O.size===Object.keys(t.rates).length?Z(new Set):Z(new Set(Object.keys(t.rates))))},className:"text-gray-600",children:O.size===Object.keys(t.rates).length?"rtl"===u?"إلغاء تحديد الكل":"Deselect All":"rtl"===u?"تحديد الكل":"Select All"}),O.size>0&&(0,r.jsxs)(q,{open:W,onOpenChange:J,children:[(0,r.jsx)(Y,{asChild:!0,children:(0,r.jsx)(l.z,{size:"sm",variant:"outline",className:"border-blue-200 bg-blue-50 text-blue-700 hover:bg-blue-100",children:"rtl"===u?"تحديث (".concat(O.size,")"):"Update (".concat(O.size,")")})}),(0,r.jsx)($,{className:"w-80 p-4",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h4",{className:"font-medium leading-none",children:"rtl"===u?"تحديث السعر للمحدد":"Update Price for Selected"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d._,{children:"rtl"===u?"السعر":"Price"}),(0,r.jsx)(o.I,{type:"number",min:"0",value:M,onChange:e=>H(e.target.value),placeholder:"0.00"})]}),(0,r.jsx)(l.z,{onClick:()=>{if("by_city"!==t.type&&"by_district"!==t.type)return;let e=parseFloat(M);if(isNaN(e))return;let s={...t.rates};O.forEach(t=>{s[t]=e}),n({...t,rates:s}),J(!1),H(""),Z(new Set)},className:"w-full bg-blue-600 hover:bg-blue-700",children:"rtl"===u?"تحديث":"Update"})]})})]}),(0,r.jsx)(l.z,{size:"sm",variant:"ghost",onClick:()=>{("by_city"===t.type||"by_district"===t.type)&&(n({...t,rates:{}}),Z(new Set))},className:"text-red-500 hover:text-red-600 hover:bg-red-50",children:"rtl"===u?"حذف الكل":"Clear All"})]})]})]}),(0,r.jsx)("div",{className:"border rounded-lg divide-y bg-gray-50 max-h-60 overflow-y-auto",children:("by_city"===t.type||"by_district"===t.type)&&0===Object.entries(t.rates).length?(0,r.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,r.jsx)(Q.Z,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),(0,r.jsx)("p",{children:"rtl"===u?"لم يتم إضافة مناطق بعد":"No zones added yet"})]}):("by_city"===t.type||"by_district"===t.type)&&Object.entries(t.rates).map(e=>{let[s,a]=e;return(0,r.jsxs)("div",{className:(0,D.cn)("flex items-center justify-between p-3 cursor-pointer transition-colors",O.has(s)?"bg-blue-50 border-blue-200":"hover:bg-gray-100"),onClick:()=>handleToggleSelect(s),children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:(0,D.cn)("p-2 rounded-full border",O.has(s)?"bg-blue-100 border-blue-200":"bg-white"),children:O.has(s)?(0,r.jsx)(G.Z,{className:"w-4 h-4 text-blue-600"}):(0,r.jsx)(Q.Z,{className:"w-4 h-4 text-[#008069]"})}),(0,r.jsx)("span",{className:"font-medium text-gray-700",children:"by_city"===t.type?getCityName(s):getDistrictName(s)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)(Badge,{variant:O.has(s)?"default":"secondary",className:O.has(s)?"bg-blue-600 hover:bg-blue-700":"bg-white",children:[a," EGP"]}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),handleRemoveRate(s)},className:"text-red-500 hover:bg-red-50 p-1.5 rounded-full transition-colors",children:(0,r.jsx)(v.Z,{className:"w-4 h-4"})})]})]},s)})})]}),"none"!==t.type&&(0,r.jsxs)("div",{className:"pt-6 border-t border-gray-100",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(d._,{className:"text-base font-bold text-gray-900 block",children:"rtl"===u?"شحن مجاني للطلبات الكبيرة":"Free Shipping for Large Orders"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"rtl"===u?"سيتم تطبيق شحن مجاني تلقائياً عندما يتجاوز الطلب هذا المبلغ":"Free shipping will be automatically applied when order total exceeds this amount"})]}),(0,r.jsx)(E.r,{checked:null!==s,onCheckedChange:e=>i(e?0:null)})]}),null!==s&&(0,r.jsxs)("div",{className:"mt-4 max-w-xs animate-in fade-in slide-in-from-top-1",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700 block mb-2",children:"rtl"===u?"الحد الأدنى للطلب":"Minimum Order Amount"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(o.I,{type:"number",min:"0",value:s,onChange:e=>i(parseFloat(e.target.value)||0),className:"pl-16 rtl:pl-4 rtl:pr-16 text-left rtl:text-right"}),(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 rtl:left-auto rtl:right-0 flex items-center px-4 pointer-events-none text-gray-500 bg-gray-100 border-r rtl:border-r-0 rtl:border-l border-gray-200 rounded-l rtl:rounded-l-none rtl:rounded-r-md",children:"EGP"})]})]})]})]}),(0,r.jsxs)("div",{className:"mt-8 border-t pt-6 animate-in fade-in slide-in-from-top-4",children:[(0,r.jsxs)("h4",{className:"text-sm font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,r.jsx)(B.Z,{className:"w-4 h-4"}),"rtl"===u?"معاينة للعميل":"Customer Preview"]}),(0,r.jsx)("div",{className:"bg-gray-50 border rounded-xl p-4 max-w-sm mx-auto shadow-sm",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"rtl"===u?"المنتجات":"Subtotal"}),(0,r.jsx)("span",{className:"font-medium",children:"250.00 EGP"})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"rtl"===u?"الشحن":"Shipping"}),(0,r.jsx)("span",{className:"font-medium text-[#008069]",children:"none"===t.type?"rtl"===u?"غير متاح":"N/A":"nationwide"===t.type?"".concat(t.price," EGP"):"rtl"===u?"يختلف حسب العنوان":"Depends on address"})]}),s&&(0,r.jsxs)("div",{className:"text-xs text-green-600 bg-green-50 p-2 rounded border border-green-100 flex items-center gap-2",children:[(0,r.jsx)(G.Z,{className:"w-3 h-3"}),"rtl"===u?"شحن مجاني للطلبات فوق ".concat(s," ج.م"):"Free shipping on orders over ".concat(s," EGP")]}),(0,r.jsxs)("div",{className:"pt-2 border-t flex justify-between font-bold",children:[(0,r.jsx)("span",{children:"rtl"===u?"الإجمالي":"Total"}),(0,r.jsx)("span",{children:"..."})]})]})})]})]})}var J=s(6046);function SettingsPage(){let{store:e,loading:t,refetchStore:s}=(0,J.o)(),[w,O]=(0,a.useState)(!0),[Z,D]=(0,a.useState)(!1),[U,V]=(0,a.useState)(""),[F,Q]=(0,a.useState)(""),[G,B]=(0,a.useState)(""),[L,M]=(0,a.useState)("en"),[q,Y]=(0,a.useState)(""),[$,H]=(0,a.useState)(""),[W,X]=(0,a.useState)(null),[K,ee]=(0,a.useState)(""),[et,es]=(0,a.useState)(""),[er,ea]=(0,a.useState)(""),[en,ei]=(0,a.useState)(""),[el,eo]=(0,a.useState)(""),[ec,ed]=(0,a.useState)(""),[eu,eh]=(0,a.useState)(!0),[em,eg]=(0,a.useState)(!1),[ep,ex]=(0,a.useState)({type:"none"}),[ef,eb]=(0,a.useState)(null),[ey,ev]=(0,a.useState)(""),[ej,eN]=(0,a.useState)(""),[ew,e_]=(0,a.useState)(""),[ek,eS]=(0,a.useState)(!1),[eC,eP]=(0,a.useState)(!1),[eT,eI]=(0,a.useState)(!1),[eA,eE]=(0,a.useState)(!1),[ez,eR]=(0,a.useState)(""),[eO,eZ]=(0,a.useState)(!1),{user:eD,loading:eU}=(0,n.useAuth)(),eV=(0,i.useRouter)(),{toast:eF}=(0,N.pm)(),{t:eQ,direction:eG}=(0,S.Z)();(0,a.useEffect)(()=>{eU||eD||eV.push("/login"),eD&&I.dV.isNativePlatform()&&R.Hc.isAvailable().then(e=>{eI(e.isAvailable),z.u.get({key:"biometric_enabled"}).then(e=>{let{value:t}=e;eP("true"===t)})}).catch(()=>{})},[eD,eV,eU]),(0,a.useEffect)(()=>{if(e){var s,r,a;V(e.name),Q(e.description||""),B(e.whatsapp_number),M(e.default_language||"en"),Y(e.email||""),H(e.logo_url||""),ee(e.logo_url||""),es(e.facebook_url||""),ea(e.instagram_url||""),ei(e.twitter_url||""),eo(e.tiktok_url||""),ed(e.location_url||""),eh(null===(s=e.allow_delivery)||void 0===s||s),eg(null!==(r=e.allow_pickup)&&void 0!==r&&r),ex(e.shipping_config||{type:"none"}),eb(null!==(a=e.free_shipping_threshold)&&void 0!==a?a:null),O(!1)}else t||O(!1)},[e,t]);let handleNativeLogoCamera=async()=>{try{let e=await T.V1.getPhoto({quality:90,allowEditing:!0,resultType:T.dk.DataUrl,source:T.oK.Prompt});if(e.dataUrl){ee(e.dataUrl);let t=await fetch(e.dataUrl),s=await t.blob(),r=new File([s],"logo.jpg",{type:s.type});X(r)}}catch(e){console.error("Camera error",e)}},uploadLogo=async()=>{if(!W)return $;try{let e=new FormData;e.append("file",W),e.append("folder","logos");let t=await fetch("/api/upload",{method:"POST",body:e}),s=await t.json();if(!t.ok)throw Error(s.error||"Upload failed");return s.url}catch(e){return eF({title:"Logo upload failed",description:e.message,variant:"destructive"}),$}},handleRegenerateQR=async()=>{if(e){I.dV.isNativePlatform()&&await A.ej.impact({style:A.y$.Heavy}),D(!0);try{let e=await C.h.post("/api/store/qr");if(e.error)throw Error(e.error);await s(),eF({title:"rtl"===eG?"تم تحديث رمز QR":"QR Code Regenerated",description:"rtl"===eG?"تم تحديث رمز الاستجابة السريعة بنجاح":"Your store QR code has been regenerated successfully."})}catch(e){eF({title:eQ("common.error"),description:e.message,variant:"destructive"})}finally{D(!1)}}},handleSave=async()=>{if(e){I.dV.isNativePlatform()&&await A.ej.impact({style:A.y$.Medium}),D(!0);try{let e=await uploadLogo(),t={name:U,description:F||null,whatsapp_number:(0,k.yL)(G),default_language:L,email:q||null,logo_url:e,facebook_url:et||null,instagram_url:er||null,twitter_url:en||null,tiktok_url:el||null,location_url:ec||null,allow_delivery:eu,allow_pickup:em,shipping_config:ep,free_shipping_threshold:ef},r=await C.h.put("/api/dashboard/store",t);if(r.error)throw Error(r.error);await s(),eF({title:eQ("settings.saved"),description:eQ("settings.saved_desc")})}catch(e){eF({title:eQ("common.error"),description:e.message,variant:"destructive"})}finally{D(!1)}}},handlePasswordChange=async()=>{if(!ey||!ej||!ew){eF({title:eQ("common.error"),description:"rtl"===eG?"يرجى ملء جميع حقول كلمة المرور":"Please fill all password fields",variant:"destructive"});return}if(ej!==ew){eF({title:eQ("common.error"),description:"rtl"===eG?"كلمات المرور الجديدة غير متطابقة":"New passwords do not match",variant:"destructive"});return}if(ej.length<6){eF({title:eQ("common.error"),description:"rtl"===eG?"يجب أن تكون كلمة المرور 6 أحرف على الأقل":"Password must be at least 6 characters",variant:"destructive"});return}eS(!0);try{let e=await C.h.post("/api/auth/change-password",{currentPassword:ey,newPassword:ej});if(e.error)throw Error(e.error);eF({title:eQ("settings.saved"),description:"rtl"===eG?"تم تغيير كلمة المرور بنجاح":"Password changed successfully"}),ev(""),eN(""),e_("")}catch(e){eF({title:eQ("common.error"),description:"Incorrect current password"===e.message?"rtl"===eG?"كلمة المرور الحالية غير صحيحة":"Incorrect current password":e.message,variant:"destructive"})}finally{eS(!1)}},handleDeleteAccount=async()=>{if(!ez.trim()){eF({title:eQ("common.error"),description:eQ("settings.delete_reason_required"),variant:"destructive"});return}eZ(!0);try{let e=await C.h.post("/api/auth/delete-account",{reason:ez});if(e.error)throw Error(e.error);eV.push("/login")}catch(e){eF({title:eQ("common.error"),description:e.message,variant:"destructive"})}finally{eZ(!1)}};return w?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-[#f6f8f7]",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#008069]"})}):(0,r.jsxs)("div",{className:"min-h-screen bg-[#f6f8f7]",dir:eG,children:[(0,r.jsx)("header",{className:"bg-white border-b border-gray-100 sticky top-0 z-40",children:(0,r.jsx)("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,r.jsxs)("button",{onClick:()=>eV.push("/dashboard"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[(0,r.jsx)(u.Z,{className:"w-5 h-5 ".concat("rtl"===eG?"rotate-180":"")}),(0,r.jsx)("span",{className:"font-medium",children:eQ("common.back")})]}),(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:eQ("settings.title")}),(0,r.jsxs)(l.z,{onClick:handleSave,disabled:Z,className:"bg-[#008069] hover:bg-green-500 text-[#111813] font-bold rounded-lg",children:[(0,r.jsx)(h.Z,{className:"w-4 h-4 ".concat("rtl"===eG?"ml-2":"mr-2")}),Z?eQ("common.saving"):eQ("common.save")]})]})})}),(0,r.jsx)("main",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[(0,r.jsx)(m.Z,{className:"w-5 h-5 text-[#008069]"}),eQ("settings.identity")]}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-8 items-start",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,r.jsxs)("div",{className:"relative group cursor-pointer",children:[(0,r.jsx)("div",{className:"relative h-32 w-32 rounded-full border-4 border-gray-100 overflow-hidden bg-gradient-to-br from-[#008069] to-green-600",children:K?(0,r.jsx)(_(),{src:K,alt:"Store logo",fill:!0,className:"object-cover"}):(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white text-4xl font-bold",children:U.charAt(0).toUpperCase()})})}),(0,r.jsxs)("label",{className:"absolute inset-0 bg-black/40 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",onClick:e=>{I.dV.isNativePlatform()&&(e.preventDefault(),handleNativeLogoCamera())},children:[(0,r.jsx)(g.Z,{className:"w-8 h-8 text-white"}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){X(s);let e=new FileReader;e.onloadend=()=>{ee(e.result)},e.readAsDataURL(s)}},className:(I.dV.isNativePlatform(),"hidden")})]})]}),(0,r.jsx)("span",{className:"text-sm font-medium text-[#008069]",children:eQ("settings.change_logo")})]}),(0,r.jsxs)("div",{className:"flex-1 w-full space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700",children:eQ("settings.store_name")}),(0,r.jsx)(o.I,{value:U,onChange:e=>V(e.target.value),placeholder:"My Awesome Store",className:"h-11 rounded-lg bg-gray-50 border-none focus:ring-2 focus:ring-[#008069]"})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700",children:eQ("settings.description")}),(0,r.jsx)(c.g,{value:F,onChange:e=>Q(e.target.value),placeholder:eQ("settings.description"),rows:4,className:"rounded-lg bg-gray-50 border-none focus:ring-2 focus:ring-[#008069] resize-none"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 text-right",children:eQ("settings.character_limit",{current:F.length,max:500})})]})]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[(0,r.jsx)(p.Z,{className:"w-5 h-5 text-[#008069]"}),eQ("settings.contact_info")]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700",children:eQ("settings.whatsapp")}),(0,r.jsx)(o.I,{value:G,onChange:e=>B(e.target.value),placeholder:"+1 (555) 123-4567",className:"h-11 rounded-lg bg-gray-50 border-none focus:ring-2 focus:ring-[#008069]"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:eQ("settings.whatsapp_desc")})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700",children:eQ("settings.email")}),(0,r.jsx)(o.I,{type:"email",value:q,onChange:e=>Y(e.target.value),placeholder:"support@yourstore.com",className:"h-11 rounded-lg bg-gray-50 border-none focus:ring-2 focus:ring-[#008069]"})]}),(0,r.jsxs)("div",{className:"space-y-1.5 mt-6",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700",children:eQ("settings.default_language")}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"radio",name:"language",value:"en",checked:"en"===L,onChange:e=>M(e.target.value),className:"w-4 h-4 text-[#008069] focus:ring-[#008069]"}),(0,r.jsx)("span",{children:eQ("settings.english")})]}),(0,r.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"radio",name:"language",value:"ar",checked:"ar"===L,onChange:e=>M(e.target.value),className:"w-4 h-4 text-[#008069] focus:ring-[#008069]"}),(0,r.jsx)("span",{children:eQ("settings.arabic")})]})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:eQ("settings.language_help")})]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[(0,r.jsx)(x.Z,{className:"w-5 h-5 text-[#008069]"}),eQ("settings.delivery_options")]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("label",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",children:[(0,r.jsx)("input",{type:"checkbox",checked:eu,onChange:e=>{if(!e.target.checked&&!em){eF({title:eQ("settings.delivery_required_error"),variant:"destructive"});return}eh(e.target.checked)},className:"w-5 h-5 text-[#008069] focus:ring-[#008069] rounded"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:eQ("settings.allow_delivery")}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:eQ("settings.allow_delivery_desc")})]})]}),(0,r.jsxs)("label",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition-colors",children:[(0,r.jsx)("input",{type:"checkbox",checked:em,onChange:e=>{if(!e.target.checked&&!eu){eF({title:eQ("settings.delivery_required_error"),variant:"destructive"});return}eg(e.target.checked)},className:"w-5 h-5 text-[#008069] focus:ring-[#008069] rounded"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:eQ("settings.allow_pickup")}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:eQ("settings.allow_pickup_desc")})]})]})]})]}),(0,r.jsx)(StoreShippingSettings,{shippingConfig:ep,freeShippingThreshold:ef,onConfigChange:ex,onThresholdChange:eb}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[(0,r.jsx)(f.Z,{className:"w-5 h-5 text-[#008069]"}),eQ("settings.social_media")]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700",children:"Facebook"}),(0,r.jsx)(o.I,{value:et,onChange:e=>es(e.target.value),placeholder:"https://facebook.com/yourstore",className:"h-11 rounded-lg bg-gray-50 border-none focus:ring-2 focus:ring-[#008069]"})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700",children:"Instagram"}),(0,r.jsx)(o.I,{value:er,onChange:e=>ea(e.target.value),placeholder:"https://instagram.com/yourstore",className:"h-11 rounded-lg bg-gray-50 border-none focus:ring-2 focus:ring-[#008069]"})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700",children:"Twitter / X"}),(0,r.jsx)(o.I,{value:en,onChange:e=>ei(e.target.value),placeholder:"https://twitter.com/yourstore",className:"h-11 rounded-lg bg-gray-50 border-none focus:ring-2 focus:ring-[#008069]"})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700",children:"TikTok"}),(0,r.jsx)(o.I,{value:el,onChange:e=>eo(e.target.value),placeholder:"https://tiktok.com/@yourstore",className:"h-11 rounded-lg bg-gray-50 border-none focus:ring-2 focus:ring-[#008069]"})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700",children:eQ("onboarding.location")}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(o.I,{value:ec,onChange:e=>ed(e.target.value),placeholder:"https://maps.google.com/...",className:"h-11 rounded-lg bg-gray-50 border-none focus:ring-2 focus:ring-[#008069]"}),(0,r.jsx)(l.z,{type:"button",variant:"outline",onClick:async()=>{if(I.dV.isNativePlatform()){try{eF({title:eQ("onboarding.locating"),description:eQ("onboarding.getting_location")});let e=await P.b.checkPermissions();if("granted"!==e.location){let e=await P.b.requestPermissions();if("granted"!==e.location)throw Error("Permission denied")}let t=await P.b.getCurrentPosition(),{latitude:s,longitude:r}=t.coords,a="https://www.google.com/maps?q=".concat(s,",").concat(r);ed(a),eF({title:eQ("onboarding.location_found"),description:eQ("onboarding.location_set")})}catch(e){console.error("Geolocation error:",e),eF({title:eQ("common.error"),description:e.message||eQ("onboarding.location_error"),variant:"destructive"})}return}if(!navigator.geolocation){eF({title:eQ("common.error"),description:eQ("onboarding.geolocation_not_supported"),variant:"destructive"});return}eF({title:eQ("onboarding.locating"),description:eQ("onboarding.getting_location")}),navigator.geolocation.getCurrentPosition(e=>{let{latitude:t,longitude:s}=e.coords,r="https://www.google.com/maps?q=".concat(t,",").concat(s);ed(r),eF({title:eQ("onboarding.location_found"),description:eQ("onboarding.location_set")})},e=>{console.error("Geolocation error:",e);let t=eQ("onboarding.location_error");e.code===e.PERMISSION_DENIED?t=eQ("onboarding.location_permission_denied"):e.code===e.POSITION_UNAVAILABLE?t=eQ("onboarding.location_unavailable"):e.code===e.TIMEOUT&&(t=eQ("onboarding.location_timeout")),eF({title:eQ("common.error"),description:t,variant:"destructive"})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},className:"h-11 rounded-lg border-gray-200 text-gray-600 hover:text-[#008069] shrink-0",title:eQ("onboarding.get_current_location"),children:(0,r.jsx)(m.Z,{className:"w-5 h-5"})})]})]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[(0,r.jsx)(b.Z,{className:"w-5 h-5 text-[#008069]"}),"rtl"===eG?"الأمان":"Security"]}),(0,r.jsxs)("div",{className:"space-y-4 max-w-md",children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700",children:"rtl"===eG?"كلمة المرور الحالية":"Current Password"}),(0,r.jsx)(o.I,{type:"password",value:ey,onChange:e=>ev(e.target.value),placeholder:"••••••",className:"h-11 rounded-lg bg-gray-50 border-none focus:ring-2 focus:ring-[#008069]"})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700",children:"rtl"===eG?"كلمة المرور الجديدة":"New Password"}),(0,r.jsx)(o.I,{type:"password",value:ej,onChange:e=>eN(e.target.value),placeholder:"••••••",className:"h-11 rounded-lg bg-gray-50 border-none focus:ring-2 focus:ring-[#008069]"})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)(d._,{className:"text-sm font-bold text-gray-700",children:"rtl"===eG?"تأكيد كلمة المرور الجديدة":"Confirm New Password"}),(0,r.jsx)(o.I,{type:"password",value:ew,onChange:e=>e_(e.target.value),placeholder:"••••••",className:"h-11 rounded-lg bg-gray-50 border-none focus:ring-2 focus:ring-[#008069]"})]}),(0,r.jsx)(l.z,{onClick:handlePasswordChange,disabled:ek,className:"bg-[#008069] hover:bg-green-500 text-white font-bold rounded-lg mt-2 w-full",children:ek?"rtl"===eG?"جاري التغيير...":"Changing...":"rtl"===eG?"تغيير كلمة المرور":"Change Password"})]})]}),eT&&(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"space-y-0.5",children:[(0,r.jsxs)("h3",{className:"text-lg font-bold flex items-center gap-2",children:[(0,r.jsx)(b.Z,{className:"w-5 h-5 text-[#008069]"}),"rtl"===eG?"تسجيل الدخول بالبصمة":"Biometric Login"]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"rtl"===eG?"استخدم بصمة الإصبع أو الوجه لتسجيل الدخول":"Use fingerprint or face ID to log in"})]}),(0,r.jsx)(E.r,{checked:eC,onCheckedChange:async e=>{if(eP(e),await z.u.set({key:"biometric_enabled",value:String(e)}),e)try{await R.Hc.verifyIdentity({reason:"Verify to enable",title:"Biometric Setup",subtitle:"",description:""})}catch(e){eP(!1),await z.u.set({key:"biometric_enabled",value:"false"}),eF({title:eQ("common.error"),description:"Biometric verification failed",variant:"destructive"})}}})]})}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[(0,r.jsx)(y.Z,{className:"w-5 h-5 text-[#008069]"}),"rtl"===eG?"رمز الاستجابة السريعة (QR)":"QR Code"]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"rtl"===eG?"إذا كنت تواجه مشاكل في مسح رمز QR الخاص بمتجرك، يمكنك إعادة إنشائه هنا.":"If you are experiencing issues with scanning your store QR code, you can regenerate it here."}),(0,r.jsx)(l.z,{onClick:handleRegenerateQR,disabled:Z,variant:"outline",className:"border-[#008069] text-[#008069] hover:bg-green-50",children:"rtl"===eG?"إعادة إنشاء رمز QR":"Regenerate QR Code"})]})]}),(0,r.jsxs)("div",{className:"bg-red-50 rounded-xl shadow-sm border border-red-200 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-bold mb-4 text-red-700 flex items-center gap-2",children:[(0,r.jsx)(v.Z,{className:"w-5 h-5"}),eQ("settings.danger_zone")]}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:eQ("settings.delete_warning")}),(0,r.jsxs)(l.z,{variant:"destructive",onClick:()=>eE(!0),className:"bg-red-600 hover:bg-red-700",children:[(0,r.jsx)(v.Z,{className:"w-4 h-4 mr-2"}),eQ("settings.delete_account")]})]})]})}),eA&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl max-w-md w-full p-6 shadow-xl",dir:eG,children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 text-red-600 mb-4",children:[(0,r.jsx)(j.Z,{className:"w-8 h-8"}),(0,r.jsx)("h2",{className:"text-xl font-bold",children:eQ("settings.confirm_delete")})]}),(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:[(0,r.jsx)("p",{className:"text-sm text-red-800 font-medium",children:eQ("settings.delete_consequences")}),(0,r.jsxs)("ul",{className:"text-sm text-red-700 mt-2 list-disc list-inside space-y-1",children:[(0,r.jsx)("li",{children:eQ("settings.delete_store")}),(0,r.jsx)("li",{children:eQ("settings.delete_products")}),(0,r.jsx)("li",{children:eQ("settings.delete_orders")}),(0,r.jsx)("li",{children:eQ("settings.delete_subscription")})]})]}),(0,r.jsxs)("div",{className:"space-y-2 mb-6",children:[(0,r.jsxs)(d._,{className:"text-sm font-medium",children:[eQ("settings.delete_reason_label")," ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)(c.g,{value:ez,onChange:e=>eR(e.target.value),placeholder:eQ("settings.delete_reason_placeholder"),className:"resize-none border-red-200 focus:border-red-400 focus:ring-red-400",rows:3})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)(l.z,{variant:"outline",onClick:()=>{eE(!1),eR("")},className:"flex-1",disabled:eO,children:"rtl"===eG?"إلغاء":"Cancel"}),(0,r.jsx)(l.z,{variant:"destructive",onClick:handleDeleteAccount,disabled:eO||!ez.trim(),className:"flex-1 bg-red-600 hover:bg-red-700",children:eO?"rtl"===eG?"جاري الحذف...":"Deleting...":eQ("settings.delete_permanently")})]})]})})]})}},7321:function(e,t,s){"use strict";s.d(t,{d:function(){return o},z:function(){return c}});var r=s(8708),a=s(5444),n=s(432),i=s(6005),l=s(3883);let o=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:s,variant:a,size:i,asChild:c=!1,...d}=e,u=c?n.g7:"button";return(0,r.jsx)(u,{className:(0,l.cn)(o({variant:a,size:i,className:s})),ref:t,...d})});c.displayName="Button"},4896:function(e,t,s){"use strict";s.d(t,{I:function(){return i}});var r=s(8708),a=s(5444),n=s(3883);let i=a.forwardRef((e,t)=>{let{className:s,type:a,...i}=e;return(0,r.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...i})});i.displayName="Input"},9861:function(e,t,s){"use strict";s.d(t,{_:function(){return c}});var r=s(8708),a=s(5444),n=s(1500),i=s(6005),l=s(3883);let o=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.f,{ref:t,className:(0,l.cn)(o(),s),...a})});c.displayName=n.f.displayName},372:function(e,t,s){"use strict";s.d(t,{Bw:function(){return p},Ph:function(){return d},Ql:function(){return f},i4:function(){return h},ki:function(){return u}});var r=s(8708),a=s(5444),n=s(379),i=s(7216),l=s(8695),o=s(9375),c=s(3883);let d=n.fC;n.ZA;let u=n.B4,h=a.forwardRef((e,t)=>{let{className:s,children:a,...l}=e;return(0,r.jsxs)(n.xz,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...l,children:[a,(0,r.jsx)(n.JO,{asChild:!0,children:(0,r.jsx)(i.Z,{className:"h-4 w-4 opacity-50"})})]})});h.displayName=n.xz.displayName;let m=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.u_,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(l.Z,{className:"h-4 w-4"})})});m.displayName=n.u_.displayName;let g=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.$G,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})});g.displayName=n.$G.displayName;let p=a.forwardRef((e,t)=>{let{className:s,children:a,position:i="popper",...l}=e;return(0,r.jsx)(n.h_,{children:(0,r.jsxs)(n.VY,{ref:t,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:i,...l,children:[(0,r.jsx)(m,{}),(0,r.jsx)(n.l_,{className:(0,c.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,r.jsx)(g,{})]})})});p.displayName=n.VY.displayName;let x=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.__,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a})});x.displayName=n.__.displayName;let f=a.forwardRef((e,t)=>{let{className:s,children:a,...i}=e;return(0,r.jsxs)(n.ck,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...i,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(n.wU,{children:(0,r.jsx)(o.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(n.eT,{children:a})]})});f.displayName=n.ck.displayName;let b=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.Z0,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",s),...a})});b.displayName=n.Z0.displayName},6370:function(e,t,s){"use strict";s.d(t,{r:function(){return l}});var r=s(8708),a=s(5444),n=s(1583),i=s(3883);let l=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.fC,{className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...a,ref:t,children:(0,r.jsx)(n.bU,{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});l.displayName=n.fC.displayName},5654:function(e,t,s){"use strict";s.d(t,{g:function(){return i}});var r=s(8708),a=s(5444),n=s(3883);let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...a})});i.displayName="Textarea"},2272:function(e,t,s){"use strict";s.d(t,{pm:function(){return useToast}});var r=s(5444);let a=0,n=new Map,addToRemoveQueue=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),dispatch({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},reducer=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?addToRemoveQueue(s):e.toasts.forEach(e=>{addToRemoveQueue(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],l={toasts:[]};function dispatch(e){l=reducer(l,e),i.forEach(e=>{e(l)})}function toast(e){let{...t}=e,s=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),dismiss=()=>dispatch({type:"DISMISS_TOAST",toastId:s});return dispatch({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||dismiss()}}}),{id:s,dismiss,update:e=>dispatch({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function useToast(){let[e,t]=r.useState(l);return r.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast,dismiss:e=>dispatch({type:"DISMISS_TOAST",toastId:e})}}},8681:function(e,t,s){"use strict";s.d(t,{h:function(){return n}});var r=s(2979);let a=r.dV.isNativePlatform()?"https://whatsou.com":window.location.origin,n=new class{setToken(e){this.token=e,localStorage.setItem("auth_token",e)}getToken(){return this.token||(this.token=localStorage.getItem("auth_token")),this.token}clearToken(){this.token=null,localStorage.removeItem("auth_token")}isAuthenticated(){return!!this.getToken()}async fetch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.getToken(),r=await fetch("".concat(a).concat(e),{...t,headers:{"Content-Type":"application/json",...s?{Authorization:"Bearer ".concat(s)}:{},...t.headers}}),n=await r.json();if(!r.ok)throw 401===r.status&&console.error("API Unauthorized (401) - Token NOT cleared for debugging"),Error(n.error||"API Error: ".concat(r.status));return n}get(e){return this.fetch(e,{method:"GET"})}post(e,t){return this.fetch(e,{method:"POST",body:t?JSON.stringify(t):void 0})}put(e,t){return this.fetch(e,{method:"PUT",body:t?JSON.stringify(t):void 0})}delete(e){return this.fetch(e,{method:"DELETE"})}constructor(){this.token=null}}},6803:function(e,t,s){"use strict";s.r(t),s.d(t,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var r=s(8708),a=s(5444),n=s(2859),i=s(8681);let l=(0,a.createContext)({user:null,loading:!0,signIn:async()=>{},signUp:async()=>{},signOut:async()=>{}});function AuthProvider(e){let{children:t}=e,[s,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0),u=(0,n.useRouter)();(0,a.useEffect)(()=>{let checkSession=async()=>{if(!i.h.isAuthenticated()){d(!1);return}try{let e=await i.h.get("/api/auth/session");e.authenticated&&e.user?o(e.user):i.h.clearToken()}catch(e){console.error("Session check failed:",e),i.h.clearToken()}d(!1)};checkSession()},[]);let signIn=async(e,t)=>{let s=await i.h.post("/api/auth/login",{phone:e,password:t});if(s.error)throw Error(s.error);s.token&&(i.h.setToken(s.token),o(s.user)),u.push("/dashboard"),u.refresh()},signUp=async function(e,t){let s=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=await i.h.post("/api/auth/signup",{phone:e,password:t,agreedToPrivacy:s});if(r.error)throw Error(r.error);r.token&&(i.h.setToken(r.token),o(r.user)),u.push("/onboarding"),u.refresh()},signOut=async()=>{try{await i.h.post("/api/auth/logout")}catch(e){}i.h.clearToken(),o(null),u.push("/login"),u.refresh()};return(0,r.jsx)(l.Provider,{value:{user:s,loading:c,signIn,signUp,signOut},children:t})}let useAuth=()=>(0,a.useContext)(l)},6046:function(e,t,s){"use strict";s.d(t,{g:function(){return StoreProvider},o:function(){return useStore}});var r=s(8708),a=s(5444);let n=(0,a.createContext)({store:null,loading:!0,refetchStore:async()=>{}});function StoreProvider(e){let{children:t,value:s}=e;return(0,r.jsx)(n.Provider,{value:s,children:t})}let useStore=()=>(0,a.useContext)(n)},3883:function(e,t,s){"use strict";s.d(t,{cn:function(){return cn}});var r=s(794),a=s(9654);function cn(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.m6)((0,r.W)(t))}},6811:function(e,t,s){"use strict";function standardizePhoneNumber(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"20",s=e.replace(/[^\d+]/g,"");return s.startsWith("+")?s:s.startsWith(t)?"+".concat(s):s.startsWith("0")?"+".concat(t).concat(s.substring(1)):"+".concat(t).concat(s)}s.d(t,{yL:function(){return standardizePhoneNumber}})},6923:function(e,t,s){"use strict";s.d(t,{Z:function(){return r.useLanguage}});var r=s(7855)}},function(e){e.O(0,[7683,8389,8679,9203,1989,215,6705,9488,7855,912,9619,1744],function(){return e(e.s=6721)}),_N_E=e.O()}]);