(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7857],{6528:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var r=s(9213);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r.Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},3226:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var r=s(9213);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r.Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},9593:function(e,t,s){Promise.resolve().then(s.bind(s,3957))},3957:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return OrdersPage}});var r=s(8708),a=s(5444),n=s(6803),l=s(8017),i=s(6528),o=s(9576),d=s(3682),c=s(3226),u=s(4142),h=s(4476),m=s(8695),x=s(7216),f=s(7643),p=s(4896),y=s(372),g=s(2217),b=s(1679),j=s(542),v=s(3848),w=s(2018),N=s(1103),_=s(9795),k=s(6923),Z=s(4301),S=s(2056),C=s.n(S),P=s(8681);function OrdersPage(){var e;let[t,s]=(0,a.useState)([]),[S,E]=(0,a.useState)(!0),[A,O]=(0,a.useState)(null),[T,D]=(0,a.useState)(""),[R,I]=(0,a.useState)("all"),[Q,z]=(0,a.useState)("all"),[M,L]=(0,a.useState)(!1),{t:U,direction:V,language:B}=(0,k.Z)(),{subscription:F,loading:q}=(0,Z.m)(),G=null!==(e=null==F?void 0:F.isReadOnly)&&void 0!==e&&e,{user:J}=(0,n.useAuth)(),Y=(0,a.useCallback)(async()=>{if(J)try{let e=await P.h.get("/api/dashboard/orders");if(e.error){console.error("Error fetching orders:",e.error),E(!1);return}e.storeSettings&&L(!0===e.storeSettings.allow_delivery&&!0===e.storeSettings.allow_pickup),s(e.orders||[])}catch(e){console.error("Unexpected error:",e)}finally{E(!1)}},[J]);(0,a.useEffect)(()=>{Y()},[Y]);let toggleExpand=e=>{O(A===e?null:e)};return S||q?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[50vh]",children:(0,r.jsx)(l.Z,{className:"w-8 h-8 animate-spin text-gray-400"})}):G?(0,r.jsx)("div",{className:"max-w-md mx-auto px-4 py-16 text-center",children:(0,r.jsxs)("div",{className:"bg-red-100 border-2 border-red-500 rounded-2xl p-8",children:[(0,r.jsx)(i.Z,{className:"w-16 h-16 mx-auto text-red-600 mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-bold text-red-700 mb-2",children:"ar"===B?"وضع القراءة فقط":"Read-Only Mode"}),(0,r.jsx)("p",{className:"text-red-600 mb-6",children:"ar"===B?"اشتراكك منتهي. جدد للوصول لبيانات الطلبات.":"Your subscription has expired. Renew to access order data."}),(0,r.jsx)(C(),{href:"/dashboard/subscription",className:"inline-block bg-red-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-red-700",children:"ar"===B?"جدد الآن":"Renew Now"})]})}):(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8 pb-32",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:U("dashboard.nav_orders")||"Orders"}),(0,r.jsx)("span",{className:"bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-sm font-medium",children:t.length})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsx)(o.Z,{className:"absolute ".concat("rtl"===V?"right-3":"left-3"," top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4")}),(0,r.jsx)(p.I,{placeholder:U("dashboard.search_orders"),value:T,onChange:e=>D(e.target.value),className:"".concat("rtl"===V?"pr-10":"pl-10"," rounded-xl bg-white")})]}),(0,r.jsxs)(y.Ph,{value:R,onValueChange:I,children:[(0,r.jsxs)(y.i4,{className:"w-full sm:w-[180px] rounded-xl bg-white",children:[(0,r.jsx)(d.Z,{className:"w-4 h-4 mr-2 text-gray-400"}),(0,r.jsx)(y.ki,{placeholder:"Filter by date"})]}),(0,r.jsxs)(y.Bw,{children:[(0,r.jsx)(y.Ql,{value:"all",children:U("dashboard.filter_all")}),(0,r.jsx)(y.Ql,{value:"today",children:U("dashboard.filter_today")}),(0,r.jsx)(y.Ql,{value:"yesterday",children:U("dashboard.filter_yesterday")}),(0,r.jsx)(y.Ql,{value:"last_7_days",children:U("dashboard.filter_last_7_days")}),(0,r.jsx)(y.Ql,{value:"last_30_days",children:U("dashboard.filter_last_30_days")})]})]}),M&&(0,r.jsxs)(y.Ph,{value:Q,onValueChange:z,children:[(0,r.jsx)(y.i4,{className:"w-full sm:w-[150px] rounded-xl bg-white",children:(0,r.jsx)(y.ki,{placeholder:U("dashboard.filter_delivery_type")})}),(0,r.jsxs)(y.Bw,{children:[(0,r.jsx)(y.Ql,{value:"all",children:U("dashboard.filter_all_types")}),(0,r.jsx)(y.Ql,{value:"delivery",children:U("dashboard.filter_delivery")}),(0,r.jsx)(y.Ql,{value:"pickup",children:U("dashboard.filter_pickup")})]})]})]}),0===t.filter(e=>{let t=T.toLowerCase(),s=e.customer_name.toLowerCase().includes(t)||e.customer_phone.includes(t);if(!s)return!1;let r=(0,_.Z)(e.created_at);return"today"===R?(0,b.Z)(r):"yesterday"===R?(0,j.Z)(r):"last_7_days"===R?(0,w.Z)(r,(0,v.Z)((0,N.Z)(new Date),7)):"last_30_days"!==R||(0,w.Z)(r,(0,v.Z)((0,N.Z)(new Date),30))}).filter(e=>"all"===Q||e.delivery_type===Q).length?(0,r.jsxs)("div",{className:"text-center py-12 bg-white rounded-2xl border border-dashed border-gray-200",children:[(0,r.jsx)(c.Z,{className:"w-12 h-12 mx-auto text-gray-300 mb-3"}),(0,r.jsx)("p",{className:"text-gray-500",children:U("dashboard.no_orders")||"No orders found"})]}):(0,r.jsx)("div",{className:"space-y-4",children:t.filter(e=>{let t=T.toLowerCase(),s=e.customer_name.toLowerCase().includes(t)||e.customer_phone.includes(t);if(!s)return!1;let r=(0,_.Z)(e.created_at);return"today"===R?(0,b.Z)(r):"yesterday"===R?(0,j.Z)(r):"last_7_days"===R?(0,w.Z)(r,(0,v.Z)((0,N.Z)(new Date),7)):"last_30_days"!==R||(0,w.Z)(r,(0,v.Z)((0,N.Z)(new Date),30))}).filter(e=>"all"===Q||e.delivery_type===Q).map(e=>(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center justify-between gap-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>toggleExpand(e.id),children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:["pickup"===e.delivery_type?(0,r.jsx)("span",{title:U("dashboard.filter_pickup"),className:"text-lg",children:"\uD83C\uDFEA"}):(0,r.jsx)("span",{title:U("dashboard.filter_delivery"),className:"text-lg",children:"\uD83C\uDFE0"}),(0,r.jsx)("span",{className:"font-bold text-lg",children:e.customer_name})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-sm text-gray-500",children:[(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(u.Z,{className:"w-3 h-3"})," ",e.customer_phone]}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(h.Z,{className:"w-3 h-3"})," ",(0,g.ZP)(new Date(e.created_at),"MMM d, yyyy h:mm a")]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between sm:justify-end gap-4 min-w-[120px]",children:[(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("div",{className:"font-bold text-lg",children:[U("common.currency")," ",Number(e.total_price).toFixed(2)]}),void 0!==e.shipping_cost&&e.shipping_cost>0&&(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["(Inc. ",U("common.currency")," ",Number(e.shipping_cost).toFixed(2)," Shipping)"]})]}),A===e.id?(0,r.jsx)(m.Z,{className:"w-5 h-5 text-gray-400"}):(0,r.jsx)(x.Z,{className:"w-5 h-5 text-gray-400"})]})]}),A===e.id&&(0,r.jsxs)("div",{className:"p-4 bg-gray-50 border-t border-gray-100 space-y-4",children:[(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsxs)("h4",{className:"font-medium mb-2 text-gray-700 flex items-center gap-2",children:[(0,r.jsx)(f.Z,{className:"w-4 h-4"})," ",U("customers.delivery_address")]}),(0,r.jsxs)("div",{className:"text-gray-600 pl-6 space-y-1",children:[(0,r.jsx)("p",{children:e.customer_address}),(e.city||e.district)&&(0,r.jsx)("p",{className:"text-sm text-gray-400",children:[e.district,e.city].filter(Boolean).join(", ")})]})]}),e.notes&&(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsxs)("h4",{className:"font-medium mb-2 text-gray-700 flex items-center gap-2",children:["\uD83D\uDCDD ",U("common.notes")||"Notes"]}),(0,r.jsx)("p",{className:"text-gray-600 pl-6",children:e.notes})]}),(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsxs)("h4",{className:"font-medium mb-2 text-gray-700 flex items-center gap-2",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4"})," ",U("customers.order_items")]}),(0,r.jsx)("div",{className:"pl-6 space-y-2",children:Array.isArray(e.order_items)&&e.order_items.map((e,t)=>(0,r.jsxs)("div",{className:"flex justify-between items-center text-gray-600 bg-white p-2 rounded-lg border border-gray-100",children:[(0,r.jsxs)("span",{children:[(0,r.jsxs)("span",{className:"font-semibold text-black",children:[e.quantity,"x"]})," ",e.product_name,e.selected_options&&Object.keys(e.selected_options).length>0&&(0,r.jsxs)("span",{className:"text-gray-400 ml-1 text-xs",children:["(",Object.entries(e.selected_options).map(e=>{let[t,s]=e;return"".concat(t,":").concat(s)}).join(", "),")"]})]}),(0,r.jsxs)("span",{children:[U("common.currency")," ",(e.price*e.quantity).toFixed(2)]})]},t))})]})]})]},e.id))})]})}},4896:function(e,t,s){"use strict";s.d(t,{I:function(){return l}});var r=s(8708),a=s(5444),n=s(3883);let l=a.forwardRef((e,t)=>{let{className:s,type:a,...l}=e;return(0,r.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...l})});l.displayName="Input"},372:function(e,t,s){"use strict";s.d(t,{Bw:function(){return f},Ph:function(){return c},Ql:function(){return y},i4:function(){return h},ki:function(){return u}});var r=s(8708),a=s(5444),n=s(379),l=s(7216),i=s(8695),o=s(9375),d=s(3883);let c=n.fC;n.ZA;let u=n.B4,h=a.forwardRef((e,t)=>{let{className:s,children:a,...i}=e;return(0,r.jsxs)(n.xz,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...i,children:[a,(0,r.jsx)(n.JO,{asChild:!0,children:(0,r.jsx)(l.Z,{className:"h-4 w-4 opacity-50"})})]})});h.displayName=n.xz.displayName;let m=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.u_,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})});m.displayName=n.u_.displayName;let x=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.$G,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(l.Z,{className:"h-4 w-4"})})});x.displayName=n.$G.displayName;let f=a.forwardRef((e,t)=>{let{className:s,children:a,position:l="popper",...i}=e;return(0,r.jsx)(n.h_,{children:(0,r.jsxs)(n.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:l,...i,children:[(0,r.jsx)(m,{}),(0,r.jsx)(n.l_,{className:(0,d.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,r.jsx)(x,{})]})})});f.displayName=n.VY.displayName;let p=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.__,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a})});p.displayName=n.__.displayName;let y=a.forwardRef((e,t)=>{let{className:s,children:a,...l}=e;return(0,r.jsxs)(n.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(n.wU,{children:(0,r.jsx)(o.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(n.eT,{children:a})]})});y.displayName=n.ck.displayName;let g=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",s),...a})});g.displayName=n.Z0.displayName},8681:function(e,t,s){"use strict";s.d(t,{h:function(){return n}});var r=s(2979);let a=r.dV.isNativePlatform()?"https://whatsou.com":window.location.origin,n=new class{setToken(e){this.token=e,localStorage.setItem("auth_token",e)}getToken(){return this.token||(this.token=localStorage.getItem("auth_token")),this.token}clearToken(){this.token=null,localStorage.removeItem("auth_token")}isAuthenticated(){return!!this.getToken()}async fetch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.getToken(),r=await fetch("".concat(a).concat(e),{...t,headers:{"Content-Type":"application/json",...s?{Authorization:"Bearer ".concat(s)}:{},...t.headers}}),n=await r.json();if(!r.ok)throw 401===r.status&&console.error("API Unauthorized (401) - Token NOT cleared for debugging"),Error(n.error||"API Error: ".concat(r.status));return n}get(e){return this.fetch(e,{method:"GET"})}post(e,t){return this.fetch(e,{method:"POST",body:t?JSON.stringify(t):void 0})}put(e,t){return this.fetch(e,{method:"PUT",body:t?JSON.stringify(t):void 0})}delete(e){return this.fetch(e,{method:"DELETE"})}constructor(){this.token=null}}},6803:function(e,t,s){"use strict";s.r(t),s.d(t,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var r=s(8708),a=s(5444),n=s(2859),l=s(8681);let i=(0,a.createContext)({user:null,loading:!0,signIn:async()=>{},signUp:async()=>{},signOut:async()=>{}});function AuthProvider(e){let{children:t}=e,[s,o]=(0,a.useState)(null),[d,c]=(0,a.useState)(!0),u=(0,n.useRouter)();(0,a.useEffect)(()=>{let checkSession=async()=>{if(!l.h.isAuthenticated()){c(!1);return}try{let e=await l.h.get("/api/auth/session");e.authenticated&&e.user?o(e.user):l.h.clearToken()}catch(e){console.error("Session check failed:",e),l.h.clearToken()}c(!1)};checkSession()},[]);let signIn=async(e,t)=>{let s=await l.h.post("/api/auth/login",{phone:e,password:t});if(s.error)throw Error(s.error);s.token&&(l.h.setToken(s.token),o(s.user)),u.push("/dashboard"),u.refresh()},signUp=async function(e,t){let s=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=await l.h.post("/api/auth/signup",{phone:e,password:t,agreedToPrivacy:s});if(r.error)throw Error(r.error);r.token&&(l.h.setToken(r.token),o(r.user)),u.push("/onboarding"),u.refresh()},signOut=async()=>{try{await l.h.post("/api/auth/logout")}catch(e){}l.h.clearToken(),o(null),u.push("/login"),u.refresh()};return(0,r.jsx)(i.Provider,{value:{user:s,loading:d,signIn,signUp,signOut},children:t})}let useAuth=()=>(0,a.useContext)(i)},4301:function(e,t,s){"use strict";s.d(t,{m:function(){return useSubscription},q:function(){return SubscriptionProvider}});var r=s(8708),a=s(5444),n=s(8681);let l=(0,a.createContext)({subscription:null,loading:!0,refresh:async()=>{}});function SubscriptionProvider(e){let{children:t}=e,[s,i]=(0,a.useState)(null),[o,d]=(0,a.useState)(!0),c=(0,a.useCallback)(async()=>{try{if(!n.h.isAuthenticated()){d(!1);return}let e=await n.h.get("/api/subscription/status");i(e)}catch(e){console.error("Error fetching subscription status:",e)}finally{d(!1)}},[]);return(0,a.useEffect)(()=>{c()},[c]),(0,r.jsx)(l.Provider,{value:{subscription:s,loading:o,refresh:c},children:t})}function useSubscription(){let e=(0,a.useContext)(l);if(!e)throw Error("useSubscription must be used within a SubscriptionProvider");return e}},3883:function(e,t,s){"use strict";s.d(t,{cn:function(){return cn}});var r=s(794),a=s(9654);function cn(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.m6)((0,r.W)(t))}},812:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouterContext",{enumerable:!0,get:function(){return n}});let r=s(7675),a=r._(s(5444)),n=a.default.createContext(null)},6923:function(e,t,s){"use strict";s.d(t,{Z:function(){return r.useLanguage}});var r=s(7855)}},function(e){e.O(0,[7683,2056,8679,9203,1989,215,6395,7855,912,9619,1744],function(){return e(e.s=9593)}),_N_E=e.O()}]);