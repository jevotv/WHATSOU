(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[923],{8017:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(9213);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,n.Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},6528:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(9213);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,n.Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},8793:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(9213);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,n.Z)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]])},9576:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(9213);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,n.Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},9602:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var n=r(9213);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,n.Z)("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]])},9559:function(e,t,r){Promise.resolve().then(r.bind(r,1014))},1014:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return CustomersPage}});var n=r(8708),s=r(5444),o=r(8017),a=r(6528),i=r(9576),c=r(9602),u=r(8793),l=r(4896),d=r(6803),h=r(6923),f=r(4301),m=r(6811),p=r(2056),g=r.n(p),x=r(8681);function CustomersPage(){var e;let[t,r]=(0,s.useState)([]),[p,b]=(0,s.useState)(!0),[y,v]=(0,s.useState)(""),{t:w,direction:k,language:j}=(0,h.Z)(),{subscription:N,loading:S}=(0,f.m)(),C=null!==(e=null==N?void 0:N.isReadOnly)&&void 0!==e&&e,{user:P}=(0,d.useAuth)(),_=(0,s.useCallback)(async()=>{if(P)try{let e=await x.h.get("/api/dashboard/customers");if(e.error){console.error("Error fetching customers:",e.error);return}let t=e.customers,n=new Map;null==t||t.forEach(e=>{let t=(0,m.yL)(e.customer_phone);n.has(t)||n.set(t,{name:e.customer_name,phone:e.customer_phone,totalOrders:0,lastOrderDate:e.created_at});let r=n.get(t);r.totalOrders+=1}),r(Array.from(n.values()))}catch(e){console.error("Unexpected error:",e)}finally{b(!1)}},[P]);return((0,s.useEffect)(()=>{_()},[_]),p||S)?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-[50vh]",children:(0,n.jsx)(o.Z,{className:"w-8 h-8 animate-spin text-gray-400"})}):C?(0,n.jsx)("div",{className:"max-w-md mx-auto px-4 py-16 text-center",children:(0,n.jsxs)("div",{className:"bg-red-100 border-2 border-red-500 rounded-2xl p-8",children:[(0,n.jsx)(a.Z,{className:"w-16 h-16 mx-auto text-red-600 mb-4"}),(0,n.jsx)("h2",{className:"text-xl font-bold text-red-700 mb-2",children:"ar"===j?"وضع القراءة فقط":"Read-Only Mode"}),(0,n.jsx)("p",{className:"text-red-600 mb-6",children:"ar"===j?"اشتراكك منتهي. جدد للوصول لبيانات العملاء.":"Your subscription has expired. Renew to access customer data."}),(0,n.jsx)(g(),{href:"/dashboard/subscription",className:"inline-block bg-red-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-red-700",children:"ar"===j?"جدد الآن":"Renew Now"})]})}):(0,n.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8 pb-32",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:w("dashboard.nav_customers")||"Customers"}),(0,n.jsx)("span",{className:"bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-sm font-medium",children:t.length})]}),(0,n.jsxs)("div",{className:"mb-6 relative",children:[(0,n.jsx)(i.Z,{className:"absolute ".concat("rtl"===k?"right-3":"left-3"," top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4")}),(0,n.jsx)(l.I,{placeholder:w("dashboard.search_customers"),value:y,onChange:e=>v(e.target.value),className:"".concat("rtl"===k?"pr-10":"pl-10"," rounded-xl bg-white")})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.filter(e=>{let t=y.toLowerCase();return e.name.toLowerCase().includes(t)||e.phone.includes(t)}).map((e,t)=>(0,n.jsxs)("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center text-xl font-bold text-gray-500",children:e.name.charAt(0).toUpperCase()}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-bold text-gray-900",children:e.name}),(0,n.jsx)("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:(0,n.jsxs)("span",{className:"flex items-center gap-1 bg-green-50 text-green-700 px-2 py-0.5 rounded-full text-xs font-medium",children:[(0,n.jsx)(c.Z,{className:"w-3 h-3"})," ",e.totalOrders," ",w("customers.orders")]})})]})]}),(0,n.jsx)("a",{href:"https://wa.me/".concat((0,m.yL)(e.phone)),target:"_blank",rel:"noopener noreferrer",className:"flex flex-col items-center justify-center w-10 h-10 rounded-full bg-[#25D366] hover:bg-[#20bd5a] text-white transition-colors shadow-sm",title:"Contact on WhatsApp",children:(0,n.jsx)(u.Z,{className:"w-5 h-5"})})]},t)),0===t.length&&(0,n.jsx)("div",{className:"col-span-full text-center py-12 text-gray-500",children:w("customers.no_customers")})]})]})}},4896:function(e,t,r){"use strict";r.d(t,{I:function(){return a}});var n=r(8708),s=r(5444),o=r(3883);let a=s.forwardRef((e,t)=>{let{className:r,type:s,...a}=e;return(0,n.jsx)("input",{type:s,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...a})});a.displayName="Input"},8681:function(e,t,r){"use strict";r.d(t,{h:function(){return o}});var n=r(2979);let s=n.dV.isNativePlatform()?"https://whatsou.com":window.location.origin,o=new class{setToken(e){this.token=e,localStorage.setItem("auth_token",e)}getToken(){return this.token||(this.token=localStorage.getItem("auth_token")),this.token}clearToken(){this.token=null,localStorage.removeItem("auth_token")}isAuthenticated(){return!!this.getToken()}async fetch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.getToken(),n=await fetch("".concat(s).concat(e),{...t,headers:{"Content-Type":"application/json",...r?{Authorization:"Bearer ".concat(r)}:{},...t.headers}}),o=await n.json();if(!n.ok)throw 401===n.status&&console.error("API Unauthorized (401) - Token NOT cleared for debugging"),Error(o.error||"API Error: ".concat(n.status));return o}get(e){return this.fetch(e,{method:"GET"})}post(e,t){return this.fetch(e,{method:"POST",body:t?JSON.stringify(t):void 0})}put(e,t){return this.fetch(e,{method:"PUT",body:t?JSON.stringify(t):void 0})}delete(e){return this.fetch(e,{method:"DELETE"})}constructor(){this.token=null}}},6803:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var n=r(8708),s=r(5444),o=r(2859),a=r(8681);let i=(0,s.createContext)({user:null,loading:!0,signIn:async()=>{},signUp:async()=>{},signOut:async()=>{}});function AuthProvider(e){let{children:t}=e,[r,c]=(0,s.useState)(null),[u,l]=(0,s.useState)(!0),d=(0,o.useRouter)();(0,s.useEffect)(()=>{let checkSession=async()=>{if(!a.h.isAuthenticated()){l(!1);return}try{let e=await a.h.get("/api/auth/session");e.authenticated&&e.user?c(e.user):a.h.clearToken()}catch(e){console.error("Session check failed:",e),a.h.clearToken()}l(!1)};checkSession()},[]);let signIn=async(e,t)=>{let r=await a.h.post("/api/auth/login",{phone:e,password:t});if(r.error)throw Error(r.error);r.token&&(a.h.setToken(r.token),c(r.user)),d.push("/dashboard"),d.refresh()},signUp=async function(e,t){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],n=await a.h.post("/api/auth/signup",{phone:e,password:t,agreedToPrivacy:r});if(n.error)throw Error(n.error);n.token&&(a.h.setToken(n.token),c(n.user)),d.push("/onboarding"),d.refresh()},signOut=async()=>{try{await a.h.post("/api/auth/logout")}catch(e){}a.h.clearToken(),c(null),d.push("/login"),d.refresh()};return(0,n.jsx)(i.Provider,{value:{user:r,loading:u,signIn,signUp,signOut},children:t})}let useAuth=()=>(0,s.useContext)(i)},4301:function(e,t,r){"use strict";r.d(t,{m:function(){return useSubscription},q:function(){return SubscriptionProvider}});var n=r(8708),s=r(5444),o=r(8681);let a=(0,s.createContext)({subscription:null,loading:!0,refresh:async()=>{}});function SubscriptionProvider(e){let{children:t}=e,[r,i]=(0,s.useState)(null),[c,u]=(0,s.useState)(!0),l=(0,s.useCallback)(async()=>{try{if(!o.h.isAuthenticated()){u(!1);return}let e=await o.h.get("/api/subscription/status");i(e)}catch(e){console.error("Error fetching subscription status:",e)}finally{u(!1)}},[]);return(0,s.useEffect)(()=>{l()},[l]),(0,n.jsx)(a.Provider,{value:{subscription:r,loading:c,refresh:l},children:t})}function useSubscription(){let e=(0,s.useContext)(a);if(!e)throw Error("useSubscription must be used within a SubscriptionProvider");return e}},3883:function(e,t,r){"use strict";r.d(t,{cn:function(){return cn}});var n=r(794),s=r(9654);function cn(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,n.W)(t))}},6811:function(e,t,r){"use strict";function standardizePhoneNumber(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"20",r=e.replace(/[^\d+]/g,"");return r.startsWith("+")?r:r.startsWith(t)?"+".concat(r):r.startsWith("0")?"+".concat(t).concat(r.substring(1)):"+".concat(t).concat(r)}r.d(t,{yL:function(){return standardizePhoneNumber}})},812:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouterContext",{enumerable:!0,get:function(){return o}});let n=r(7675),s=n._(r(5444)),o=s.default.createContext(null)},6923:function(e,t,r){"use strict";r.d(t,{Z:function(){return n.useLanguage}});var n=r(7855)}},function(e){e.O(0,[7683,2056,8679,7855,912,9619,1744],function(){return e(e.s=9559)}),_N_E=e.O()}]);