(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[857],{5101:function(e,s,t){Promise.resolve().then(t.bind(t,3957))},3957:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return OrdersPage}});var r=t(7573),a=t(7653),l=t(6803),n=t(8017),i=t(6528),d=t(9576),o=t(3682),c=t(3226),u=t(4142),x=t(4476),m=t(8695),h=t(7216),f=t(7643),p=t(4896),y=t(372),g=t(2217),b=t(1679),j=t(542),N=t(3848),v=t(2018),w=t(1103),_=t(9795),Z=t(6923),k=t(4301),S=t(2056),C=t.n(S),A=t(8681);function OrdersPage(){var e;let[s,t]=(0,a.useState)([]),[S,P]=(0,a.useState)(!0),[D,E]=(0,a.useState)(null),[R,O]=(0,a.useState)(""),[Q,F]=(0,a.useState)("all"),[I,T]=(0,a.useState)("all"),[z,B]=(0,a.useState)(!1),{t:L,direction:M,language:U}=(0,Z.Z)(),{subscription:V,loading:q}=(0,k.m)(),Y=null!==(e=null==V?void 0:V.isReadOnly)&&void 0!==e&&e,{user:G}=(0,l.useAuth)(),$=(0,a.useCallback)(async()=>{if(G)try{let e=await A.h.get("/api/dashboard/orders");if(e.error){console.error("Error fetching orders:",e.error),P(!1);return}e.storeSettings&&B(!0===e.storeSettings.allow_delivery&&!0===e.storeSettings.allow_pickup),t(e.orders||[])}catch(e){console.error("Unexpected error:",e)}finally{P(!1)}},[G]);(0,a.useEffect)(()=>{$()},[$]);let toggleExpand=e=>{E(D===e?null:e)};return S||q?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[50vh]",children:(0,r.jsx)(n.Z,{className:"w-8 h-8 animate-spin text-gray-400"})}):Y?(0,r.jsx)("div",{className:"max-w-md mx-auto px-4 py-16 text-center",children:(0,r.jsxs)("div",{className:"bg-red-100 border-2 border-red-500 rounded-2xl p-8",children:[(0,r.jsx)(i.Z,{className:"w-16 h-16 mx-auto text-red-600 mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-bold text-red-700 mb-2",children:"ar"===U?"وضع القراءة فقط":"Read-Only Mode"}),(0,r.jsx)("p",{className:"text-red-600 mb-6",children:"ar"===U?"اشتراكك منتهي. جدد للوصول لبيانات الطلبات.":"Your subscription has expired. Renew to access order data."}),(0,r.jsx)(C(),{href:"/dashboard/subscription",className:"inline-block bg-red-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-red-700",children:"ar"===U?"جدد الآن":"Renew Now"})]})}):(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8 pb-32",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:L("dashboard.nav_orders")||"Orders"}),(0,r.jsx)("span",{className:"bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-sm font-medium",children:s.length})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsx)(d.Z,{className:"absolute ".concat("rtl"===M?"right-3":"left-3"," top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4")}),(0,r.jsx)(p.I,{placeholder:L("dashboard.search_orders"),value:R,onChange:e=>O(e.target.value),className:"".concat("rtl"===M?"pr-10":"pl-10"," rounded-xl bg-white")})]}),(0,r.jsxs)(y.Ph,{value:Q,onValueChange:F,children:[(0,r.jsxs)(y.i4,{className:"w-full sm:w-[180px] rounded-xl bg-white",children:[(0,r.jsx)(o.Z,{className:"w-4 h-4 mr-2 text-gray-400"}),(0,r.jsx)(y.ki,{placeholder:"Filter by date"})]}),(0,r.jsxs)(y.Bw,{children:[(0,r.jsx)(y.Ql,{value:"all",children:L("dashboard.filter_all")}),(0,r.jsx)(y.Ql,{value:"today",children:L("dashboard.filter_today")}),(0,r.jsx)(y.Ql,{value:"yesterday",children:L("dashboard.filter_yesterday")}),(0,r.jsx)(y.Ql,{value:"last_7_days",children:L("dashboard.filter_last_7_days")}),(0,r.jsx)(y.Ql,{value:"last_30_days",children:L("dashboard.filter_last_30_days")})]})]}),z&&(0,r.jsxs)(y.Ph,{value:I,onValueChange:T,children:[(0,r.jsx)(y.i4,{className:"w-full sm:w-[150px] rounded-xl bg-white",children:(0,r.jsx)(y.ki,{placeholder:L("dashboard.filter_delivery_type")})}),(0,r.jsxs)(y.Bw,{children:[(0,r.jsx)(y.Ql,{value:"all",children:L("dashboard.filter_all_types")}),(0,r.jsx)(y.Ql,{value:"delivery",children:L("dashboard.filter_delivery")}),(0,r.jsx)(y.Ql,{value:"pickup",children:L("dashboard.filter_pickup")})]})]})]}),0===s.filter(e=>{let s=R.toLowerCase(),t=e.customer_name.toLowerCase().includes(s)||e.customer_phone.includes(s);if(!t)return!1;let r=(0,_.Z)(e.created_at);return"today"===Q?(0,b.Z)(r):"yesterday"===Q?(0,j.Z)(r):"last_7_days"===Q?(0,v.Z)(r,(0,N.Z)((0,w.Z)(new Date),7)):"last_30_days"!==Q||(0,v.Z)(r,(0,N.Z)((0,w.Z)(new Date),30))}).filter(e=>"all"===I||e.delivery_type===I).length?(0,r.jsxs)("div",{className:"text-center py-12 bg-white rounded-2xl border border-dashed border-gray-200",children:[(0,r.jsx)(c.Z,{className:"w-12 h-12 mx-auto text-gray-300 mb-3"}),(0,r.jsx)("p",{className:"text-gray-500",children:L("dashboard.no_orders")||"No orders found"})]}):(0,r.jsx)("div",{className:"space-y-4",children:s.filter(e=>{let s=R.toLowerCase(),t=e.customer_name.toLowerCase().includes(s)||e.customer_phone.includes(s);if(!t)return!1;let r=(0,_.Z)(e.created_at);return"today"===Q?(0,b.Z)(r):"yesterday"===Q?(0,j.Z)(r):"last_7_days"===Q?(0,v.Z)(r,(0,N.Z)((0,w.Z)(new Date),7)):"last_30_days"!==Q||(0,v.Z)(r,(0,N.Z)((0,w.Z)(new Date),30))}).filter(e=>"all"===I||e.delivery_type===I).map(e=>(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center justify-between gap-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>toggleExpand(e.id),children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:["pickup"===e.delivery_type?(0,r.jsx)("span",{title:L("dashboard.filter_pickup"),className:"text-lg",children:"\uD83C\uDFEA"}):(0,r.jsx)("span",{title:L("dashboard.filter_delivery"),className:"text-lg",children:"\uD83C\uDFE0"}),(0,r.jsx)("span",{className:"font-bold text-lg",children:e.customer_name})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-sm text-gray-500",children:[(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(u.Z,{className:"w-3 h-3"})," ",e.customer_phone]}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(x.Z,{className:"w-3 h-3"})," ",(0,g.ZP)(new Date(e.created_at),"MMM d, yyyy h:mm a")]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between sm:justify-end gap-4 min-w-[120px]",children:[(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("div",{className:"font-bold text-lg",children:[L("common.currency")," ",Number(e.total_price).toFixed(2)]}),void 0!==e.shipping_cost&&e.shipping_cost>0&&(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["(Inc. ",L("common.currency")," ",Number(e.shipping_cost).toFixed(2)," Shipping)"]})]}),D===e.id?(0,r.jsx)(m.Z,{className:"w-5 h-5 text-gray-400"}):(0,r.jsx)(h.Z,{className:"w-5 h-5 text-gray-400"})]})]}),D===e.id&&(0,r.jsxs)("div",{className:"p-4 bg-gray-50 border-t border-gray-100 space-y-4",children:[(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsxs)("h4",{className:"font-medium mb-2 text-gray-700 flex items-center gap-2",children:[(0,r.jsx)(f.Z,{className:"w-4 h-4"})," ",L("customers.delivery_address")]}),(0,r.jsxs)("div",{className:"text-gray-600 pl-6 space-y-1",children:[(0,r.jsx)("p",{children:e.customer_address}),(e.city||e.district)&&(0,r.jsx)("p",{className:"text-sm text-gray-400",children:[e.district,e.city].filter(Boolean).join(", ")})]})]}),e.notes&&(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsxs)("h4",{className:"font-medium mb-2 text-gray-700 flex items-center gap-2",children:["\uD83D\uDCDD ",L("common.notes")||"Notes"]}),(0,r.jsx)("p",{className:"text-gray-600 pl-6",children:e.notes})]}),(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsxs)("h4",{className:"font-medium mb-2 text-gray-700 flex items-center gap-2",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4"})," ",L("customers.order_items")]}),(0,r.jsx)("div",{className:"pl-6 space-y-2",children:Array.isArray(e.order_items)&&e.order_items.map((e,s)=>(0,r.jsxs)("div",{className:"flex justify-between items-center text-gray-600 bg-white p-2 rounded-lg border border-gray-100",children:[(0,r.jsxs)("span",{children:[(0,r.jsxs)("span",{className:"font-semibold text-black",children:[e.quantity,"x"]})," ",e.product_name,e.selected_options&&Object.keys(e.selected_options).length>0&&(0,r.jsxs)("span",{className:"text-gray-400 ml-1 text-xs",children:["(",Object.entries(e.selected_options).map(e=>{let[s,t]=e;return"".concat(s,":").concat(t)}).join(", "),")"]})]}),(0,r.jsxs)("span",{children:[L("common.currency")," ",(e.price*e.quantity).toFixed(2)]})]},s))})]})]})]},e.id))})]})}},4896:function(e,s,t){"use strict";t.d(s,{I:function(){return n}});var r=t(7573),a=t(7653),l=t(3883);let n=a.forwardRef((e,s)=>{let{className:t,type:a,...n}=e;return(0,r.jsx)("input",{type:a,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...n})});n.displayName="Input"},372:function(e,s,t){"use strict";t.d(s,{Bw:function(){return f},Ph:function(){return c},Ql:function(){return y},i4:function(){return x},ki:function(){return u}});var r=t(7573),a=t(7653),l=t(5363),n=t(7216),i=t(8695),d=t(9375),o=t(3883);let c=l.fC;l.ZA;let u=l.B4,x=a.forwardRef((e,s)=>{let{className:t,children:a,...i}=e;return(0,r.jsxs)(l.xz,{ref:s,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...i,children:[a,(0,r.jsx)(l.JO,{asChild:!0,children:(0,r.jsx)(n.Z,{className:"h-4 w-4 opacity-50"})})]})});x.displayName=l.xz.displayName;let m=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(l.u_,{ref:s,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})});m.displayName=l.u_.displayName;let h=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(l.$G,{ref:s,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...a,children:(0,r.jsx)(n.Z,{className:"h-4 w-4"})})});h.displayName=l.$G.displayName;let f=a.forwardRef((e,s)=>{let{className:t,children:a,position:n="popper",...i}=e;return(0,r.jsx)(l.h_,{children:(0,r.jsxs)(l.VY,{ref:s,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...i,children:[(0,r.jsx)(m,{}),(0,r.jsx)(l.l_,{className:(0,o.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,r.jsx)(h,{})]})})});f.displayName=l.VY.displayName;let p=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(l.__,{ref:s,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...a})});p.displayName=l.__.displayName;let y=a.forwardRef((e,s)=>{let{className:t,children:a,...n}=e;return(0,r.jsxs)(l.ck,{ref:s,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(l.wU,{children:(0,r.jsx)(d.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(l.eT,{children:a})]})});y.displayName=l.ck.displayName;let g=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(l.Z0,{ref:s,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",t),...a})});g.displayName=l.Z0.displayName},6803:function(e,s,t){"use strict";t.r(s),t.d(s,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var r=t(7573),a=t(7653),l=t(2859),n=t(8681);let i=(0,a.createContext)(void 0);function useAuth(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function AuthProvider(e){let{children:s}=e,[t,d]=(0,a.useState)(null),[o,c]=(0,a.useState)(!0),u=(0,l.useRouter)();(0,a.useEffect)(()=>{let checkSession=async()=>{if(!n.h.isAuthenticated()){c(!1);return}try{let e=await n.h.get("/api/auth/session");e.authenticated&&e.user?d(e.user):n.h.clearToken()}catch(e){console.error("Session check failed:",e),n.h.clearToken()}c(!1)};checkSession()},[]);let signIn=async(e,s)=>{try{let t=await n.h.post("/api/auth/login",{phone:e,password:s});if(t.error)return{error:t.error};return n.h.setToken(t.token),d(t.user),u.push("/dashboard"),{}}catch(e){return{error:e.message}}},signUp=async(e,s)=>{try{let t=await n.h.post("/api/auth/signup",{phone:e,password:s});if(t.error)return{error:t.error};return n.h.setToken(t.token),d(t.user),u.push("/onboarding"),{}}catch(e){return{error:e.message}}};return(0,r.jsx)(i.Provider,{value:{user:t,loading:o,signIn,signUp,signOut:()=>{n.h.clearToken(),d(null),u.push("/login")}},children:s})}},4301:function(e,s,t){"use strict";t.d(s,{m:function(){return useSubscription},q:function(){return SubscriptionProvider}});var r=t(7573),a=t(7653),l=t(8681);let n=(0,a.createContext)({subscription:null,loading:!0,refresh:async()=>{}});function SubscriptionProvider(e){let{children:s}=e,[t,i]=(0,a.useState)(null),[d,o]=(0,a.useState)(!0),c=(0,a.useCallback)(async()=>{try{if(!l.h.isAuthenticated()){o(!1);return}let e=await l.h.get("/api/dashboard/subscription/status");i(e)}catch(e){console.error("Error fetching subscription status:",e)}finally{o(!1)}},[]);return(0,a.useEffect)(()=>{c()},[c]),(0,r.jsx)(n.Provider,{value:{subscription:t,loading:d,refresh:c},children:s})}function useSubscription(){let e=(0,a.useContext)(n);if(!e)throw Error("useSubscription must be used within a SubscriptionProvider");return e}},3883:function(e,s,t){"use strict";t.d(s,{cn:function(){return cn}});var r=t(794),a=t(9654);function cn(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,a.m6)((0,r.W)(s))}},6923:function(e,s,t){"use strict";t.d(s,{Z:function(){return r.useLanguage}});var r=t(7855)}},function(e){e.O(0,[383,56,154,32,297,834,612,293,53,744],function(){return e(e.s=5101)}),_N_E=e.O()}]);