(()=>{var e={};e.id=8461,e.ids=[8461],e.modules={55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},89050:(e,a,r)=>{"use strict";r.r(a),r.d(a,{GlobalError:()=>o.a,__next_app__:()=>u,originalPathname:()=>g,pages:()=>c,routeModule:()=>p,tree:()=>d});var t=r(66965),s=r(74902),n=r(36408),o=r.n(n),i=r(14346),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);r.d(a,l);let d=["",{children:["onboarding",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,56859)),"D:\\whatsou\\apps\\mobile\\app\\onboarding\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,95357)),"D:\\whatsou\\apps\\mobile\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,31227)),"D:\\whatsou\\apps\\mobile\\app\\not-found.tsx"]}],c=["D:\\whatsou\\apps\\mobile\\app\\onboarding\\page.tsx"],g="/onboarding/page",u={require:r,loadChunk:()=>Promise.resolve()},p=new t.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/onboarding/page",pathname:"/onboarding",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},61676:(e,a,r)=>{Promise.resolve().then(r.bind(r,71975))},71975:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>OnboardingPage});var t=r(84196),s=r(78726),n=r(91514),o=r(74555),i=r(12428),l=r(69211),d=r(2420),c=r(12753),g=r(91586),u=r(62364),p=r(32583),x=r(38249),m=r(58406),h=r(8336),b=r(53374),f=r(6006),v=r(85905),j=r(29930),N=r(64690),_=r(25413),w=r(19886),y=r(19328),k=r.n(y),C=r(82182),S=r(2391),P=r(15246),q=r(52065);function OnboardingPage(){let[e,a]=(0,s.useState)(1),[y,I]=(0,s.useState)(!1),[L,$]=(0,s.useState)(!0),{user:E,loading:Z}=(0,n.a)(),D=(0,o.useRouter)(),{toast:A}=(0,_.pm)(),{t:O,language:z,setLanguage:U,direction:G}=(0,S.Z)(),[T,R]=(0,s.useState)(""),[M,F]=(0,s.useState)(""),[B,H]=(0,s.useState)(!1),[V,W]=(0,s.useState)(""),[X,Y]=(0,s.useState)(!0),[J,K]=(0,s.useState)(!1),[Q,ee]=(0,s.useState)("en"),[ea,er]=(0,s.useState)(null),[et,es]=(0,s.useState)(""),[en,eo]=(0,s.useState)(""),[ei,el]=(0,s.useState)(""),[ed,ec]=(0,s.useState)(""),[eg,eu]=(0,s.useState)(""),[ep,ex]=(0,s.useState)(""),[em,eh]=(0,s.useState)("");(0,s.useEffect)(()=>{let checkExistingStore=async()=>{if(Z)return;if(!E){D.push("/login");return}let{data:e}=await i.O.from("stores").select("id").eq("user_id",E.id).maybeSingle();e?D.push("/dashboard"):$(!1)};checkExistingStore()},[E,D,Z]);let handleDefaultLanguageChange=e=>{ee(e),("ar"===e||"en"===e)&&U(e)},generateSlug=e=>(0,P.l)(e),handleNativeLogoCamera=async()=>{try{let{Camera:e,CameraResultType:a,CameraSource:t}=await r.e(8952).then(r.t.bind(r,98952,19)),s=await e.getPhoto({quality:90,allowEditing:!1,resultType:a.DataUrl,source:t.Photos});if(s.dataUrl){es(s.dataUrl);let e=await fetch(s.dataUrl),a=await e.blob(),r=new File([a],"logo.jpg",{type:a.type});er(r)}}catch(e){console.error("Camera error",e)}},handleGetLocation=async()=>{if(q.Capacitor.isNativePlatform()){try{A({title:O("onboarding.locating"),description:O("onboarding.getting_location")});let{Geolocation:e}=await r.e(9640).then(r.bind(r,59640)),a=await e.checkPermissions();if("granted"!==a.location){let a=await e.requestPermissions();if("granted"!==a.location)throw Error("Permission denied")}let t=await e.getCurrentPosition(),{latitude:s,longitude:n}=t.coords,o=`https://www.google.com/maps?q=${s},${n}`;eh(o),A({title:O("onboarding.location_found"),description:O("onboarding.location_set")})}catch(e){console.error("Geolocation error:",e),A({title:O("common.error"),description:e.message||O("onboarding.location_error"),variant:"destructive"})}return}if(!navigator.geolocation){A({title:O("common.error"),description:O("onboarding.geolocation_not_supported"),variant:"destructive"});return}A({title:O("onboarding.locating"),description:O("onboarding.getting_location")}),navigator.geolocation.getCurrentPosition(e=>{let{latitude:a,longitude:r}=e.coords,t=`https://www.google.com/maps?q=${a},${r}`;eh(t),A({title:O("onboarding.location_found"),description:O("onboarding.location_set")})},e=>{console.error("Geolocation error:",e);let a=O("onboarding.location_error");e.code===e.PERMISSION_DENIED?a=O("onboarding.location_permission_denied"):e.code===e.POSITION_UNAVAILABLE?a=O("onboarding.location_unavailable"):e.code===e.TIMEOUT&&(a=O("onboarding.location_timeout")),A({title:O("common.error"),description:a,variant:"destructive"})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},uploadLogo=async()=>{if(!ea)return null;try{let e=new FormData;e.append("file",ea),e.append("folder","logos");let a=q.Capacitor.isNativePlatform()?"https://whatsou.com":"",r=await fetch(`${a}/api/upload`,{method:"POST",body:e,headers:{...l.h.getToken()?{Authorization:`Bearer ${l.h.getToken()}`}:{}}}),t=await r.json();if(!r.ok)throw Error(t.error||"Upload failed");return t.url}catch(e){return console.error("Logo upload error:",e),A({title:O("onboarding.logo_upload_warning"),description:O("onboarding.logo_upload_failed"),variant:"destructive"}),null}},handleSubmit=async()=>{if(E){I(!0);try{let e=M||generateSlug(T),{data:r}=await i.O.from("stores").select("id").eq("slug",e).maybeSingle();if(r){A({title:O("onboarding.store_name_taken"),description:O("onboarding.store_name_taken_desc"),variant:"destructive"}),I(!1),a(1);return}let t=await uploadLogo(),s={name:T,slug:e,description:V,whatsapp_number:(0,w.yL)(E.phone),default_language:Q,email:en,logo_url:t,facebook_url:ei,instagram_url:ed,twitter_url:eg,tiktok_url:ep,location_url:em,allow_delivery:X,allow_pickup:J},n=await l.h.post("/api/dashboard/store",s);if(n.error)throw Error(n.error);A({title:O("onboarding.store_created"),description:O("onboarding.welcome_message")}),D.push("/dashboard/subscription")}catch(e){A({title:O("common.error"),description:e.message,variant:"destructive"}),I(!1)}}};return L?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):(0,t.jsxs)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 to-teal-50 p-4",dir:G,children:[t.jsx(d.z,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 bg-white/50 backdrop-blur-sm rounded-full hover:bg-white/80 transition-all z-10",onClick:()=>{U("en"===z?"ar":"en")},title:"Switch Language",children:t.jsx(p.Z,{className:"w-5 h-5 text-green-700"})}),(0,t.jsxs)(u.Zb,{className:"w-full max-w-2xl rounded-3xl shadow-xl overflow-hidden",children:[t.jsx("div",{className:"bg-green-600 p-2",children:(0,t.jsxs)("div",{className:`flex justify-center gap-2 ${"rtl"===G?"flex-row-reverse":""}`,children:[t.jsx("div",{className:`h-2 w-1/2 rounded-full transition-all ${e>=1?"bg-white":"bg-green-800/30"}`}),t.jsx("div",{className:`h-2 w-1/2 rounded-full transition-all ${e>=2?"bg-white":"bg-green-800/30"}`})]})}),(0,t.jsxs)(u.Ol,{className:"text-center space-y-4 pt-8",children:[t.jsx("div",{className:"mx-auto bg-green-100 w-16 h-16 rounded-3xl flex items-center justify-center mb-2",children:1===e?t.jsx(k(),{src:"/logo.png",alt:"WhatSou Logo",width:48,height:48,className:"w-10 h-10 object-contain"}):t.jsx(x.Z,{className:"w-8 h-8 text-green-600"})}),t.jsx(u.ll,{className:"text-3xl font-bold",children:1===e?O("onboarding.step1_title"):O("onboarding.step2_title")}),t.jsx(u.SZ,{className:"text-base",children:1===e?O("onboarding.step1_desc"):O("onboarding.step2_desc")})]}),t.jsx(u.aY,{className:"p-8",children:1===e?(0,t.jsxs)("div",{className:"space-y-6 animate-in slide-in-from-right-8 fade-in-0 duration-300",children:[(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(C._,{children:[O("onboarding.store_name")," ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx(c.I,{placeholder:O("onboarding.store_name"),value:T,onChange:e=>R(e.target.value),className:"rounded-xl h-12"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[t.jsx("p",{className:"text-xs text-muted-foreground",dir:"ltr",children:O("onboarding.store_url").replace("{slug}","")}),B?(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-1 max-w-[200px]",children:[t.jsx(c.I,{value:M,onChange:e=>F((0,P.l)(e.target.value)),className:"h-7 text-xs px-2 rounded-md",autoFocus:!0,placeholder:"my-store"}),t.jsx("button",{onClick:()=>H(!1),className:"p-1 hover:bg-gray-100 rounded-full text-green-600",children:t.jsx(m.Z,{className:"w-4 h-4"})})]}):(0,t.jsxs)("div",{className:"flex items-center gap-2 group",children:[t.jsx("span",{className:"font-medium text-xs text-green-700 bg-green-50 px-2 py-0.5 rounded dir-ltr",children:M||generateSlug(T)||"store-name"}),t.jsx("button",{onClick:()=>{M||F(generateSlug(T)),H(!0)},className:"p-1 opacity-0 group-hover:opacity-100 transition-opacity hover:bg-gray-100 rounded-full text-gray-500",title:"Edit URL",children:t.jsx(h.Z,{className:"w-3 h-3"})})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(C._,{children:O("onboarding.default_language")}),(0,t.jsxs)("div",{className:"flex gap-4 p-3 border rounded-xl bg-gray-50/50",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"language",value:"en",checked:"en"===Q,onChange:e=>handleDefaultLanguageChange(e.target.value),className:"w-4 h-4 text-green-600 focus:ring-green-600"}),t.jsx("span",{children:O("onboarding.english")})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"language",value:"ar",checked:"ar"===Q,onChange:e=>handleDefaultLanguageChange(e.target.value),className:"w-4 h-4 text-green-600 focus:ring-green-600"}),t.jsx("span",{children:O("onboarding.arabic")})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(C._,{children:[O("onboarding.description")," ",t.jsx("span",{className:"text-xs text-gray-400",children:O("onboarding.description_optional")})]}),t.jsx(g.g,{placeholder:O("onboarding.description_placeholder"),value:V,onChange:e=>W(e.target.value),className:"rounded-xl resize-none",rows:3})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(C._,{children:[O("settings.delivery_options")," ",t.jsx("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsxs)("label",{className:`flex items-center gap-3 p-4 border-2 rounded-xl cursor-pointer transition-all ${X?"border-green-500 bg-green-50":"border-gray-200 bg-gray-50/50 hover:border-gray-300"}`,children:[t.jsx("input",{type:"checkbox",checked:X,onChange:e=>Y(e.target.checked),className:"w-5 h-5 text-green-600 focus:ring-green-600 rounded"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx(b.Z,{className:"w-5 h-5 text-green-600"}),t.jsx("span",{className:"font-medium",children:O("settings.allow_delivery")})]})]}),(0,t.jsxs)("label",{className:`flex items-center gap-3 p-4 border-2 rounded-xl cursor-pointer transition-all ${J?"border-green-500 bg-green-50":"border-gray-200 bg-gray-50/50 hover:border-gray-300"}`,children:[t.jsx("input",{type:"checkbox",checked:J,onChange:e=>K(e.target.checked),className:"w-5 h-5 text-green-600 focus:ring-green-600 rounded"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx(f.Z,{className:"w-5 h-5 text-green-600"}),t.jsx("span",{className:"font-medium",children:O("settings.allow_pickup")})]})]})]}),t.jsx("p",{className:"text-xs text-muted-foreground",children:O("onboarding.delivery_options_hint")})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(C._,{children:O("onboarding.whatsapp_number")}),(0,t.jsxs)("div",{className:"relative",children:[t.jsx(c.I,{value:E?.phone||"",disabled:!0,className:`rounded-xl h-12 bg-gray-50 ${"rtl"===G?"pr-10":"pl-10"}`}),t.jsx(v.Z,{className:`w-4 h-4 absolute top-4 text-gray-400 ${"rtl"===G?"right-3":"left-3"}`}),(0,t.jsxs)("div",{className:`absolute top-3 bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full flex items-center gap-1 ${"rtl"===G?"left-3":"right-3"}`,children:[t.jsx(m.Z,{className:"w-3 h-3"})," ",O("onboarding.verified")]})]}),t.jsx("p",{className:"text-xs text-muted-foreground",children:O("onboarding.linked_account")})]}),t.jsx(d.z,{onClick:()=>{if(!T.trim()){A({title:O("onboarding.required_field"),description:O("onboarding.enter_store_name"),variant:"destructive"});return}if(!X&&!J){A({title:O("onboarding.required_field"),description:O("settings.delivery_required_error"),variant:"destructive"});return}a(2)},className:"w-full h-12 rounded-xl bg-green-600 hover:bg-green-700 text-base font-semibold mt-4",children:O("onboarding.next_step")})]}):(0,t.jsxs)("div",{className:"space-y-6 animate-in slide-in-from-right-8 fade-in-0 duration-300",children:[(0,t.jsxs)("label",{className:"flex flex-col items-center justify-center p-6 border-2 border-dashed border-gray-200 rounded-2xl bg-gray-50/50 hover:bg-gray-100 transition-all cursor-pointer group",onClick:e=>{q.Capacitor.isNativePlatform()&&(e.preventDefault(),handleNativeLogoCamera())},children:[t.jsx("input",{type:"file",accept:"image/*",onChange:e=>{let a=e.target.files?.[0];if(a){er(a);let e=new FileReader;e.onloadend=()=>{es(e.result)},e.readAsDataURL(a)}},className:(q.Capacitor.isNativePlatform(),"hidden")}),(0,t.jsxs)("div",{className:"relative w-24 h-24 mb-4",children:[et?t.jsx(k(),{src:et,alt:"Logo preview",fill:!0,className:"object-cover rounded-full border-4 border-white shadow-md"}):t.jsx("div",{className:"w-full h-full rounded-full bg-white flex items-center justify-center border-2 border-green-100 shadow-sm group-hover:border-green-200 transition-colors",children:t.jsx(j.Z,{className:"w-8 h-8 text-green-600 opacity-50 group-hover:opacity-100 transition-opacity"})}),t.jsx("div",{className:`absolute bottom-0 p-1.5 bg-green-600 rounded-full text-white shadow-lg group-hover:bg-green-700 transition-colors ${"rtl"===G?"left-0":"right-0"}`,children:t.jsx(j.Z,{className:"w-4 h-4"})})]}),t.jsx("p",{className:"text-sm font-medium text-gray-600 group-hover:text-green-700 transition-colors",children:O("onboarding.upload_logo")}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:O("onboarding.logo_recommended")})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(C._,{children:O("onboarding.support_email")}),t.jsx(c.I,{type:"email",placeholder:O("onboarding.support_email_placeholder"),value:en,onChange:e=>eo(e.target.value),className:"rounded-xl"})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(C._,{className:"text-xs text-gray-500 uppercase font-semibold",children:O("onboarding.facebook")}),t.jsx(c.I,{placeholder:"facebook.com/...",value:ei,onChange:e=>el(e.target.value),className:"rounded-xl"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(C._,{className:"text-xs text-gray-500 uppercase font-semibold",children:O("onboarding.instagram")}),t.jsx(c.I,{placeholder:"instagram.com/...",value:ed,onChange:e=>ec(e.target.value),className:"rounded-xl"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(C._,{className:"text-xs text-gray-500 uppercase font-semibold",children:O("onboarding.twitter")}),t.jsx(c.I,{placeholder:"twitter.com/...",value:eg,onChange:e=>eu(e.target.value),className:"rounded-xl"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[t.jsx(C._,{className:"text-xs text-gray-500 uppercase font-semibold",children:O("onboarding.tiktok")}),t.jsx(c.I,{placeholder:"tiktok.com/@...",value:ep,onChange:e=>ex(e.target.value),className:"rounded-xl"})]}),(0,t.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[t.jsx(C._,{className:"text-xs text-gray-500 uppercase font-semibold",children:O("onboarding.location")}),(0,t.jsxs)("div",{className:"flex gap-2",children:[t.jsx(c.I,{placeholder:"https://maps.google.com/...",value:em,onChange:e=>eh(e.target.value),className:"rounded-xl"}),t.jsx(d.z,{type:"button",variant:"outline",onClick:handleGetLocation,className:"rounded-xl shrink-0",title:O("onboarding.get_current_location"),children:t.jsx(f.Z,{className:"w-4 h-4"})})]})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-4",children:[t.jsx(d.z,{variant:"outline",onClick:()=>a(1),className:"h-12 w-12 rounded-xl border-gray-200 p-0 shrink-0",children:t.jsx(N.Z,{className:`w-5 h-5 ${"rtl"===G?"rotate-180":""}`})}),t.jsx(d.z,{onClick:handleSubmit,disabled:y,className:"flex-1 h-12 rounded-xl bg-green-600 hover:bg-green-700 text-base font-semibold",children:y?O("onboarding.creating_store"):O("onboarding.launch_store")})]})]})})]})]})}},12753:(e,a,r)=>{"use strict";r.d(a,{I:()=>o});var t=r(84196),s=r(78726),n=r(42135);let o=s.forwardRef(({className:e,type:a,...r},s)=>t.jsx("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...r}));o.displayName="Input"},56859:(e,a,r)=>{"use strict";r.r(a),r.d(a,{$$typeof:()=>o,__esModule:()=>n,default:()=>l});var t=r(64074);let s=(0,t.createProxy)(String.raw`D:\whatsou\apps\mobile\app\onboarding\page.tsx`),{__esModule:n,$$typeof:o}=s,i=s.default,l=i}};var a=require("../../webpack-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),r=a.X(0,[3831,890,9239,881,130,4861,9886,7953,9230],()=>__webpack_exec__(89050));module.exports=r})();