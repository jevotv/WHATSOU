(()=>{var e={};e.id=6633,e.ids=[6633],e.modules={55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},57147:e=>{"use strict";e.exports=require("fs")},12781:e=>{"use strict";e.exports=require("stream")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},93372:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>c,routeModule:()=>p,tree:()=>d});var s=a(66965),r=a(74902),n=a(36408),i=a.n(n),l=a(14346),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);a.d(t,o);let d=["",{children:["dashboard",{children:["subscription",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,52469)),"D:\\whatsou\\apps\\mobile\\app\\dashboard\\subscription\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,97913)),"D:\\whatsou\\apps\\mobile\\app\\dashboard\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,95357)),"D:\\whatsou\\apps\\mobile\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.bind(a,31227)),"D:\\whatsou\\apps\\mobile\\app\\not-found.tsx"]}],c=["D:\\whatsou\\apps\\mobile\\app\\dashboard\\subscription\\page.tsx"],x="/dashboard/subscription/page",m={require:a,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/subscription/page",pathname:"/dashboard/subscription",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},5080:(e,t,a)=>{Promise.resolve().then(a.bind(a,25839))},25839:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>SubscriptionPage});var s=a(84196),r=a(78726),n=a(74555),i=a(2391),l=a(57700),o=a(69211),d=a(81651),c=a(37714),x=a(22692),m=a(77371),p=a(66447),u=a(40986),h=a(72312),b=a(67782),g=a(62509),y=a(53058),f=a(64626);let j={active:{color:"bg-green-500",textColor:"text-green-600",bgColor:"bg-green-50",icon:d.Z,labelAr:"نشط",labelEn:"Active"},grace:{color:"bg-yellow-500",textColor:"text-yellow-600",bgColor:"bg-yellow-50",icon:c.Z,labelAr:"فترة سماح",labelEn:"Grace Period"},expired:{color:"bg-red-500",textColor:"text-red-600",bgColor:"bg-red-50",icon:x.Z,labelAr:"منتهي",labelEn:"Expired"},inactive:{color:"bg-gray-400",textColor:"text-gray-600",bgColor:"bg-gray-50",icon:m.Z,labelAr:"غير نشط",labelEn:"Inactive"}};function SubscriptionPage(){let{t:e,direction:t,language:a}=(0,i.Z)(),c=(0,n.useRouter)(),x=(0,n.useSearchParams)(),{subscription:m,refresh:w}=(0,l.m)(),[v,N]=(0,r.useState)([]),[_,P]=(0,r.useState)(!0),[S,C]=(0,r.useState)(!1),[k,E]=(0,r.useState)("card"),[$,q]=(0,r.useState)("monthly"),[A,R]=(0,r.useState)(!1),[Z,D]=(0,r.useState)(null);async function loadHistory(){P(!0);try{let e=await o.h.get("/api/dashboard/subscription/history");N(e.transactions||[])}catch(e){console.error("Error fetching history:",e)}finally{P(!1)}}async function handlePayment(){if(C(!0),"instapay"===k||"vodafone"===k){try{let e=await o.h.post("/api/dashboard/subscription/manual-pay",{payment_method:k,subscription_period:$});if(e.error){alert(e.error),C(!1);return}D(e)}catch(e){alert(e.message||"Payment failed")}finally{C(!1)}return}try{let e=await o.h.post("/api/dashboard/subscription/pay",{paymentMethod:"card"});if(e.error){alert(e.error),C(!1);return}e.payment_url?window.location.href=e.payment_url:e.client_secret&&e.public_key?window.location.href=`https://accept.paymob.com/unifiedcheckout/?publicKey=${e.public_key}&clientSecret=${e.client_secret}`:(C(!1),alert("Something went wrong. Please try again."))}catch(e){alert(e.message||"Payment initiation failed"),C(!1)}}if((0,r.useEffect)(()=>{loadHistory(),w(),"complete"===x.get("status")&&(R(!0),setTimeout(()=>R(!1),5e3))},[x,w]),!m)return s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#008069]"})});let G=j[m?.status||"inactive"],M=G.icon;return(0,s.jsxs)("div",{className:"p-4 max-w-2xl mx-auto space-y-6",dir:t,children:[(0,s.jsxs)("button",{onClick:()=>c.push("/dashboard"),className:"flex items-center gap-2 text-gray-600 hover:text-[#008069] transition",children:[s.jsx(p.Z,{className:"w-5 h-5"}),s.jsx("span",{className:"font-medium",children:"ar"===a?"الرئيسية":"Home"})]}),A&&s.jsx("div",{className:"fixed top-4 right-4 left-4 md:left-auto md:w-96 bg-green-500 text-white p-4 rounded-lg shadow-lg z-50 animate-slide-down",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx(d.Z,{className:"w-6 h-6"}),s.jsx("span",{children:"ar"===a?"تم تفعيل اشتراكك بنجاح!":"Subscription activated successfully!"})]})}),(0,s.jsxs)("div",{className:`rounded-2xl ${G.bgColor} p-6 shadow-sm`,children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"ar"===a?"الاشتراك":"Subscription"}),s.jsx("button",{onClick:()=>{w(),loadHistory()},className:"p-2 hover:bg-white/50 rounded-full transition",children:s.jsx(u.Z,{className:"w-5 h-5 text-gray-500"})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[s.jsx("div",{className:`w-16 h-16 ${G.color} rounded-full flex items-center justify-center`,children:s.jsx(M,{className:"w-8 h-8 text-white"})}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:`text-2xl font-bold ${G.textColor}`,children:"ar"===a?G.labelAr:G.labelEn}),m?.daysRemaining!==null&&m?.daysRemaining!==void 0&&m.daysRemaining>0&&s.jsx("p",{className:"text-gray-600",children:"ar"===a?`متبقي ${m.daysRemaining} يوم`:`${m.daysRemaining} days remaining`})]})]}),m?.isReadOnly&&s.jsx("div",{className:"bg-yellow-100 border border-yellow-300 rounded-lg p-4 mb-4",children:s.jsx("p",{className:"text-yellow-800 font-medium",children:"ar"===a?"⚠️ لوحة التحكم في وضع القراءة فقط. جدد اشتراكك للاستمرار.":"⚠️ Dashboard is in read-only mode. Renew to continue."})}),m?.expiresAt&&"active"===m.status&&(0,s.jsxs)("p",{className:"text-gray-500 text-sm",children:["ar"===a?"ينتهي في: ":"Expires: ",new Date(m.expiresAt).toLocaleDateString("ar"===a?"ar-EG":"en-US",{year:"numeric",month:"long",day:"numeric"})]})]}),(m?.status!=="active"||m?.daysRemaining!==null&&m?.daysRemaining!==void 0&&m.daysRemaining<=7)&&(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[s.jsx("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:m?.status==="active"?"ar"===a?"تجديد مبكر":"Early Renewal":"ar"===a?"اشترك الآن":"Subscribe Now"}),!m?.isFirstSubscription&&s.jsx("div",{className:"flex justify-center mb-6",children:(0,s.jsxs)("div",{className:"bg-gray-100 p-1 rounded-xl flex",dir:"ltr",children:[s.jsx("button",{onClick:()=>q("monthly"),className:`px-6 py-2 rounded-lg text-sm font-medium transition-all ${"monthly"===$?"bg-white text-[#008069] shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Monthly"}),(0,s.jsxs)("button",{onClick:()=>q("yearly"),className:`px-6 py-2 rounded-lg text-sm font-medium transition-all ${"yearly"===$?"bg-white text-[#008069] shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:["Yearly",s.jsx("span",{className:"ml-1 text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded-full",children:"-16%"})]})]})}),(0,s.jsxs)("div",{className:"bg-gradient-to-r from-[#008069] to-[#00a884] text-white rounded-xl p-4 mb-6",children:[(0,s.jsxs)("p",{className:"text-3xl font-bold",children:[m?.isFirstSubscription?100:"yearly"===$?3e3:300," EGP"]}),s.jsx("p",{className:"opacity-80",children:m?.isFirstSubscription?"ar"===a?"للشهر الأول":"for the first month":"yearly"===$?"ar"===a?"سنوياً":"per year":"ar"===a?"شهرياً":"per month"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[(0,s.jsxs)("button",{disabled:!0,className:"p-4 rounded-xl border-2 border-gray-200 bg-gray-100 opacity-60 cursor-not-allowed flex flex-col items-center gap-1",children:[s.jsx(h.Z,{className:"w-6 h-6 text-gray-400"}),s.jsx("span",{className:"text-sm font-medium text-gray-400",children:"ar"===a?"بطاقة":"Card"}),s.jsx("span",{className:"text-xs text-gray-400",children:"ar"===a?"قريباً":"Soon"})]}),(0,s.jsxs)("button",{onClick:()=>{E("instapay"),D(null)},className:`p-4 rounded-xl border-2 transition flex flex-col items-center gap-2 ${"instapay"===k?"border-[#008069] bg-[#008069]/5":"border-gray-200 hover:border-gray-300"}`,children:[s.jsx(b.Z,{className:`w-6 h-6 ${"instapay"===k?"text-[#008069]":"text-gray-400"}`}),s.jsx("span",{className:`text-sm font-medium ${"instapay"===k?"text-[#008069]":"text-gray-600"}`,children:"InstaPay"})]}),(0,s.jsxs)("button",{onClick:()=>{E("vodafone"),D(null)},className:`p-4 rounded-xl border-2 transition flex flex-col items-center gap-2 ${"vodafone"===k?"border-[#008069] bg-[#008069]/5":"border-gray-200 hover:border-gray-300"}`,children:[s.jsx(g.Z,{className:`w-6 h-6 ${"vodafone"===k?"text-[#008069]":"text-gray-400"}`}),s.jsx("span",{className:`text-sm font-medium ${"vodafone"===k?"text-[#008069]":"text-gray-600"}`,children:"Vodafone"})]})]}),Z&&("instapay"===k||"vodafone"===k)&&(0,s.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4 space-y-4",children:[s.jsx("p",{className:"text-amber-800 font-medium text-center",children:"ar"===a?"✅ تم منحك صلاحية 24 ساعة مؤقتة":"✅ You have 24h temporary access"}),(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsxs)("a",{href:Z.payment_link,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 bg-blue-600 text-white py-3 px-4 rounded-xl font-medium hover:bg-blue-700",children:[s.jsx(y.Z,{className:"w-5 h-5"}),"ar"===a?"افتح رابط الدفع":"Open Payment Link"]}),(0,s.jsxs)("a",{href:Z.whatsapp_link,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 bg-[#25D366] text-white py-3 px-4 rounded-xl font-medium hover:bg-[#1ebe57]",children:[s.jsx(f.Z,{className:"w-5 h-5"}),"ar"===a?"أرسل السكرين شوت":"Send Screenshot"]})]}),s.jsx("p",{className:"text-sm text-gray-500 text-center",children:"ar"===a?"بعد الدفع، أرسل سكرين شوت التحويل على الواتساب":"After payment, send the screenshot via WhatsApp"})]}),(!Z||"card"===k)&&s.jsx("button",{onClick:handlePayment,disabled:S,className:"w-full bg-[#008069] hover:bg-[#006a58] text-white font-bold py-4 px-6 rounded-xl transition disabled:opacity-50 disabled:cursor-not-allowed",children:S?(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[s.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),s.jsx("span",{children:"ar"===a?"جاري التحميل...":"Loading..."})]}):"card"===k?"ar"===a?"ادفع الآن":"Pay Now":"ar"===a?"تأكيد الدفع":"Confirm Payment"})]}),v.length>0&&(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[s.jsx("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:"ar"===a?"سجل المدفوعات":"Payment History"}),s.jsx("div",{className:"space-y-3",children:v.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"font-medium text-gray-800",children:[e.amount," EGP"]}),s.jsx("p",{className:"text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("ar"===a?"ar-EG":"en-US")})]}),s.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${"success"===e.status?"bg-green-100 text-green-700":"pending"===e.status?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:"success"===e.status?"ar"===a?"ناجح":"Success":"pending"===e.status?"ar"===a?"قيد الانتظار":"Pending":"ar"===a?"فشل":"Failed"})]},e.id))})]})]})}},52469:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>o});var s=a(64074);let r=(0,s.createProxy)(String.raw`D:\whatsou\apps\mobile\app\dashboard\subscription\page.tsx`),{__esModule:n,$$typeof:i}=r,l=r.default,o=l}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[3831,890,8849,8690,130,4861,364],()=>__webpack_exec__(93372));module.exports=a})();