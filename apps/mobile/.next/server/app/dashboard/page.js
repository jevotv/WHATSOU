(()=>{var e={};e.id=702,e.ids=[702],e.modules={55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},57147:e=>{"use strict";e.exports=require("fs")},12781:e=>{"use strict";e.exports=require("stream")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},27786:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>o});var s=a(66965),r=a(74902),l=a(36408),i=a.n(l),n=a(14346),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);a.d(t,d);let o=["",{children:["dashboard",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,41179)),"D:\\whatsou\\apps\\mobile\\app\\dashboard\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,97913)),"D:\\whatsou\\apps\\mobile\\app\\dashboard\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,47806)),"D:\\whatsou\\apps\\mobile\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.bind(a,31227)),"D:\\whatsou\\apps\\mobile\\app\\not-found.tsx"]}],c=["D:\\whatsou\\apps\\mobile\\app\\dashboard\\page.tsx"],u="/dashboard/page",m={require:a,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/page",pathname:"/dashboard",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},34524:(e,t,a)=>{Promise.resolve().then(a.bind(a,46237))},46237:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>DashboardPage});var s=a(84196),r=a(24850),l=a(56617),i=a(86442),n=a(28467),d=a(78726),o=a(65714),c=a(74555),u=a(2420),m=a(12753),p=a(25413),x=a(62364),h=a(83382),g=a(60546),v=a(19328),b=a.n(v),f=a(97487);function ProductCard({product:e,onEdit:t,onDelete:a}){let{t:r,direction:l}=(0,f.Z)(),n=e.original_price&&e.original_price>e.current_price,d=n?Math.round((e.original_price-e.current_price)/e.original_price*100):0,o=e.variants&&e.variants.length>0,c=o?e.variants.reduce((e,t)=>e+t.quantity,0):e.quantity,m=e.unlimited_stock;return(0,s.jsxs)(x.Zb,{className:"rounded-3xl overflow-hidden hover:shadow-xl transition-shadow group",dir:l,children:[(0,s.jsxs)("div",{className:"relative aspect-square bg-gray-100",children:[e.thumbnail_url||e.image_url?s.jsx(b(),{src:e.thumbnail_url||e.image_url,alt:e.name,fill:!0,className:"object-cover"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200",children:s.jsx(i.Z,{className:"w-16 h-16 text-gray-400"})}),n&&(0,s.jsxs)("div",{className:`absolute top-3 ${"rtl"===l?"right-3":"left-3"} bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold z-10`,children:["-",d,"%"]}),(0,s.jsxs)("div",{className:`absolute top-3 ${"rtl"===l?"left-3":"right-3"} opacity-0 group-hover:opacity-100 transition-opacity flex gap-2 z-10`,children:[s.jsx(u.z,{size:"icon",onClick:()=>t(e),className:"rounded-full bg-white text-gray-900 hover:bg-gray-100 shadow-lg",children:s.jsx(h.Z,{className:"w-4 h-4"})}),s.jsx(u.z,{size:"icon",onClick:()=>a(e.id),variant:"destructive",className:"rounded-full shadow-lg",children:s.jsx(g.Z,{className:"w-4 h-4"})})]})]}),(0,s.jsxs)(x.aY,{className:"p-4 space-y-2",children:[s.jsx("h3",{className:"font-bold text-lg line-clamp-1",children:e.name}),e.description&&s.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.description}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("span",{className:"text-xl font-bold text-green-600",children:[r("common.currency")," ",e.current_price.toFixed(2)]}),n&&(0,s.jsxs)("span",{className:"text-sm text-gray-400 line-through",children:[r("common.currency")," ",e.original_price.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[(0,s.jsxs)("span",{children:[r("products.stock_label"),": ",m?"∞":c,o&&(0,s.jsxs)("span",{className:"text-xs mx-1",children:["(",e.variants.length," ",r("products.variants_label"),")"]})]}),e.category&&s.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded-full text-xs",children:e.category})]}),e.options&&e.options.length>0&&s.jsx("div",{className:"pt-2 border-t",children:s.jsx("p",{className:"text-xs text-gray-500",children:r("products.options_available",{count:e.options.length})})})]})]})}var j=a(12428),y=a(69211),N=a(77952),w=a(31340),_=a(42135);let k=w.fC;w.xz;let S=w.h_,C=d.forwardRef(({className:e,...t},a)=>s.jsx(w.aV,{className:(0,_.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:a}));C.displayName=w.aV.displayName;let I=d.forwardRef(({className:e,...t},a)=>(0,s.jsxs)(S,{children:[s.jsx(C,{}),s.jsx(w.VY,{ref:a,className:(0,_.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));I.displayName=w.VY.displayName;let AlertDialogHeader=({className:e,...t})=>s.jsx("div",{className:(0,_.cn)("flex flex-col space-y-2 text-center sm:text-left",e),...t});AlertDialogHeader.displayName="AlertDialogHeader";let AlertDialogFooter=({className:e,...t})=>s.jsx("div",{className:(0,_.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});AlertDialogFooter.displayName="AlertDialogFooter";let P=d.forwardRef(({className:e,...t},a)=>s.jsx(w.Dx,{ref:a,className:(0,_.cn)("text-lg font-semibold",e),...t}));P.displayName=w.Dx.displayName;let q=d.forwardRef(({className:e,...t},a)=>s.jsx(w.dk,{ref:a,className:(0,_.cn)("text-sm text-muted-foreground",e),...t}));q.displayName=w.dk.displayName;let z=d.forwardRef(({className:e,...t},a)=>s.jsx(w.aU,{ref:a,className:(0,_.cn)((0,u.d)(),e),...t}));z.displayName=w.aU.displayName;let D=d.forwardRef(({className:e,...t},a)=>s.jsx(w.$j,{ref:a,className:(0,_.cn)((0,u.d)({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));D.displayName=w.$j.displayName;var U=a(91586),Z=a(82182),O=a(12209);let R=O.fC,A=O.wy,E=O.Fw;var F=a(8410),V=a(81390),$=a(47146),M=a(30606),T=a(40986),L=a(93064),Q=a(65290),W=a(7930),H=a(40357),Y=a(76743),G=a(84399),B=a(69764),J=a(64895),K=a.n(J),X=a(15246);async function convertToWebP(e,t,a,s=.8){let r=await K()(e,{maxWidthOrHeight:Math.max(t,a),useWebWorker:!0,fileType:"image/webp",initialQuality:s}),l=await new Promise((e,t)=>{let a=new Image;a.onload=()=>{URL.revokeObjectURL(a.src),e(a)},a.onerror=t,a.src=URL.createObjectURL(r)}),i=document.createElement("canvas"),n=i.getContext("2d"),{width:d,height:o}=function(e,t,a,s){let r=Math.min(a/e,s/t);return r>=1?{width:e,height:t}:{width:Math.round(e*r),height:Math.round(t*r)}}(l.width,l.height,t,a);i.width=d,i.height=o,n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.drawImage(l,0,0,d,o);let c=await new Promise(e=>{i.toBlob(t=>e(t),"image/webp",s)});return new File([c],"image.webp",{type:"image/webp"})}async function processProductImage(e,t){let a=t.timestamp||Date.now(),s=(0,X.l)(t.productName),[r,l]=await Promise.all([convertToWebP(e,400,400,.8),convertToWebP(e,1200,1200,.8)]),i=new File([r],`${a}-thumb.webp`,{type:"image/webp"}),n=new File([l],`${a}-full.webp`,{type:"image/webp"});return{thumbnail:i,full:n,basePath:s}}var ee=a(52065);function ProductFormModal({storeId:e,storeSlug:t,product:r,onClose:l,onSaved:i}){let[o,c]=(0,d.useState)(""),[x,h]=(0,d.useState)(""),[v,w]=(0,d.useState)(""),[_,S]=(0,d.useState)(""),[C,O]=(0,d.useState)(""),[J,K]=(0,d.useState)(""),[X,et]=(0,d.useState)(!1),[ea,es]=(0,d.useState)([]),[er,el]=(0,d.useState)([]),[ei,en]=(0,d.useState)(!1),[ed,eo]=(0,d.useState)(!0),[ec,eu]=(0,d.useState)(!1),[em,ep]=(0,d.useState)([]),[ex,eh]=(0,d.useState)(null),{toast:eg}=(0,p.pm)(),{t:ev,language:eb}=(0,f.Z)(),ef=(0,d.useRef)(null);(0,d.useEffect)(()=>{if(r){c(r.name),h(r.description||""),w(r.current_price.toString()),S(r.original_price?.toString()||""),O(r.category||""),K((r.quantity??0).toString()),et(r.unlimited_stock||!1);let e=[];r.images&&r.images.length>0?e=r.images.sort((e,t)=>e.display_order-t.display_order).map(e=>({id:e.id,url:e.image_url,thumbnailUrl:e.thumbnail_url||e.image_url,altText:e.alt_text||"",status:"completed",progress:100})):r.image_url&&(e=[{id:"legacy-main",url:r.image_url,thumbnailUrl:r.thumbnail_url||r.image_url,altText:"",status:"completed",progress:100}]),ep(e);let t=Array.isArray(r.options)?r.options:[];es(t.map(e=>{let t=Array.isArray(e.values)?e.values.map(e=>String(e)):[];return{name:String(e.name||""),values:t,rawValuesInput:t.join(", ")}})),r.variants&&r.variants.length>0?el(r.variants.map(e=>{let t={};return e.option_values&&Object.entries(e.option_values).forEach(([e,a])=>{t[String(e)]=String(a)}),{id:e.id,option_values:t,price:(e.price??0).toString(),quantity:(e.quantity??0).toString(),sku:e.sku||"",imageIndex:e.image_index??null}})):loadVariants(r.id)}},[r]);let loadVariants=async e=>{let{data:t}=await j.O.from("product_variants").select("*").eq("product_id",e);t&&el(t.map(e=>{let t={};return e.option_values&&Object.entries(e.option_values).forEach(([e,a])=>{t[String(e)]=String(a)}),{id:e.id,option_values:t,price:(e.price??0).toString(),quantity:(e.quantity??0).toString(),sku:e.sku||"",imageIndex:e.image_index??null}}))},handleNativeCamera=async()=>{try{if(em.length>=5){eg({title:"Limit Reached",description:"Maximum 5 images allowed.",variant:"destructive"});return}let{Camera:e,CameraResultType:t,CameraSource:s}=await a.e(952).then(a.t.bind(a,98952,19)),r=await e.getPhoto({quality:90,allowEditing:!1,resultType:t.DataUrl,source:s.Prompt});if(r.dataUrl){let e=await fetch(r.dataUrl),t=await e.blob(),a=new File([t],"camera_photo.jpg",{type:t.type});handleAddFiles([a])}}catch(e){"User cancelled photos app"!==e.message&&eg({title:"Error",description:"Could not access camera",variant:"destructive"})}},handleAddFiles=async e=>{let t=5-em.length;if(t<=0){eg({title:"Limit Reached",description:"Maximum 5 images allowed.",variant:"destructive"});return}let a=e.slice(0,t),s=a.map(e=>({id:Math.random().toString(36).substr(2,9),url:URL.createObjectURL(e),thumbnailUrl:URL.createObjectURL(e),altText:"",file:e,status:"pending",progress:0}));ep(e=>[...e,...s]),s.forEach(e=>uploadImageItem(e))},uploadImageItem=async e=>{if(e.file){ep(t=>t.map(t=>t.id===e.id?{...t,status:"uploading"}:t));try{let{thumbnail:a,full:s,basePath:r}=await processProductImage(e.file,{productName:o||"product"});if(!t)throw Error("Store information missing");let l=new FormData;l.append("thumbnail",a),l.append("full",s),l.append("storeSlug",t),l.append("productPath",r);let i=await y.h.fetch("/api/upload",{method:"POST",body:l});ep(t=>t.map(t=>t.id===e.id?{...t,url:i.fullUrl,thumbnailUrl:i.thumbnailUrl,status:"completed",progress:100}:t))}catch(t){console.error("Upload error",t),ep(t=>t.map(t=>t.id===e.id?{...t,status:"error"}:t)),eg({title:"Upload Failed",description:"Failed to upload image.",variant:"destructive"})}}},retryUpload=e=>{let t=em.find(t=>t.id===e);t&&"error"===t.status&&uploadImageItem(t)},removeImage=e=>{ep(t=>t.filter(t=>t.id!==e))},updateAltText=(e,t)=>{ep(a=>a.map(a=>a.id===e?{...a,altText:t}:a))},handleDragStart=e=>{eh(e)},handleDragOver=(e,t)=>{if(e.preventDefault(),null===ex||ex===t)return;let a=[...em],s=a[ex];a.splice(ex,1),a.splice(t,0,s),ep(a),eh(t)},handleDragEnd=()=>{eh(null)},removeOption=e=>{es(ea.filter((t,a)=>a!==e)),el([])},updateOptionName=(e,t)=>{let a=[...ea];a[e].name=t,es(a)},updateOptionValues=(e,t)=>{let a=[...ea];a[e].rawValuesInput=t,a[e].values=t.split(/[,،]/).map(e=>e.trim()).filter(e=>e.length>0),es(a)},applyQuantityToAll=e=>{el(er.map(t=>({...t,quantity:e})))},updateVariant=(e,t,a)=>{let s=[...er];s[e][t]=a,el(s)},removeVariant=e=>{el(er.filter((t,a)=>a!==e))},getVariantLabel=e=>Object.values(e.option_values||{}).map(e=>String(e)).join(" / "),updateVariantImageIndex=(e,t)=>{let a=[...er];a[e].imageIndex=t,el(a)},executeSave=async()=>{en(!0);try{let t;let a=ea.filter(e=>e.name&&e.values.length>0),s={store_id:e,name:o,description:x||null,current_price:parseFloat(v),original_price:_?parseFloat(_):null,category:C||null,quantity:parseInt(J)||0,unlimited_stock:X,images:em.map(e=>({url:e.url,thumbnailUrl:e.thumbnailUrl,altText:e.altText})),options:a,variants:er.map(e=>({option_values:e.option_values,price:parseFloat(e.price)||0,quantity:parseInt(e.quantity)||0,sku:e.sku||null,image_index:e.imageIndex??null}))};if((t=r?await y.h.put(`/api/dashboard/products/${r.id}`,s):await y.h.post("/api/dashboard/products",s)).error)throw Error(t.error);eg({title:r?ev("products.edit_product"):ev("products.add_new"),description:r?ev("dashboard.product_updated_desc"):ev("dashboard.product_added_desc")}),eu(!1),i()}catch(e){eg({title:"Error",description:e.message,variant:"destructive"})}finally{en(!1)}},handleSubmit=async e=>{if(e.preventDefault(),ee.Capacitor.isNativePlatform()){let{Haptics:e,ImpactStyle:t}=await a.e(124).then(a.t.bind(a,68124,19));await e.impact({style:t.Light})}if(0===em.length){eg({title:"Image Required",description:"Please add at least one image",variant:"destructive"});return}if(em.some(e=>"uploading"===e.status||"pending"===e.status)){eg({title:"Upload in Progress",description:"Please wait for images to finish uploading",variant:"destructive"});return}if(em.some(e=>"error"===e.status)){eg({title:"Upload Failed",description:"Please remove or retry failed images",variant:"destructive"});return}let t=er.length>0,s=!X&&t&&er.every(e=>0===(parseInt(e.quantity)||0));if(s){eu(!0);return}await executeSave()},ej=er.length>0,ey=!X&&ej&&er.every(e=>0===(parseInt(e.quantity)||0));return(0,s.jsxs)(N.Vq,{open:!0,onOpenChange:l,children:[(0,s.jsxs)(N.cZ,{className:"max-w-2xl max-h-[90vh] overflow-y-auto rounded-3xl",children:[s.jsx(N.fK,{children:s.jsx(N.$N,{className:"text-2xl font-bold",children:r?ev("products.edit_product"):ev("products.add_new")})}),(0,s.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(Z._,{children:[ev("products.images_label")," (",em.length,"/5)"]}),em.length<5&&(0,s.jsxs)(u.z,{type:"button",variant:"outline",size:"sm",onClick:()=>ee.Capacitor.isNativePlatform()?handleNativeCamera():ef.current?.click(),children:[s.jsx(n.Z,{className:"w-4 h-4 mr-1"})," ",ev("products.add_image")]})]}),s.jsx("input",{ref:ef,type:"file",accept:"image/*",multiple:!0,onChange:e=>{e.target.files&&e.target.files.length>0&&handleAddFiles(Array.from(e.target.files))},className:"hidden"}),(0,s.jsxs)("div",{className:"grid gap-3",children:[0===em.length&&(0,s.jsxs)("div",{className:"border-2 border-dashed rounded-2xl p-8 hover:bg-gray-50 transition flex flex-col items-center justify-center text-gray-400 cursor-pointer",onClick:()=>ee.Capacitor.isNativePlatform()?handleNativeCamera():ef.current?.click(),children:[s.jsx(V.Z,{className:"w-8 h-8 mb-2"}),s.jsx("p",{children:ev("products.add_first_image")})]}),em.map((e,t)=>(0,s.jsxs)("div",{draggable:!0,onDragStart:()=>handleDragStart(t),onDragOver:e=>handleDragOver(e,t),onDragEnd:handleDragEnd,className:`
                            relative flex items-center gap-3 p-2 bg-white rounded-xl border border-gray-100 shadow-sm group
                            ${ex===t?"opacity-50 border-blue-400":""}
                        `,children:[s.jsx("div",{className:"cursor-grab text-gray-400 hover:text-gray-600",children:s.jsx($.Z,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden bg-gray-100 shrink-0",children:[s.jsx(b(),{src:e.thumbnailUrl||e.url,alt:"Thumbnail",fill:!0,className:`object-cover ${"uploading"===e.status?"opacity-50":""}`}),"uploading"===e.status&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20",children:s.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"})}),"error"===e.status&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-500/10",children:s.jsx(M.Z,{className:"w-6 h-6 text-red-500"})})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[s.jsx(m.I,{placeholder:ev("products.alt_text_placeholder")||"Alt text (SEO)",value:e.altText,onChange:t=>updateAltText(e.id,t.target.value),className:"h-8 text-sm"}),"error"===e.status&&s.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Upload failed"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:["error"===e.status&&s.jsx(u.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>retryUpload(e.id),className:"h-8 w-8 p-0 text-blue-500",children:s.jsx(T.Z,{className:"w-4 h-4"})}),s.jsx(u.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>removeImage(e.id),className:"h-8 w-8 p-0 text-red-500 hover:bg-red-50",children:s.jsx(g.Z,{className:"w-4 h-4"})})]})]},e.id))]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2 col-span-2",children:[(0,s.jsxs)(Z._,{children:[ev("products.name_label")," *"]}),s.jsx(m.I,{value:o,onChange:e=>c(e.target.value),placeholder:ev("products.name_placeholder"),className:"rounded-2xl"})]}),(0,s.jsxs)("div",{className:"space-y-2 col-span-2",children:[s.jsx(Z._,{children:ev("products.description_label")}),s.jsx(U.g,{value:x,onChange:e=>h(e.target.value),placeholder:ev("products.description_placeholder"),rows:3,className:"rounded-2xl resize-none"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(Z._,{children:ej?ev("products.price_label"):ev("products.price_label")+" *"}),s.jsx(m.I,{type:"number",step:"1",value:v,onChange:e=>w(e.target.value),placeholder:"29.99",required:!0,className:"rounded-2xl"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(Z._,{children:ev("products.original_price_label")}),s.jsx(m.I,{type:"number",step:"1",value:_,onChange:e=>S(e.target.value),placeholder:"39.99",className:"rounded-2xl"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(Z._,{children:ev("products.category_label")}),s.jsx(m.I,{value:C,onChange:e=>O(e.target.value),placeholder:ev("products.category_placeholder"),className:"rounded-2xl"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(Z._,{children:ev("products.stock_label")}),!X&&s.jsx(m.I,{type:"number",value:J,onChange:e=>K(e.target.value),placeholder:"10",required:!ej&&!X,className:"rounded-2xl"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 pt-2",children:[s.jsx(B.r,{id:"unlimited-stock",checked:X,onCheckedChange:et}),s.jsx(Z._,{htmlFor:"unlimited-stock",className:"cursor-pointer",children:ev("products.unlimited_stock")})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4 pt-4 border-t",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[s.jsx(Z._,{className:"text-base",children:ev("products.options_label")}),(0,s.jsxs)(u.z,{type:"button",onClick:()=>{if(ea.length>=3){eg({title:"Maximum options reached",description:"You can only add up to 3 options",variant:"destructive"});return}es([...ea,{name:"",values:[],rawValuesInput:""}])},disabled:ea.length>=3,variant:"outline",className:"rounded-2xl",children:[s.jsx(n.Z,{className:"w-4 h-4 mr-2"}),ev("products.add_option")]})]}),ea.map((e,t)=>(0,s.jsxs)("div",{className:"space-y-3 p-4 bg-gray-50 rounded-2xl relative",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:[ev("products.option_name")," ",t+1]}),ea.length>1&&s.jsx(u.z,{onClick:()=>removeOption(t),variant:"ghost",size:"sm",className:"rounded-full h-8 w-8 p-0",children:s.jsx(g.Z,{className:"w-4 h-4 text-red-500"})})]}),s.jsx(m.I,{value:e.name,onChange:e=>updateOptionName(t,e.target.value),placeholder:ev("products.option_name_placeholder"),className:"rounded-2xl bg-white"}),s.jsx(m.I,{value:e.rawValuesInput,onChange:e=>updateOptionValues(t,e.target.value),placeholder:ev("products.option_values_placeholder"),className:"rounded-2xl bg-white"}),(0,s.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-blue-50 text-blue-700 rounded-xl text-xs",children:[s.jsx(L.Z,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:ev("products.option_values_hint")})]})]},t)),ea.length>0&&ea.some(e=>e.name&&e.values.length>0)&&(0,s.jsxs)(u.z,{type:"button",onClick:()=>{try{let e=ea.filter(e=>e.name&&e.values.length>0);if(0===e.length){eg({title:"No options",description:"Please add options first",variant:"destructive"});return}let t=e.map(e=>e.values.map(e=>String(e).trim())),a=((...e)=>e.reduce((e,t)=>e.flatMap(e=>t.map(t=>[...e,t])),[[]]))(...t),s=a.map(t=>{let a={};e.forEach((e,s)=>{a[String(e.name)]=String(t[s]||"")});let s=er.find(e=>JSON.stringify(e.option_values)===JSON.stringify(a));return s?{...s,id:s.id||void 0,price:String(s.price),quantity:String(s.quantity),sku:String(s.sku),imageIndex:s.imageIndex}:{option_values:a,price:v||"0",quantity:"0",sku:"",imageIndex:null}});el(s),eg({title:"Variants generated!",description:`${s.length} variants created`})}catch(e){eg({title:"Error",description:"Failed to generate variants",variant:"destructive"})}},className:"w-full rounded-2xl bg-[#008069] hover:bg-[#017561]",children:[s.jsx(Q.Z,{className:"w-4 h-4 mr-2"}),ev("products.manage_variants")]})]}),er.length>0&&s.jsx(R,{open:ed,onOpenChange:eo,children:(0,s.jsxs)("div",{className:"border rounded-2xl overflow-hidden",children:[(0,s.jsxs)(A,{className:"w-full p-4 flex items-center justify-between bg-[#008069] text-white hover:bg-[#017561] transition",children:[s.jsx("div",{className:"flex items-center gap-2",children:(0,s.jsxs)("span",{className:"font-medium",children:[ev("products.variants_label")," (",er.length,")"]})}),s.jsx(W.Z,{className:`w-5 h-5 transition-transform ${ed?"rotate-180":""}`})]}),(0,s.jsxs)(E,{children:[(0,s.jsxs)("div",{className:"p-3 bg-gray-100 border-b flex gap-2 flex-wrap",children:[(0,s.jsxs)(u.z,{type:"button",onClick:()=>{el(er.map(e=>({...e,price:v})))},variant:"outline",size:"sm",className:"rounded-xl",children:[s.jsx(H.Z,{className:"w-3 h-3 mr-1"}),ev("common.currency")," ",v||"0"]}),s.jsx(u.z,{type:"button",onClick:()=>applyQuantityToAll("10"),variant:"outline",size:"sm",className:"rounded-xl",children:"Set Qty 10 for all"})]}),X&&s.jsx("div",{className:"p-3 bg-blue-50 border-b text-sm text-blue-700",children:'Product is set to "Always in stock". All variants will also be unlimited.'}),ey&&(0,s.jsxs)("div",{className:"p-3 bg-amber-50 border-b text-sm text-amber-700 flex items-center gap-2",children:[s.jsx(M.Z,{className:"w-4 h-4 shrink-0"}),s.jsx("span",{className:"font-bold",children:"ar"===eb?"تنبيه: يجب إضافة كمية للأنواع المتاحة":"Warning: You must add quantity for available variants"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 border-b text-xs font-semibold text-gray-500 uppercase tracking-wider",children:[s.jsx("div",{className:"flex-1",children:ev("products.variants_label")}),s.jsx("div",{className:"w-16 text-center",children:ev("products.variant_image")||"صورة"}),s.jsx("div",{className:"w-24",children:ev("products.price_label")}),s.jsx("div",{className:"w-16 text-center",children:ev("products.stock_label")}),s.jsx("div",{className:"w-8"})]}),s.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:er.map((e,t)=>s.jsx("div",{className:"p-3 border-b last:border-b-0 hover:bg-gray-50 transition",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0 flex items-center justify-between sm:justify-start gap-2",children:[s.jsx("div",{className:"inline-block bg-[#dcf8c6] px-3 py-1.5 rounded-2xl rounded-bl-sm text-sm font-medium",children:getVariantLabel(e)}),s.jsx(u.z,{type:"button",onClick:()=>removeVariant(t),variant:"ghost",size:"sm",className:"sm:hidden h-8 w-8 p-0 rounded-full text-red-500",children:s.jsx(g.Z,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2 w-full sm:w-auto mt-2 sm:mt-0",children:[(0,s.jsxs)(F.Ph,{value:null!==e.imageIndex&&void 0!==e.imageIndex?e.imageIndex.toString():"default",onValueChange:e=>updateVariantImageIndex(t,"default"===e?null:parseInt(e)),children:[s.jsx(F.i4,{className:"w-16 h-10 sm:h-8 text-xs rounded-xl shrink-0",children:s.jsx(F.ki,{children:null!==e.imageIndex&&void 0!==e.imageIndex&&em[e.imageIndex]?.status==="completed"?s.jsx("img",{src:em[e.imageIndex]?.thumbnailUrl,alt:"",className:"w-5 h-5 rounded object-cover"}):s.jsx(Y.Z,{className:"w-4 h-4 text-gray-400"})})}),(0,s.jsxs)(F.Bw,{children:[s.jsx(F.Ql,{value:"default",children:s.jsx("span",{className:"text-gray-500",children:ev("products.default_image")||"افتراضي"})}),em.filter(e=>"completed"===e.status).map((e,t)=>s.jsx(F.Ql,{value:t.toString(),children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("img",{src:e.thumbnailUrl,alt:"",className:"w-6 h-6 rounded object-cover"}),s.jsx("span",{children:t+1})]})},t))]})]}),s.jsx(m.I,{type:"number",step:"1",value:String(e.price??""),onChange:e=>updateVariant(t,"price",e.target.value),placeholder:"Price",className:"flex-1 min-w-[3rem] h-10 sm:h-8 text-sm rounded-xl"}),X?s.jsx("div",{className:"w-20 sm:w-16 h-10 sm:h-8 flex items-center justify-center text-gray-400 bg-gray-50 rounded-xl shrink-0",children:s.jsx(G.Z,{className:"w-5 h-5"})}):s.jsx(m.I,{type:"number",value:String(e.quantity??""),onChange:e=>updateVariant(t,"quantity",e.target.value),placeholder:"Qty",className:"w-20 sm:w-16 h-10 sm:h-8 text-sm rounded-xl shrink-0"}),s.jsx(u.z,{type:"button",onClick:()=>removeVariant(t),variant:"ghost",size:"sm",className:"hidden sm:flex h-8 w-8 p-0 rounded-full shrink-0",children:s.jsx(g.Z,{className:"w-4 h-4 text-red-500"})})]})]})},t))})]})]})}),(0,s.jsxs)("div",{className:"flex gap-3 pt-4",children:[s.jsx(u.z,{type:"button",onClick:l,variant:"outline",className:"flex-1 rounded-3xl h-12",children:ev("common.back")}),s.jsx(u.z,{type:"submit",disabled:ei,className:"flex-1 rounded-3xl h-12 bg-[#008069] hover:bg-[#017561]",children:ei?ev("common.saving"):r?ev("products.edit_product"):ev("products.add_new")})]})]})]}),s.jsx(k,{open:ec,onOpenChange:eu,children:(0,s.jsxs)(I,{className:"rounded-2xl",children:[(0,s.jsxs)(AlertDialogHeader,{children:[(0,s.jsxs)(P,{className:"flex items-center gap-2 text-amber-600",children:[s.jsx(M.Z,{className:"w-5 h-5"}),"ar"===eb?"تنبيه: الكميات صفر":"Warning: Zero Quantities"]}),s.jsx(q,{children:"ar"===eb?"لم يتم تحديد كمية لأي من الأنواع. سيتم حفظ المنتج ولكن لن يظهر للعملاء حتى تتوفر كمية.":"No quantities specified for variants. The product will be saved but will not be visible to customers until stock is added."})]}),(0,s.jsxs)(AlertDialogFooter,{className:"gap-2 sm:gap-0",children:[s.jsx(D,{asChild:!0,children:s.jsx(u.z,{variant:"outline",className:"rounded-xl",onClick:()=>eu(!1),children:"ar"===eb?"تعديل":"Edit"})}),s.jsx(z,{asChild:!0,children:s.jsx(u.z,{onClick:e=>{e.preventDefault(),executeSave()},className:"rounded-xl bg-[#008069] hover:bg-[#017561]",children:"ar"===eb?"حفظ كمسودة":"Save as Draft"})})]})]})})]})}var et=a(57700),ea=a(69615);function DashboardPage(){let{store:e,loading:t}=(0,ea.o)(),[a,x]=(0,d.useState)([]),[h,g]=(0,d.useState)(!0),[v,b]=(0,d.useState)(!1),[j,N]=(0,d.useState)(null),[w,_]=(0,d.useState)(""),[k,S]=(0,d.useState)(!1),{user:C,loading:I}=(0,o.useAuth)();(0,c.useRouter)();let{toast:P}=(0,p.pm)(),{t:q,direction:z,language:D}=(0,f.Z)(),{subscription:U}=(0,et.m)(),Z=U?.isReadOnly??!1,O=(0,d.useCallback)(async()=>{try{let e=await y.h.get("/api/dashboard/products");if(e.error){console.error("Error loading products:",e.error);return}x(e.products||[])}catch(e){console.error("Error loading products:",e)}finally{g(!1)}},[]);(0,d.useEffect)(()=>{(I||C)&&(t||(e?O():g(!1)))},[C,e,t,I,O]);let handleEditProduct=e=>{if(Z){P({title:"ar"===D?"وضع القراءة فقط":"Read-Only Mode",description:"ar"===D?"جدد اشتراكك لتعديل المنتجات":"Renew your subscription to edit products",variant:"destructive"});return}N(e),b(!0)},handleDeleteProduct=async e=>{if(Z){P({title:"ar"===D?"وضع القراءة فقط":"Read-Only Mode",description:"ar"===D?"جدد اشتراكك لحذف المنتجات":"Renew your subscription to delete products",variant:"destructive"});return}if(confirm(q("products.delete_confirm")))try{await y.h.delete(`/api/dashboard/products/${e}`),P({title:q("dashboard.delete_product_title"),description:q("dashboard.delete_product_desc")}),O()}catch(e){P({title:q("common.error"),description:e.message,variant:"destructive"})}};return h?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#f0f2f5]",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#008069]"})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsx("div",{className:"mb-6",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:q("dashboard.products")}),s.jsx("p",{className:"text-gray-600",children:q("dashboard.products_count",{count:a.length})})]}),(0,s.jsxs)("div",{className:"flex flex-1 gap-2 w-full sm:w-auto",children:[(0,s.jsxs)("div",{className:"relative flex-1 sm:w-72",children:[s.jsx(r.Z,{className:`absolute ${"rtl"===z?"right-3":"left-3"} top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4`}),s.jsx(m.I,{type:"text",placeholder:q("dashboard.search_products"),value:w,onChange:e=>_(e.target.value),className:`${"rtl"===z?"pr-10":"pl-10"} h-10 rounded-2xl border-gray-200`})]}),(0,s.jsxs)(u.z,{variant:k?"default":"outline",onClick:()=>S(!k),className:`h-10 rounded-2xl gap-2 px-3 sm:px-4 ${k?"bg-[#008069] hover:bg-[#017561]":""}`,children:[s.jsx(l.Z,{className:"w-4 h-4"}),s.jsx("span",{className:"whitespace-nowrap",children:q("dashboard.filter_out_of_stock")})]})]})]})}),0===a.length?(0,s.jsxs)("div",{className:"text-center py-16",children:[s.jsx(i.Z,{className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:q("dashboard.no_products")}),s.jsx("p",{className:"text-gray-600 mb-6",children:q("dashboard.start_selling")}),(0,s.jsxs)(u.z,{onClick:()=>{if(Z){P({title:"ar"===D?"وضع القراءة فقط":"Read-Only Mode",description:"ar"===D?"جدد اشتراكك لإضافة منتجات":"Renew your subscription to add products",variant:"destructive"});return}b(!0)},className:`rounded-3xl h-12 px-8 ${Z?"bg-gray-400 cursor-not-allowed":"bg-[#008069] hover:bg-[#017561]"}`,children:[s.jsx(n.Z,{className:`w-5 h-5 ${"rtl"===z?"ml-2":"mr-2"}`}),q("dashboard.add_first_product")]})]}):s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:a.filter(e=>{let t=!0;if(w.trim()){let a=w.toLowerCase();t=e.name.toLowerCase().includes(a)||(e.description?.toLowerCase().includes(a)??!1)||(e.category?.toLowerCase().includes(a)??!1)}let a=!0;if(k){let t=e.variants&&e.variants.length>0,s=t?e.variants.reduce((e,t)=>e+t.quantity,0):e.quantity,r=e.unlimited_stock;(r||s>0)&&(a=!1)}return t&&a}).map(e=>s.jsx(ProductCard,{product:e,onEdit:handleEditProduct,onDelete:handleDeleteProduct},e.id))})]}),v&&e&&s.jsx(ProductFormModal,{storeId:e.id,storeSlug:e.slug,product:j,onClose:()=>{b(!1),N(null)},onSaved:()=>{b(!1),N(null),O()}}),a.length>0&&!v&&s.jsx("button",{onClick:()=>{if(Z){P({title:"ar"===D?"وضع القراءة فقط":"Read-Only Mode",description:"ar"===D?"جدد اشتراكك لإضافة منتجات":"Renew your subscription to add products",variant:"destructive"});return}b(!0)},className:`fixed bottom-28 ${"rtl"===z?"left-8":"right-8"} z-[60] ${Z?"bg-gray-400":"bg-[#008069] hover:bg-[#017561] hover:scale-110"} text-white rounded-full p-5 shadow-2xl transition-all`,"aria-label":q("dashboard.add_product"),children:s.jsx(n.Z,{className:"w-8 h-8"})})]})}},41179:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>i,__esModule:()=>l,default:()=>d});var s=a(64074);let r=(0,s.createProxy)(String.raw`D:\whatsou\apps\mobile\app\dashboard\page.tsx`),{__esModule:l,$$typeof:i}=r,n=r.default,d=n}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[64,583,235,308,767,517,247,890,445,967,141,364,436,669,230,764],()=>__webpack_exec__(27786));module.exports=a})();