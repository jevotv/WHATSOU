(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{1311:function(e,t,a){Promise.resolve().then(a.bind(a,8850))},8850:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return DashboardPage}});var s=a(7573),r=a(9576),l=a(3682),i=a(3226),n=a(7917),d=a(7653),o=a(6803),c=a(2859),u=a(7321),m=a(4896),p=a(2272),h=a(6271),x=a(248),g=a(8073),f=a(6072),v=a.n(f),b=a(6923);function ProductCard(e){let{product:t,onEdit:a,onDelete:r}=e,{t:l,direction:n}=(0,b.Z)(),d=t.original_price&&t.original_price>t.current_price,o=d?Math.round((t.original_price-t.current_price)/t.original_price*100):0,c=t.variants&&t.variants.length>0,m=c?t.variants.reduce((e,t)=>e+t.quantity,0):t.quantity,p=t.unlimited_stock;return(0,s.jsxs)(h.Zb,{className:"rounded-3xl overflow-hidden hover:shadow-xl transition-shadow group",dir:n,children:[(0,s.jsxs)("div",{className:"relative aspect-square bg-gray-100",children:[t.thumbnail_url||t.image_url?(0,s.jsx)(v(),{src:t.thumbnail_url||t.image_url,alt:t.name,fill:!0,className:"object-cover"}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200",children:(0,s.jsx)(i.Z,{className:"w-16 h-16 text-gray-400"})}),d&&(0,s.jsxs)("div",{className:"absolute top-3 ".concat("rtl"===n?"right-3":"left-3"," bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold z-10"),children:["-",o,"%"]}),(0,s.jsxs)("div",{className:"absolute top-3 ".concat("rtl"===n?"left-3":"right-3"," opacity-0 group-hover:opacity-100 transition-opacity flex gap-2 z-10"),children:[(0,s.jsx)(u.z,{size:"icon",onClick:()=>a(t),className:"rounded-full bg-white text-gray-900 hover:bg-gray-100 shadow-lg",children:(0,s.jsx)(x.Z,{className:"w-4 h-4"})}),(0,s.jsx)(u.z,{size:"icon",onClick:()=>r(t.id),variant:"destructive",className:"rounded-full shadow-lg",children:(0,s.jsx)(g.Z,{className:"w-4 h-4"})})]})]}),(0,s.jsxs)(h.aY,{className:"p-4 space-y-2",children:[(0,s.jsx)("h3",{className:"font-bold text-lg line-clamp-1",children:t.name}),t.description&&(0,s.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2",children:t.description}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("span",{className:"text-xl font-bold text-green-600",children:[l("common.currency")," ",t.current_price.toFixed(2)]}),d&&(0,s.jsxs)("span",{className:"text-sm text-gray-400 line-through",children:[l("common.currency")," ",t.original_price.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[(0,s.jsxs)("span",{children:[l("products.stock_label"),": ",p?"∞":m,c&&(0,s.jsxs)("span",{className:"text-xs mx-1",children:["(",t.variants.length," ",l("products.variants_label"),")"]})]}),t.category&&(0,s.jsx)("span",{className:"bg-gray-100 px-2 py-1 rounded-full text-xs",children:t.category})]}),t.options&&t.options.length>0&&(0,s.jsx)("div",{className:"pt-2 border-t",children:(0,s.jsx)("p",{className:"text-xs text-gray-500",children:l("products.options_available",{count:t.options.length})})})]})]})}var j=a(4996),y=a(8681),N=a(885),w=a(5277),_=a(3883);let k=w.fC;w.xz;let S=w.h_,C=d.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(w.aV,{className:(0,_.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r,ref:t})});C.displayName=w.aV.displayName;let I=d.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsxs)(S,{children:[(0,s.jsx)(C,{}),(0,s.jsx)(w.VY,{ref:t,className:(0,_.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...r})]})});I.displayName=w.VY.displayName;let AlertDialogHeader=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,_.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};AlertDialogHeader.displayName="AlertDialogHeader";let AlertDialogFooter=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,_.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};AlertDialogFooter.displayName="AlertDialogFooter";let z=d.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(w.Dx,{ref:t,className:(0,_.cn)("text-lg font-semibold",a),...r})});z.displayName=w.Dx.displayName;let P=d.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(w.dk,{ref:t,className:(0,_.cn)("text-sm text-muted-foreground",a),...r})});P.displayName=w.dk.displayName;let D=d.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(w.aU,{ref:t,className:(0,_.cn)((0,u.d)(),a),...r})});D.displayName=w.aU.displayName;let R=d.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(w.$j,{ref:t,className:(0,_.cn)((0,u.d)({variant:"outline"}),"mt-2 sm:mt-0",a),...r})});R.displayName=w.$j.displayName;var Z=a(5654),O=a(9861),V=a(9090);let q=V.fC,U=V.wy,E=V.Fw;var F=a(372),A=a(638),T=a(8769),L=a(6615),M=a(1452),H=a(1644),Q=a(9540),W=a(7216),Y=a(8053),$=a(6954),B=a(5457),J=a(6370),K=a(3960),G=a(5948);async function convertToWebP(e,t,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.8,r=await (0,K.Z)(e,{maxWidthOrHeight:Math.max(t,a),useWebWorker:!0,fileType:"image/webp",initialQuality:s}),l=await new Promise((e,t)=>{let a=new Image;a.onload=()=>{URL.revokeObjectURL(a.src),e(a)},a.onerror=t,a.src=URL.createObjectURL(r)}),i=document.createElement("canvas"),n=i.getContext("2d"),{width:d,height:o}=function(e,t,a,s){let r=Math.min(a/e,s/t);return r>=1?{width:e,height:t}:{width:Math.round(e*r),height:Math.round(t*r)}}(l.width,l.height,t,a);i.width=d,i.height=o,n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.drawImage(l,0,0,d,o);let c=await new Promise(e=>{i.toBlob(t=>e(t),"image/webp",s)});return new File([c],"image.webp",{type:"image/webp"})}async function processProductImage(e,t){let a=t.timestamp||Date.now(),s=(0,G.l)(t.productName),[r,l]=await Promise.all([convertToWebP(e,400,400,.8),convertToWebP(e,1200,1200,.8)]),i=new File([r],"".concat(a,"-thumb.webp"),{type:"image/webp"}),n=new File([l],"".concat(a,"-full.webp"),{type:"image/webp"});return{thumbnail:i,full:n,basePath:s}}var X=a(2979);function ProductFormModal(e){let{storeId:t,storeSlug:r,product:l,onClose:i,onSaved:o}=e,[c,h]=(0,d.useState)(""),[x,f]=(0,d.useState)(""),[w,_]=(0,d.useState)(""),[S,C]=(0,d.useState)(""),[V,K]=(0,d.useState)(""),[G,ee]=(0,d.useState)(""),[et,ea]=(0,d.useState)(!1),[es,er]=(0,d.useState)([]),[el,ei]=(0,d.useState)([]),[en,ed]=(0,d.useState)(!1),[eo,ec]=(0,d.useState)(!0),[eu,em]=(0,d.useState)(!1),[ep,eh]=(0,d.useState)([]),[ex,eg]=(0,d.useState)(null),{toast:ef}=(0,p.pm)(),{t:ev,language:eb}=(0,b.Z)(),ej=(0,d.useRef)(null);(0,d.useEffect)(()=>{if(l){var e,t;h(l.name),f(l.description||""),_(l.current_price.toString()),C((null===(e=l.original_price)||void 0===e?void 0:e.toString())||""),K(l.category||""),ee((null!==(t=l.quantity)&&void 0!==t?t:0).toString()),ea(l.unlimited_stock||!1);let a=[];l.images&&l.images.length>0?a=l.images.sort((e,t)=>e.display_order-t.display_order).map(e=>({id:e.id,url:e.image_url,thumbnailUrl:e.thumbnail_url||e.image_url,altText:e.alt_text||"",status:"completed",progress:100})):l.image_url&&(a=[{id:"legacy-main",url:l.image_url,thumbnailUrl:l.thumbnail_url||l.image_url,altText:"",status:"completed",progress:100}]),eh(a);let s=Array.isArray(l.options)?l.options:[];er(s.map(e=>{let t=Array.isArray(e.values)?e.values.map(e=>String(e)):[];return{name:String(e.name||""),values:t,rawValuesInput:t.join(", ")}})),l.variants&&l.variants.length>0?ei(l.variants.map(e=>{var t,a,s;let r={};return e.option_values&&Object.entries(e.option_values).forEach(e=>{let[t,a]=e;r[String(t)]=String(a)}),{id:e.id,option_values:r,price:(null!==(t=e.price)&&void 0!==t?t:0).toString(),quantity:(null!==(a=e.quantity)&&void 0!==a?a:0).toString(),sku:e.sku||"",imageIndex:null!==(s=e.image_index)&&void 0!==s?s:null}})):loadVariants(l.id)}},[l]);let loadVariants=async e=>{let{data:t}=await j.O.from("product_variants").select("*").eq("product_id",e);t&&ei(t.map(e=>{var t,a,s;let r={};return e.option_values&&Object.entries(e.option_values).forEach(e=>{let[t,a]=e;r[String(t)]=String(a)}),{id:e.id,option_values:r,price:(null!==(t=e.price)&&void 0!==t?t:0).toString(),quantity:(null!==(a=e.quantity)&&void 0!==a?a:0).toString(),sku:e.sku||"",imageIndex:null!==(s=e.image_index)&&void 0!==s?s:null}}))},handleNativeCamera=async()=>{try{if(ep.length>=5){ef({title:"Limit Reached",description:"Maximum 5 images allowed.",variant:"destructive"});return}let{Camera:e,CameraResultType:t,CameraSource:s}=await a.e(727).then(a.bind(a,3727)),r=await e.getPhoto({quality:90,allowEditing:!1,resultType:t.DataUrl,source:s.Prompt});if(r.dataUrl){let e=await fetch(r.dataUrl),t=await e.blob(),a=new File([t],"camera_photo.jpg",{type:t.type});handleAddFiles([a])}}catch(e){"User cancelled photos app"!==e.message&&ef({title:"Error",description:"Could not access camera",variant:"destructive"})}},handleAddFiles=async e=>{let t=5-ep.length;if(t<=0){ef({title:"Limit Reached",description:"Maximum 5 images allowed.",variant:"destructive"});return}let a=e.slice(0,t),s=a.map(e=>({id:Math.random().toString(36).substr(2,9),url:URL.createObjectURL(e),thumbnailUrl:URL.createObjectURL(e),altText:"",file:e,status:"pending",progress:0}));eh(e=>[...e,...s]),s.forEach(e=>uploadImageItem(e))},uploadImageItem=async e=>{if(e.file){eh(t=>t.map(t=>t.id===e.id?{...t,status:"uploading"}:t));try{let{thumbnail:t,full:a,basePath:s}=await processProductImage(e.file,{productName:c||"product"});if(!r)throw Error("Store information missing");let l=new FormData;l.append("thumbnail",t),l.append("full",a),l.append("storeSlug",r),l.append("productPath",s);let i=await y.h.fetch("/api/upload",{method:"POST",body:l});eh(t=>t.map(t=>t.id===e.id?{...t,url:i.fullUrl,thumbnailUrl:i.thumbnailUrl,status:"completed",progress:100}:t))}catch(t){console.error("Upload error",t),eh(t=>t.map(t=>t.id===e.id?{...t,status:"error"}:t)),ef({title:"Upload Failed",description:"Failed to upload image.",variant:"destructive"})}}},retryUpload=e=>{let t=ep.find(t=>t.id===e);t&&"error"===t.status&&uploadImageItem(t)},removeImage=e=>{eh(t=>t.filter(t=>t.id!==e))},updateAltText=(e,t)=>{eh(a=>a.map(a=>a.id===e?{...a,altText:t}:a))},handleDragStart=e=>{eg(e)},handleDragOver=(e,t)=>{if(e.preventDefault(),null===ex||ex===t)return;let a=[...ep],s=a[ex];a.splice(ex,1),a.splice(t,0,s),eh(a),eg(t)},handleDragEnd=()=>{eg(null)},removeOption=e=>{er(es.filter((t,a)=>a!==e)),ei([])},updateOptionName=(e,t)=>{let a=[...es];a[e].name=t,er(a)},updateOptionValues=(e,t)=>{let a=[...es];a[e].rawValuesInput=t,a[e].values=t.split(/[,،]/).map(e=>e.trim()).filter(e=>e.length>0),er(a)},applyQuantityToAll=e=>{ei(el.map(t=>({...t,quantity:e})))},updateVariant=(e,t,a)=>{let s=[...el];s[e][t]=a,ei(s)},removeVariant=e=>{ei(el.filter((t,a)=>a!==e))},getVariantLabel=e=>Object.values(e.option_values||{}).map(e=>String(e)).join(" / "),updateVariantImageIndex=(e,t)=>{let a=[...el];a[e].imageIndex=t,ei(a)},executeSave=async()=>{ed(!0);try{let e;let a=es.filter(e=>e.name&&e.values.length>0),s={store_id:t,name:c,description:x||null,current_price:parseFloat(w),original_price:S?parseFloat(S):null,category:V||null,quantity:parseInt(G)||0,unlimited_stock:et,images:ep.map(e=>({url:e.url,thumbnailUrl:e.thumbnailUrl,altText:e.altText})),options:a,variants:el.map(e=>{var t;return{option_values:e.option_values,price:parseFloat(e.price)||0,quantity:parseInt(e.quantity)||0,sku:e.sku||null,image_index:null!==(t=e.imageIndex)&&void 0!==t?t:null}})};if((e=l?await y.h.put("/api/dashboard/products/".concat(l.id),s):await y.h.post("/api/dashboard/products",s)).error)throw Error(e.error);ef({title:l?ev("products.edit_product"):ev("products.add_new"),description:l?ev("dashboard.product_updated_desc"):ev("dashboard.product_added_desc")}),em(!1),o()}catch(e){ef({title:"Error",description:e.message,variant:"destructive"})}finally{ed(!1)}},handleSubmit=async e=>{if(e.preventDefault(),X.dV.isNativePlatform()){let{Haptics:e,ImpactStyle:t}=await a.e(824).then(a.bind(a,9824));await e.impact({style:t.Light})}if(0===ep.length){ef({title:"Image Required",description:"Please add at least one image",variant:"destructive"});return}if(ep.some(e=>"uploading"===e.status||"pending"===e.status)){ef({title:"Upload in Progress",description:"Please wait for images to finish uploading",variant:"destructive"});return}if(ep.some(e=>"error"===e.status)){ef({title:"Upload Failed",description:"Please remove or retry failed images",variant:"destructive"});return}let t=el.length>0,s=!et&&t&&el.every(e=>0===(parseInt(e.quantity)||0));if(s){em(!0);return}await executeSave()},ey=el.length>0,eN=!et&&ey&&el.every(e=>0===(parseInt(e.quantity)||0));return(0,s.jsxs)(N.Vq,{open:!0,onOpenChange:i,children:[(0,s.jsxs)(N.cZ,{className:"max-w-2xl max-h-[90vh] overflow-y-auto rounded-3xl",children:[(0,s.jsx)(N.fK,{children:(0,s.jsx)(N.$N,{className:"text-2xl font-bold",children:l?ev("products.edit_product"):ev("products.add_new")})}),(0,s.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(O._,{children:[ev("products.images_label")," (",ep.length,"/5)"]}),ep.length<5&&(0,s.jsxs)(u.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{var e;return X.dV.isNativePlatform()?handleNativeCamera():null===(e=ej.current)||void 0===e?void 0:e.click()},children:[(0,s.jsx)(n.Z,{className:"w-4 h-4 mr-1"})," ",ev("products.add_image")]})]}),(0,s.jsx)("input",{ref:ej,type:"file",accept:"image/*",multiple:!0,onChange:e=>{e.target.files&&e.target.files.length>0&&handleAddFiles(Array.from(e.target.files))},className:"hidden"}),(0,s.jsxs)("div",{className:"grid gap-3",children:[0===ep.length&&(0,s.jsxs)("div",{className:"border-2 border-dashed rounded-2xl p-8 hover:bg-gray-50 transition flex flex-col items-center justify-center text-gray-400 cursor-pointer",onClick:()=>{var e;return X.dV.isNativePlatform()?handleNativeCamera():null===(e=ej.current)||void 0===e?void 0:e.click()},children:[(0,s.jsx)(A.Z,{className:"w-8 h-8 mb-2"}),(0,s.jsx)("p",{children:ev("products.add_first_image")})]}),ep.map((e,t)=>(0,s.jsxs)("div",{draggable:!0,onDragStart:()=>handleDragStart(t),onDragOver:e=>handleDragOver(e,t),onDragEnd:handleDragEnd,className:"\n                            relative flex items-center gap-3 p-2 bg-white rounded-xl border border-gray-100 shadow-sm group\n                            ".concat(ex===t?"opacity-50 border-blue-400":"","\n                        "),children:[(0,s.jsx)("div",{className:"cursor-grab text-gray-400 hover:text-gray-600",children:(0,s.jsx)(T.Z,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden bg-gray-100 shrink-0",children:[(0,s.jsx)(v(),{src:e.thumbnailUrl||e.url,alt:"Thumbnail",fill:!0,className:"object-cover ".concat("uploading"===e.status?"opacity-50":"")}),"uploading"===e.status&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20",children:(0,s.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"})}),"error"===e.status&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-red-500/10",children:(0,s.jsx)(L.Z,{className:"w-6 h-6 text-red-500"})})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)(m.I,{placeholder:ev("products.alt_text_placeholder")||"Alt text (SEO)",value:e.altText,onChange:t=>updateAltText(e.id,t.target.value),className:"h-8 text-sm"}),"error"===e.status&&(0,s.jsx)("p",{className:"text-xs text-red-500 mt-1",children:"Upload failed"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:["error"===e.status&&(0,s.jsx)(u.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>retryUpload(e.id),className:"h-8 w-8 p-0 text-blue-500",children:(0,s.jsx)(M.Z,{className:"w-4 h-4"})}),(0,s.jsx)(u.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>removeImage(e.id),className:"h-8 w-8 p-0 text-red-500 hover:bg-red-50",children:(0,s.jsx)(g.Z,{className:"w-4 h-4"})})]})]},e.id))]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2 col-span-2",children:[(0,s.jsxs)(O._,{children:[ev("products.name_label")," *"]}),(0,s.jsx)(m.I,{value:c,onChange:e=>h(e.target.value),placeholder:ev("products.name_placeholder"),className:"rounded-2xl"})]}),(0,s.jsxs)("div",{className:"space-y-2 col-span-2",children:[(0,s.jsx)(O._,{children:ev("products.description_label")}),(0,s.jsx)(Z.g,{value:x,onChange:e=>f(e.target.value),placeholder:ev("products.description_placeholder"),rows:3,className:"rounded-2xl resize-none"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(O._,{children:ey?ev("products.price_label"):ev("products.price_label")+" *"}),(0,s.jsx)(m.I,{type:"number",step:"1",value:w,onChange:e=>_(e.target.value),placeholder:"29.99",required:!0,className:"rounded-2xl"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(O._,{children:ev("products.original_price_label")}),(0,s.jsx)(m.I,{type:"number",step:"1",value:S,onChange:e=>C(e.target.value),placeholder:"39.99",className:"rounded-2xl"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(O._,{children:ev("products.category_label")}),(0,s.jsx)(m.I,{value:V,onChange:e=>K(e.target.value),placeholder:ev("products.category_placeholder"),className:"rounded-2xl"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(O._,{children:ev("products.stock_label")}),!et&&(0,s.jsx)(m.I,{type:"number",value:G,onChange:e=>ee(e.target.value),placeholder:"10",required:!ey&&!et,className:"rounded-2xl"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 pt-2",children:[(0,s.jsx)(J.r,{id:"unlimited-stock",checked:et,onCheckedChange:ea}),(0,s.jsx)(O._,{htmlFor:"unlimited-stock",className:"cursor-pointer",children:ev("products.unlimited_stock")})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4 pt-4 border-t",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(O._,{className:"text-base",children:ev("products.options_label")}),(0,s.jsxs)(u.z,{type:"button",onClick:()=>{if(es.length>=3){ef({title:"Maximum options reached",description:"You can only add up to 3 options",variant:"destructive"});return}er([...es,{name:"",values:[],rawValuesInput:""}])},disabled:es.length>=3,variant:"outline",className:"rounded-2xl",children:[(0,s.jsx)(n.Z,{className:"w-4 h-4 mr-2"}),ev("products.add_option")]})]}),es.map((e,t)=>(0,s.jsxs)("div",{className:"space-y-3 p-4 bg-gray-50 rounded-2xl relative",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:[ev("products.option_name")," ",t+1]}),es.length>1&&(0,s.jsx)(u.z,{onClick:()=>removeOption(t),variant:"ghost",size:"sm",className:"rounded-full h-8 w-8 p-0",children:(0,s.jsx)(g.Z,{className:"w-4 h-4 text-red-500"})})]}),(0,s.jsx)(m.I,{value:e.name,onChange:e=>updateOptionName(t,e.target.value),placeholder:ev("products.option_name_placeholder"),className:"rounded-2xl bg-white"}),(0,s.jsx)(m.I,{value:e.rawValuesInput,onChange:e=>updateOptionValues(t,e.target.value),placeholder:ev("products.option_values_placeholder"),className:"rounded-2xl bg-white"}),(0,s.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-blue-50 text-blue-700 rounded-xl text-xs",children:[(0,s.jsx)(H.Z,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),(0,s.jsx)("span",{children:ev("products.option_values_hint")})]})]},t)),es.length>0&&es.some(e=>e.name&&e.values.length>0)&&(0,s.jsxs)(u.z,{type:"button",onClick:()=>{try{let e=es.filter(e=>e.name&&e.values.length>0);if(0===e.length){ef({title:"No options",description:"Please add options first",variant:"destructive"});return}let t=e.map(e=>e.values.map(e=>String(e).trim())),a=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.reduce((e,t)=>e.flatMap(e=>t.map(t=>[...e,t])),[[]])}(...t),s=a.map(t=>{let a={};e.forEach((e,s)=>{a[String(e.name)]=String(t[s]||"")});let s=el.find(e=>JSON.stringify(e.option_values)===JSON.stringify(a));return s?{...s,id:s.id||void 0,price:String(s.price),quantity:String(s.quantity),sku:String(s.sku),imageIndex:s.imageIndex}:{option_values:a,price:w||"0",quantity:"0",sku:"",imageIndex:null}});ei(s),ef({title:"Variants generated!",description:"".concat(s.length," variants created")})}catch(e){ef({title:"Error",description:"Failed to generate variants",variant:"destructive"})}},className:"w-full rounded-2xl bg-[#008069] hover:bg-[#017561]",children:[(0,s.jsx)(Q.Z,{className:"w-4 h-4 mr-2"}),ev("products.manage_variants")]})]}),el.length>0&&(0,s.jsx)(q,{open:eo,onOpenChange:ec,children:(0,s.jsxs)("div",{className:"border rounded-2xl overflow-hidden",children:[(0,s.jsxs)(U,{className:"w-full p-4 flex items-center justify-between bg-[#008069] text-white hover:bg-[#017561] transition",children:[(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)("span",{className:"font-medium",children:[ev("products.variants_label")," (",el.length,")"]})}),(0,s.jsx)(W.Z,{className:"w-5 h-5 transition-transform ".concat(eo?"rotate-180":"")})]}),(0,s.jsxs)(E,{children:[(0,s.jsxs)("div",{className:"p-3 bg-gray-100 border-b flex gap-2 flex-wrap",children:[(0,s.jsxs)(u.z,{type:"button",onClick:()=>{ei(el.map(e=>({...e,price:w})))},variant:"outline",size:"sm",className:"rounded-xl",children:[(0,s.jsx)(Y.Z,{className:"w-3 h-3 mr-1"}),ev("common.currency")," ",w||"0"]}),(0,s.jsx)(u.z,{type:"button",onClick:()=>applyQuantityToAll("10"),variant:"outline",size:"sm",className:"rounded-xl",children:"Set Qty 10 for all"})]}),et&&(0,s.jsx)("div",{className:"p-3 bg-blue-50 border-b text-sm text-blue-700",children:'Product is set to "Always in stock". All variants will also be unlimited.'}),eN&&(0,s.jsxs)("div",{className:"p-3 bg-amber-50 border-b text-sm text-amber-700 flex items-center gap-2",children:[(0,s.jsx)(L.Z,{className:"w-4 h-4 shrink-0"}),(0,s.jsx)("span",{className:"font-bold",children:"ar"===eb?"تنبيه: يجب إضافة كمية للأنواع المتاحة":"Warning: You must add quantity for available variants"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 border-b text-xs font-semibold text-gray-500 uppercase tracking-wider",children:[(0,s.jsx)("div",{className:"flex-1",children:ev("products.variants_label")}),(0,s.jsx)("div",{className:"w-16 text-center",children:ev("products.variant_image")||"صورة"}),(0,s.jsx)("div",{className:"w-24",children:ev("products.price_label")}),(0,s.jsx)("div",{className:"w-16 text-center",children:ev("products.stock_label")}),(0,s.jsx)("div",{className:"w-8"})]}),(0,s.jsx)("div",{className:"max-h-[300px] overflow-y-auto",children:el.map((e,t)=>{var a,r,l,i;return(0,s.jsx)("div",{className:"p-3 border-b last:border-b-0 hover:bg-gray-50 transition",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0 flex items-center justify-between sm:justify-start gap-2",children:[(0,s.jsx)("div",{className:"inline-block bg-[#dcf8c6] px-3 py-1.5 rounded-2xl rounded-bl-sm text-sm font-medium",children:getVariantLabel(e)}),(0,s.jsx)(u.z,{type:"button",onClick:()=>removeVariant(t),variant:"ghost",size:"sm",className:"sm:hidden h-8 w-8 p-0 rounded-full text-red-500",children:(0,s.jsx)(g.Z,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2 w-full sm:w-auto mt-2 sm:mt-0",children:[(0,s.jsxs)(F.Ph,{value:null!==e.imageIndex&&void 0!==e.imageIndex?e.imageIndex.toString():"default",onValueChange:e=>updateVariantImageIndex(t,"default"===e?null:parseInt(e)),children:[(0,s.jsx)(F.i4,{className:"w-16 h-10 sm:h-8 text-xs rounded-xl shrink-0",children:(0,s.jsx)(F.ki,{children:null!==e.imageIndex&&void 0!==e.imageIndex&&(null===(a=ep[e.imageIndex])||void 0===a?void 0:a.status)==="completed"?(0,s.jsx)("img",{src:null===(r=ep[e.imageIndex])||void 0===r?void 0:r.thumbnailUrl,alt:"",className:"w-5 h-5 rounded object-cover"}):(0,s.jsx)($.Z,{className:"w-4 h-4 text-gray-400"})})}),(0,s.jsxs)(F.Bw,{children:[(0,s.jsx)(F.Ql,{value:"default",children:(0,s.jsx)("span",{className:"text-gray-500",children:ev("products.default_image")||"افتراضي"})}),ep.filter(e=>"completed"===e.status).map((e,t)=>(0,s.jsx)(F.Ql,{value:t.toString(),children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("img",{src:e.thumbnailUrl,alt:"",className:"w-6 h-6 rounded object-cover"}),(0,s.jsx)("span",{children:t+1})]})},t))]})]}),(0,s.jsx)(m.I,{type:"number",step:"1",value:String(null!==(l=e.price)&&void 0!==l?l:""),onChange:e=>updateVariant(t,"price",e.target.value),placeholder:"Price",className:"flex-1 min-w-[3rem] h-10 sm:h-8 text-sm rounded-xl"}),et?(0,s.jsx)("div",{className:"w-20 sm:w-16 h-10 sm:h-8 flex items-center justify-center text-gray-400 bg-gray-50 rounded-xl shrink-0",children:(0,s.jsx)(B.Z,{className:"w-5 h-5"})}):(0,s.jsx)(m.I,{type:"number",value:String(null!==(i=e.quantity)&&void 0!==i?i:""),onChange:e=>updateVariant(t,"quantity",e.target.value),placeholder:"Qty",className:"w-20 sm:w-16 h-10 sm:h-8 text-sm rounded-xl shrink-0"}),(0,s.jsx)(u.z,{type:"button",onClick:()=>removeVariant(t),variant:"ghost",size:"sm",className:"hidden sm:flex h-8 w-8 p-0 rounded-full shrink-0",children:(0,s.jsx)(g.Z,{className:"w-4 h-4 text-red-500"})})]})]})},t)})})]})]})}),(0,s.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,s.jsx)(u.z,{type:"button",onClick:i,variant:"outline",className:"flex-1 rounded-3xl h-12",children:ev("common.back")}),(0,s.jsx)(u.z,{type:"submit",disabled:en,className:"flex-1 rounded-3xl h-12 bg-[#008069] hover:bg-[#017561]",children:en?ev("common.saving"):l?ev("products.edit_product"):ev("products.add_new")})]})]})]}),(0,s.jsx)(k,{open:eu,onOpenChange:em,children:(0,s.jsxs)(I,{className:"rounded-2xl",children:[(0,s.jsxs)(AlertDialogHeader,{children:[(0,s.jsxs)(z,{className:"flex items-center gap-2 text-amber-600",children:[(0,s.jsx)(L.Z,{className:"w-5 h-5"}),"ar"===eb?"تنبيه: الكميات صفر":"Warning: Zero Quantities"]}),(0,s.jsx)(P,{children:"ar"===eb?"لم يتم تحديد كمية لأي من الأنواع. سيتم حفظ المنتج ولكن لن يظهر للعملاء حتى تتوفر كمية.":"No quantities specified for variants. The product will be saved but will not be visible to customers until stock is added."})]}),(0,s.jsxs)(AlertDialogFooter,{className:"gap-2 sm:gap-0",children:[(0,s.jsx)(R,{asChild:!0,children:(0,s.jsx)(u.z,{variant:"outline",className:"rounded-xl",onClick:()=>em(!1),children:"ar"===eb?"تعديل":"Edit"})}),(0,s.jsx)(D,{asChild:!0,children:(0,s.jsx)(u.z,{onClick:e=>{e.preventDefault(),executeSave()},className:"rounded-xl bg-[#008069] hover:bg-[#017561]",children:"ar"===eb?"حفظ كمسودة":"Save as Draft"})})]})]})})]})}var ee=a(4301),et=a(6046);function DashboardPage(){var e;let{store:t,loading:a}=(0,et.o)(),[h,x]=(0,d.useState)([]),[g,f]=(0,d.useState)(!0),[v,j]=(0,d.useState)(!1),[N,w]=(0,d.useState)(null),[_,k]=(0,d.useState)(""),[S,C]=(0,d.useState)(!1),{user:I,loading:z}=(0,o.useAuth)();(0,c.useRouter)();let{toast:P}=(0,p.pm)(),{t:D,direction:R,language:Z}=(0,b.Z)(),{subscription:O}=(0,ee.m)(),V=null!==(e=null==O?void 0:O.isReadOnly)&&void 0!==e&&e,q=(0,d.useCallback)(async()=>{try{let e=await y.h.get("/api/dashboard/products");if(e.error){console.error("Error loading products:",e.error);return}x(e.products||[])}catch(e){console.error("Error loading products:",e)}finally{f(!1)}},[]);(0,d.useEffect)(()=>{(z||I)&&(a||(t?q():f(!1)))},[I,t,a,z,q]);let handleEditProduct=e=>{if(V){P({title:"ar"===Z?"وضع القراءة فقط":"Read-Only Mode",description:"ar"===Z?"جدد اشتراكك لتعديل المنتجات":"Renew your subscription to edit products",variant:"destructive"});return}w(e),j(!0)},handleDeleteProduct=async e=>{if(V){P({title:"ar"===Z?"وضع القراءة فقط":"Read-Only Mode",description:"ar"===Z?"جدد اشتراكك لحذف المنتجات":"Renew your subscription to delete products",variant:"destructive"});return}if(confirm(D("products.delete_confirm")))try{await y.h.delete("/api/dashboard/products/".concat(e)),P({title:D("dashboard.delete_product_title"),description:D("dashboard.delete_product_desc")}),q()}catch(e){P({title:D("common.error"),description:e.message,variant:"destructive"})}};return g?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-[#f0f2f5]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#008069]"})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:D("dashboard.products")}),(0,s.jsx)("p",{className:"text-gray-600",children:D("dashboard.products_count",{count:h.length})})]}),(0,s.jsxs)("div",{className:"flex flex-1 gap-2 w-full sm:w-auto",children:[(0,s.jsxs)("div",{className:"relative flex-1 sm:w-72",children:[(0,s.jsx)(r.Z,{className:"absolute ".concat("rtl"===R?"right-3":"left-3"," top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4")}),(0,s.jsx)(m.I,{type:"text",placeholder:D("dashboard.search_products"),value:_,onChange:e=>k(e.target.value),className:"".concat("rtl"===R?"pr-10":"pl-10"," h-10 rounded-2xl border-gray-200")})]}),(0,s.jsxs)(u.z,{variant:S?"default":"outline",onClick:()=>C(!S),className:"h-10 rounded-2xl gap-2 px-3 sm:px-4 ".concat(S?"bg-[#008069] hover:bg-[#017561]":""),children:[(0,s.jsx)(l.Z,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"whitespace-nowrap",children:D("dashboard.filter_out_of_stock")})]})]})]})}),0===h.length?(0,s.jsxs)("div",{className:"text-center py-16",children:[(0,s.jsx)(i.Z,{className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:D("dashboard.no_products")}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:D("dashboard.start_selling")}),(0,s.jsxs)(u.z,{onClick:()=>{if(V){P({title:"ar"===Z?"وضع القراءة فقط":"Read-Only Mode",description:"ar"===Z?"جدد اشتراكك لإضافة منتجات":"Renew your subscription to add products",variant:"destructive"});return}j(!0)},className:"rounded-3xl h-12 px-8 ".concat(V?"bg-gray-400 cursor-not-allowed":"bg-[#008069] hover:bg-[#017561]"),children:[(0,s.jsx)(n.Z,{className:"w-5 h-5 ".concat("rtl"===R?"ml-2":"mr-2")}),D("dashboard.add_first_product")]})]}):(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:h.filter(e=>{let t=!0;if(_.trim()){var a,s,r,l;let i=_.toLowerCase();t=e.name.toLowerCase().includes(i)||null!==(r=null===(a=e.description)||void 0===a?void 0:a.toLowerCase().includes(i))&&void 0!==r&&r||null!==(l=null===(s=e.category)||void 0===s?void 0:s.toLowerCase().includes(i))&&void 0!==l&&l}let i=!0;if(S){let t=e.variants&&e.variants.length>0,a=t?e.variants.reduce((e,t)=>e+t.quantity,0):e.quantity,s=e.unlimited_stock;(s||a>0)&&(i=!1)}return t&&i}).map(e=>(0,s.jsx)(ProductCard,{product:e,onEdit:handleEditProduct,onDelete:handleDeleteProduct},e.id))})]}),v&&t&&(0,s.jsx)(ProductFormModal,{storeId:t.id,storeSlug:t.slug,product:N,onClose:()=>{j(!1),w(null)},onSaved:()=>{j(!1),w(null),q()}}),h.length>0&&!v&&(0,s.jsx)("button",{onClick:()=>{if(V){P({title:"ar"===Z?"وضع القراءة فقط":"Read-Only Mode",description:"ar"===Z?"جدد اشتراكك لإضافة منتجات":"Renew your subscription to add products",variant:"destructive"});return}j(!0)},className:"fixed bottom-28 ".concat("rtl"===R?"left-8":"right-8"," z-[60] ").concat(V?"bg-gray-400":"bg-[#008069] hover:bg-[#017561] hover:scale-110"," text-white rounded-full p-5 shadow-2xl transition-all"),"aria-label":D("dashboard.add_product"),children:(0,s.jsx)(n.Z,{className:"w-8 h-8"})})]})}},6271:function(e,t,a){"use strict";a.d(t,{Ol:function(){return n},SZ:function(){return o},Zb:function(){return i},aY:function(){return c},ll:function(){return d}});var s=a(7573),r=a(7653),l=a(3883);let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});i.displayName="Card";let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",a),...r})});n.displayName="CardHeader";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h3",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})});d.displayName="CardTitle";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...r})});o.displayName="CardDescription";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",a),...r})});c.displayName="CardContent";let u=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",a),...r})});u.displayName="CardFooter"},885:function(e,t,a){"use strict";a.d(t,{$N:function(){return m},Vq:function(){return d},cZ:function(){return u},fK:function(){return DialogHeader}});var s=a(7573),r=a(7653),l=a(3507),i=a(7342),n=a(3883);let d=l.fC;l.xz;let o=l.h_;l.x8;let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.aV,{ref:t,className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});c.displayName=l.aV.displayName;let u=r.forwardRef((e,t)=>{let{className:a,children:r,...d}=e;return(0,s.jsxs)(o,{children:[(0,s.jsx)(c,{}),(0,s.jsxs)(l.VY,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...d,children:[r,(0,s.jsxs)(l.x8,{className:"absolute left-4 top-4 z-50 rounded-full bg-white/20 p-1 opacity-70 ring-offset-background transition-all hover:bg-white/40 hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none text-white shadow-sm",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=l.VY.displayName;let DialogHeader=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};DialogHeader.displayName="DialogHeader";let m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.Dx,{ref:t,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});m.displayName=l.Dx.displayName;let p=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.dk,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...r})});p.displayName=l.dk.displayName},4301:function(e,t,a){"use strict";a.d(t,{m:function(){return useSubscription},q:function(){return SubscriptionProvider}});var s=a(7573),r=a(7653),l=a(8681);let i=(0,r.createContext)({subscription:null,loading:!0,refresh:async()=>{}});function SubscriptionProvider(e){let{children:t}=e,[a,n]=(0,r.useState)(null),[d,o]=(0,r.useState)(!0),c=(0,r.useCallback)(async()=>{try{if(!l.h.isAuthenticated()){o(!1);return}let e=await l.h.get("/api/dashboard/subscription/status");n(e)}catch(e){console.error("Error fetching subscription status:",e)}finally{o(!1)}},[]);return(0,r.useEffect)(()=>{c()},[c]),(0,s.jsx)(i.Provider,{value:{subscription:a,loading:d,refresh:c},children:t})}function useSubscription(){let e=(0,r.useContext)(i);if(!e)throw Error("useSubscription must be used within a SubscriptionProvider");return e}},5948:function(e,t,a){"use strict";function slugify(e){if(!e)return"";let t={ا:"a",أ:"a",إ:"e",آ:"a",ء:"a",ب:"b",ت:"t",ث:"th",ج:"g",ح:"7",خ:"5",د:"d",ذ:"th",ر:"r",z:"z",ز:"z",س:"s",ش:"sh",ص:"s",ض:"d",ط:"t",ظ:"z",ع:"3",غ:"gh",ف:"f",ق:"q",ك:"k",ل:"l",m:"m",م:"m",ن:"n",ه:"h",و:"w",ي:"y",ى:"a",ة:"a","٠":"0","١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9","؟":"","،":"-","؛":""," ":"-"},a=e.split("").map(e=>t[e]||e).join("");return(a=a.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,""))?a:"store-"+Math.random().toString(36).substring(2,8)}a.d(t,{l:function(){return slugify}})}},function(e){e.O(0,[383,154,32,875,401,297,153,612,920,293,53,744],function(){return e(e.s=1311)}),_N_E=e.O()}]);