(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{1311:function(e,t,r){Promise.resolve().then(r.bind(r,1087))},1087:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return DashboardPage}});var s=r(7573),n=r(7653),o=r(6803),a=r(2859),i=r(8681);function DashboardPage(){let{user:e,loading:t,signOut:r}=(0,o.useAuth)(),c=(0,a.useRouter)(),[u,l]=(0,n.useState)([]),[h,d]=(0,n.useState)(!0),f=(0,n.useCallback)(async()=>{try{let e=await i.h.get("/api/dashboard/products");e.products&&l(e.products)}catch(e){console.error("Error loading products:",e)}finally{d(!1)}},[]);return((0,n.useEffect)(()=>{if(!t&&!e){c.push("/login");return}e&&f()},[e,t,c,f]),t||h)?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-[#f6f8f7]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#008069]"})}):(0,s.jsxs)("div",{className:"min-h-screen bg-[#f6f8f7]",children:[(0,s.jsx)("header",{className:"bg-white border-b border-gray-100 sticky top-0 z-40",children:(0,s.jsxs)("div",{className:"px-4 py-4 flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"متجرك"}),(0,s.jsx)("button",{onClick:r,className:"text-gray-600 hover:text-gray-900",children:"تسجيل خروج"})]})}),(0,s.jsxs)("main",{className:"p-4",children:[(0,s.jsxs)("h2",{className:"text-lg font-bold mb-4",children:["منتجاتك (",u.length,")"]}),0===u.length?(0,s.jsx)("div",{className:"text-center py-12 text-gray-500",children:"لا توجد منتجات بعد"}):(0,s.jsx)("div",{className:"grid grid-cols-2 gap-4",children:u.map(e=>(0,s.jsxs)("div",{className:"bg-white rounded-xl overflow-hidden shadow-sm border border-gray-100",children:[e.image_url&&(0,s.jsx)("img",{src:e.image_url,alt:e.name,className:"w-full aspect-square object-cover"}),(0,s.jsxs)("div",{className:"p-3",children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900 truncate",children:e.name}),(0,s.jsxs)("p",{className:"text-[#008069] font-bold",children:[e.price," جنيه"]})]})]},e.id))})]})]})}},8681:function(e,t,r){"use strict";r.d(t,{h:function(){return s}});let s=new class{setToken(e){this.token=e,localStorage.setItem("auth_token",e)}getToken(){return this.token||(this.token=localStorage.getItem("auth_token")),this.token}clearToken(){this.token=null,localStorage.removeItem("auth_token")}isAuthenticated(){return!!this.getToken()}async fetch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.getToken(),s=await fetch("".concat("https://whatsou.com").concat(e),{...t,headers:{"Content-Type":"application/json",...r?{Authorization:"Bearer ".concat(r)}:{},...t.headers}}),n=await s.json();if(!s.ok)throw 401===s.status&&this.clearToken(),Error(n.error||"API Error: ".concat(s.status));return n}get(e){return this.fetch(e,{method:"GET"})}post(e,t){return this.fetch(e,{method:"POST",body:t?JSON.stringify(t):void 0})}put(e,t){return this.fetch(e,{method:"PUT",body:t?JSON.stringify(t):void 0})}delete(e){return this.fetch(e,{method:"DELETE"})}constructor(){this.token=null}}},6803:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var s=r(7573),n=r(7653),o=r(2859),a=r(8681);let i=(0,n.createContext)(void 0);function useAuth(){let e=(0,n.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function AuthProvider(e){let{children:t}=e,[r,c]=(0,n.useState)(null),[u,l]=(0,n.useState)(!0),h=(0,o.useRouter)();(0,n.useEffect)(()=>{let checkSession=async()=>{if(!a.h.isAuthenticated()){l(!1);return}try{let e=await a.h.get("/api/auth/session");e.authenticated&&e.user?c(e.user):a.h.clearToken()}catch(e){console.error("Session check failed:",e),a.h.clearToken()}l(!1)};checkSession()},[]);let signIn=async(e,t)=>{try{let r=await a.h.post("/api/auth/login",{phone:e,password:t});if(r.error)return{error:r.error};return a.h.setToken(r.token),c(r.user),h.push("/dashboard"),{}}catch(e){return{error:e.message}}},signUp=async(e,t)=>{try{let r=await a.h.post("/api/auth/signup",{phone:e,password:t});if(r.error)return{error:r.error};return a.h.setToken(r.token),c(r.user),h.push("/onboarding"),{}}catch(e){return{error:e.message}}};return(0,s.jsx)(i.Provider,{value:{user:r,loading:u,signIn,signUp,signOut:()=>{a.h.clearToken(),c(null),h.push("/login")}},children:t})}},8294:function(e,t,r){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s=r(7653),n=Symbol.for("react.element"),o=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),a=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,r){var s,c={},u=null,l=null;for(s in void 0!==r&&(u=""+r),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,s)&&!i.hasOwnProperty(s)&&(c[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===c[s]&&(c[s]=t[s]);return{$$typeof:n,type:e,key:u,ref:l,props:c,_owner:a.current}}t.jsx=q,t.jsxs=q},7573:function(e,t,r){"use strict";e.exports=r(8294)},2859:function(e,t,r){e.exports=r(7699)}},function(e){e.O(0,[293,53,744],function(){return e(e.s=1311)}),_N_E=e.O()}]);